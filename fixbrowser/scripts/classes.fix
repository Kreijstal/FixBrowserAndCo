// THIS FILE WAS AUTOMATICALLY GENERATED FROM "classes.src.fix", DO NOT EDIT!

const{
@TOK_IDENT,
@TOK_FUNC_REF,
@TOK_NUMBER,
@TOK_HEX_NUMBER,
@TOK_FLOAT_NUMBER,
@TOK_CHAR,
@TOK_STRING,
@TOK_UNKNOWN,

@KW_DO,
@KW_IF,
@KW_FOR,
@KW_USE,
@KW_VAR,
@KW_CASE,
@KW_ELSE,
@KW_BREAK,
@KW_CONST,
@KW_WHILE,
@KW_IMPORT,
@KW_RETURN,
@KW_SWITCH,
@KW_DEFAULT,
@KW_CONTINUE,
@KW_FUNCTION
};

const{
@TOK_type,
@TOK_off,
@TOK_len,
@TOK_line,
@TOK_SIZE
};

const{
TYPE_DYNAMIC,
TYPE_VOID,
TYPE_INTEGER,
TYPE_FLOAT,
TYPE_BOOLEAN,
TYPE_STRING,
@TYPE_KEY,
@TYPE_VALUE
};

const{
EXT_TYPE_CLASS,
EXT_TYPE_ARRAY,
EXT_TYPE_HASH,
EXT_TYPE_STRUCT,
EXT_TYPE_STRUCT_ARRAY,
EXT_TYPE_MULTIPLE
};

const{
@CLASS_ext_type,
@CLASS_name,
@CLASS_compat_name,
@CLASS_method_prefix,
@CLASS_private,
@CLASS_parent,
@CLASS_fields,
@CLASS_functions,
@CLASS_virtual,
@CLASS_supers,
@CLASS_operators,
@CLASS_generate_to_string,
@CLASS_SIZE
};

const{
@ARRAY_ext_type,
@ARRAY_base_type,
@ARRAY_SIZE
};

const{
@HASH_ext_type,
@HASH_base_type,
@HASH_index_type,
@HASH_SIZE
};

const{
@FIELD_name,
@FIELD_compat_name,
@FIELD_private,
@FIELD_type,
@FIELD_SIZE
};

const{
@FUNC_name,
@FUNC_alt_name,
@FUNC_flags,
@FUNC_params,
@FUNC_return_type,
@FUNC_SIZE
};

const{
@EXTENFUNC_kind=FUNC_SIZE,
@EXTENFUNC_SIZE
};

const{
@LOCAL_name,
@LOCAL_private,
@LOCAL_type,
@LOCAL_SIZE
};

const{
@FUNC_FLAG_PRIVATE=0x01,
@FUNC_FLAG_STATIC=0x02,
@FUNC_FLAG_VIRTUAL=0x04,
@FUNC_FLAG_OVERRIDE=0x08,
@FUNC_FLAG_ABSTRACT=0x10,
@FUNC_FLAG_CONSTRUCTOR=0x20,
@FUNC_FLAG_OPERATOR=0x40,
@FUNC_FLAG_EXTENSION=0x80
};

const{
@GEN_result_tokens,
@GEN_last_result_pos,
@GEN_func_tokens,
@GEN_last_func_pos,
@GEN_func_offsets_replacements,
@GEN_const_tokens,
@GEN_first_const,
@GEN_src,
@GEN_vars,
@GEN_var_stack,
@GEN_ret_type,
@GEN_cur_func,
@GEN_consts,
@GEN_cur_class,
@GEN_parse_classes,
@GEN_parse_funcs,
@GEN_fname,
@GEN_imported_scripts,
@GEN_imported_locals,
@GEN_imported_classes,
@GEN_imported_functions,
@GEN_imported_static_functions,
@GEN_imported_instance_functions,
@GEN_imported_operators,
@GEN_classes,
@GEN_functions,
@GEN_static_functions,
@GEN_instance_functions,
@GEN_locals,
@GEN_custom_ctx,
@GEN_import_aliases,
@GEN_uses_float_shorthands,
@GEN_hash_entry_value_type,
@GEN_fixide_cursor,
@GEN_SIZE
};

const{
@PRIO_LOGICAL_AND=0x11,
@PRIO_LOGICAL_OR=0x12,
@PRIO_COMPARISON_LT=0x21,
@PRIO_COMPARISON_GT=0x22,
@PRIO_COMPARISON_LE=0x23,
@PRIO_COMPARISON_GE=0x24,
@PRIO_EQUALITY_EQ_VALUE=0x25,
@PRIO_EQUALITY_NE_VALUE=0x26,
@PRIO_EQUALITY_EQ_REF=0x27,
@PRIO_EQUALITY_NE_REF=0x28,
@PRIO_BITWISE_AND=0x31,
@PRIO_BITWISE_OR=0x32,
@PRIO_BITWISE_XOR=0x33,
@PRIO_BITWISE_SHL=0x34,
@PRIO_BITWISE_SHR=0x35,
@PRIO_BITWISE_USHR=0x36,
@PRIO_ADDITIVE_ADD=0x41,
@PRIO_ADDITIVE_SUB=0x42,
@PRIO_MULTIPLICATIVE_MUL=0x51,
@PRIO_MULTIPLICATIVE_DIV=0x52,
@PRIO_MULTIPLICATIVE_REM=0x53,
@PRIO_PRIMARY=0x60
};

const{
@PRIO_SPECIAL_COMPARE=0x70,
@PRIO_SPECIAL_ADD_INPLACE,
@PRIO_SPECIAL_SUB_INPLACE,
@PRIO_SPECIAL_MUL_INPLACE,
@PRIO_SPECIAL_DIV_INPLACE,
@PRIO_SPECIAL_REM_INPLACE,
@PRIO_SPECIAL_AND_INPLACE,
@PRIO_SPECIAL_OR_INPLACE,
@PRIO_SPECIAL_XOR_INPLACE,
@PRIO_SPECIAL_SHL_INPLACE,
@PRIO_SPECIAL_SHR_INPLACE,
@PRIO_SPECIAL_USHR_INPLACE
};

const{
@ET_HASH,
@ET_STRING,
@ET_FLOAT,
@ET_BLOCK
};

const{
@BT_NORMAL,
@BT_SINGLE,
@BT_EXPR
};

const{
@FO_ADD_SUB,
@FO_MUL_DIV
};

const{
@CTX_function_calls,
@CTX_function_calls_any,
@CTX_postprocess,
@CTX_gen,
@CTX_required_checked,
@CTX_required_origin,
@CTX_append_tokens,
@CTX_SIZE
};

const{
@FUNC_CALL_get_types_func,
@FUNC_CALL_adjust_call_func,
@FUNC_CALL_data,
@FUNC_CALL_SIZE
};

const{
@IMPORT_ALIAS_consts,
@IMPORT_ALIAS_locals,
@IMPORT_ALIAS_funcs,
@IMPORT_ALIAS_SIZE
};

const{
@OPERATOR_prio,
@OPERATOR_type1,
@OPERATOR_type2,
@OPERATOR_ret_type,
@OPERATOR_func_name,
@OPERATOR_compare,
@OPERATOR_SIZE
};

const@class_ClassContext="";
const@class_ClassType="";
const@static_ClassContext_get_1="(String): ClassContext";
const@static_ClassContext_get_2="(String, Boolean): ClassContext";
const@method_ClassContext_register_function_call_5="(String, Dynamic, Dynamic, Dynamic): Void";
const@method_ClassContext_register_postprocess_3="(Dynamic, Dynamic): Void";
const@method_ClassContext_get_class_2="(String): ClassType";
const@method_ClassContext_get_const_type_2="(String): ClassType";
const@method_ClassContext_get_local_type_2="(String): ClassType";
const@method_ClassContext_get_variable_type_2="(String): ClassType";
const@method_ClassContext_get_source_1="(): String";
const@method_ClassContext_append_tokens_2="(Dynamic): Void";
const@static_ClassType_create_array_1="(ClassType): ClassType";
const@static_ClassType_create_hash_2="(ClassType, ClassType): ClassType";
const@method_ClassType_is_class_1="(): Boolean";
const@method_ClassType_is_array_1="(): Boolean";
const@method_ClassType_is_hash_1="(): Boolean";
const@method_ClassType_is_struct_1="(): Boolean";
const@method_ClassType_is_struct_array_1="(): Boolean";
const@method_ClassType_is_multiple_1="(): Boolean";
const@method_ClassType_is_assignable_from_2="(ClassType): Boolean";
const@method_ClassType_get_class_name_1="(): String";
const@method_ClassType_get_parent_class_1="(): ClassType";
const@method_ClassType_get_method_real_name_4="(String, ClassType[], Boolean): String";
const@method_ClassType_get_base_1="(): ClassType";
const@method_ClassType_get_index_1="(): ClassType";
const@method_ClassType_get_multiple_count_1="(): Integer";
const@method_ClassType_get_multiple_type_2="(Integer): ClassType";
const@method_ClassType_to_string_1="(): String";
const@static_ClassType_dump_list_1="(ClassType[]): Void";

var@classes,@functions,@locals;
var@static_functions,@instance_functions;
var@builtin_functions;
var@builtin_static_functions;
var@builtin_instance_functions;
var@tmp_cnt;
var@contexts;
var@parse_type_allow_generics;

var@initialized;
var@has_object_script;
var@fixide;



function class_context_get(fname)
{
return class_context_get(fname,true);
}

function class_context_get(fname,required)
{
if(!contexts){
contexts={};
}
var ctx=hash_get(contexts,fname,null);
if(!ctx){
ctx=object_create(CTX_SIZE);
ctx->CTX_function_calls={};
ctx->CTX_postprocess=[];
contexts{fname}=ctx;
}
if(required&&!ctx->CTX_required_checked){
var stack=error(null)[1];
var idx=1,s=stack[0];
for(var i=length(s)-1;i>=0;i--){
if(s[i]==':'){
array_set_length(s,i+1);
continue;
}
if(s[i]=='('){
array_remove(s,0,i);
break;
}
}
var match={"class_context_get#1 ",s};
if(length(stack[idx])>=length(match)&&array_extract(stack[idx],0,length(match))==match){
idx++;
}
ctx->CTX_required_checked=true;
ctx->CTX_required_origin=stack[idx];
script_postprocess(check_required#4,ctx);
}
return ctx;
}

function@check_required(ctx,fname,tokens,src)
{
if(contexts&&hash_contains(contexts,fname)){
hash_remove(contexts,fname);
if(length(contexts)==0){
contexts=null;
}
return 0,error({fname,"(0): script must use classes, requested in: ",ctx->CTX_required_origin});
}
}



function class_context_register_function_call(ctx,name,get_types_func,adjust_call_func,data)
{
var list,register_to_all=false;

if(name){
list=hash_get(ctx->CTX_function_calls,name,null);
if(!list){
var function_calls_any=ctx->CTX_function_calls_any;
list=function_calls_any?clone(function_calls_any):[];
ctx->CTX_function_calls{name}=list;
}
}
else{
list=ctx->CTX_function_calls_any;
if(!list){
list=[];
ctx->CTX_function_calls_any=list;
}
register_to_all=true;
}

list[]=get_types_func;
list[]=adjust_call_func;
list[]=data;

if(register_to_all){
var function_calls=ctx->CTX_function_calls;
for(var i=0;i<length(function_calls);i++){
var(k,v)=hash_entry(function_calls,i);
v[]=get_types_func;
v[]=adjust_call_func;
v[]=data;
}
}
}


function class_context_register_postprocess(ctx,postprocess_func,data)
{
ctx->CTX_postprocess[]=postprocess_func;
ctx->CTX_postprocess[]=data;
}

function class_context_get_class(ctx,name)
{
return find_class(ctx->CTX_gen,name);
}

function class_context_get_const_type(ctx,name)
{
return hash_get(ctx->CTX_gen->GEN_consts,name,-1);
}

function class_context_get_local_type(ctx,name)
{
var gen=ctx->CTX_gen;
if(gen->GEN_locals){
var local=hash_get(gen->GEN_locals,name,null);
if(local){
return local->LOCAL_type;
}
}
if(gen->GEN_imported_locals){
var local=hash_get(gen->GEN_imported_locals,name,null);
if(local){
return local->LOCAL_type;
}
}
return-1;
}

function class_context_get_variable_type(ctx,name)
{
return hash_get(ctx->CTX_gen->GEN_vars,name,-1);
}

function class_context_get_source(ctx)
{
return ctx->CTX_gen->GEN_src;
}

function class_context_append_tokens(ctx,tokens)
{
if(length(tokens)==0)return;
if(!ctx->CTX_append_tokens){
ctx->CTX_append_tokens=[];
}
ctx->CTX_append_tokens[]=tokens;
}

function class_type_create_array(base_type)
{
return create_array_type(base_type);
}

function class_type_create_hash(base_type,index_type)
{
return create_hash_type(base_type,index_type);
}

function class_type_is_class(type)
{
return is_array(type)&&type[0]==EXT_TYPE_CLASS;
}

function class_type_is_array(type)
{
return is_array(type)&&type[0]==EXT_TYPE_ARRAY;
}

function class_type_is_hash(type)
{
return is_array(type)&&type[0]==EXT_TYPE_HASH;
}

function class_type_is_struct(type)
{
return is_array(type)&&type[0]==EXT_TYPE_STRUCT;
}

function class_type_is_struct_array(type)
{
return is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY;
}

function class_type_is_multiple(type)
{
return is_array(type)&&type[0]==EXT_TYPE_MULTIPLE;
}

function class_type_is_assignable_from(type,other)
{
return is_compatible_type(type,other);
}

function class_type_get_class_name(type)
{
return type->CLASS_name;
}

function class_type_get_parent_class(type)
{
return type->CLASS_parent;
}

function class_type_get_method_real_name(type,name,types,is_static)
{
var func_name={name,"#",length(types)-1};
var func=null;
var cls=type;
while(cls){
func=hash_get(cls->CLASS_functions,func_name,null);
if(func&&(func->FUNC_flags&FUNC_FLAG_OVERRIDE)==0)break;
cls=cls->CLASS_parent;
}
if(!func)return null;

if(is_static){
if(!(func->FUNC_flags&FUNC_FLAG_STATIC)){
return null;
}
}
else{
if(func->FUNC_flags&FUNC_FLAG_STATIC){
return null;
}
}

if(!is_compatible_type(types[0],func->FUNC_return_type)){
return null;
}

for(var i=1;i<length(types);i++){
var(k,v)=hash_entry(func->FUNC_params,i-1);
if(!is_compatible_type(v,types[i])){
return null;
}
}

return{cls->CLASS_method_prefix,func->FUNC_name};
}

function class_type_get_base(type)
{
switch(type[0]){
case EXT_TYPE_ARRAY:return type->ARRAY_base_type;
case EXT_TYPE_HASH:return type->HASH_base_type;
case EXT_TYPE_STRUCT_ARRAY:return type->ARRAY_base_type;
}
return 0,error("bad type");
}

function class_type_get_index(type)
{
switch(type[0]){
case EXT_TYPE_HASH:return type->HASH_index_type;
}
return 0,error("bad type");
}

function class_type_get_multiple_count(type)
{
switch(type[0]){
case EXT_TYPE_MULTIPLE:return length(type)-1;
}
return 0,error("bad type");
}

function class_type_get_multiple_type(type,idx)
{
switch(type[0]){
case EXT_TYPE_MULTIPLE:return type[idx+1];
}
return 0,error("bad type");
}

function class_type_to_string(type)
{
return get_type_name(type);
}

function class_type_dump_list(list)
{
var s={"[\n"};
for(var i=0;i<length(list);i++){
array_append(s,"  \"");
array_append(s,get_type_name(list[i]));
s[]='"';
if(i<length(list)-1){
s[]=',';
}
s[]='\n';
}
s[]=']';
log(s);
}
function@token_type_to_string(type)
{
switch(type){
case TOK_IDENT:return "TOK_IDENT";
case TOK_FUNC_REF:return "TOK_FUNC_REF";
case TOK_NUMBER:return "TOK_NUMBER";
case TOK_HEX_NUMBER:return "TOK_HEX_NUMBER";
case TOK_FLOAT_NUMBER:return "TOK_FLOAT_NUMBER";
case TOK_CHAR:return "TOK_CHAR";
case TOK_STRING:return "TOK_STRING";
case TOK_UNKNOWN:return "TOK_UNKNOWN";

case KW_DO:return "KW_DO";
case KW_IF:return "KW_IF";
case KW_FOR:return "KW_FOR";
case KW_VAR:return "KW_VAR";
case KW_USE:return "KW_USE";
case KW_ELSE:return "KW_ELSE";
case KW_CASE:return "KW_CASE";
case KW_WHILE:return "KW_WHILE";
case KW_BREAK:return "KW_BREAK";
case KW_CONST:return "KW_CONST";
case KW_RETURN:return "KW_RETURN";
case KW_IMPORT:return "KW_IMPORT";
case KW_SWITCH:return "KW_SWITCH";
case KW_DEFAULT:return "KW_DEFAULT";
case KW_FUNCTION:return "KW_FUNCTION";
case KW_CONTINUE:return "KW_CONTINUE";
}

var c0=type&0xFF;
var c1=(type>>>8)&0xFF;
var c2=(type>>>16)&0xFF;
var c3=(type>>>24)&0xFF;
var s={""};
s[]=c0;
if(c1){
s[]=c1;
if(c2){
s[]=c2;
if(c3){
s[]=c3;
}
}
}
return s;
}

function@_tokens_get_desc(type)
{
switch(type){
case TOK_IDENT:return "identifier";
case TOK_FUNC_REF:return "function reference";
case TOK_NUMBER:return "number literal";
case TOK_HEX_NUMBER:return "hex number literal";
case TOK_FLOAT_NUMBER:return "float number literal";
case TOK_CHAR:return "character literal";
case TOK_STRING:return "string literal";
case TOK_UNKNOWN:return "unknown";

case KW_DO:return "keyword 'do'";
case KW_IF:return "keyword 'if'";
case KW_FOR:return "keyword 'for'";
case KW_VAR:return "keyword 'var'";
case KW_USE:return "keyword 'use'";
case KW_ELSE:return "keyword 'else'";
case KW_CASE:return "keyword 'case'";
case KW_WHILE:return "keyword 'while'";
case KW_BREAK:return "keyword 'break'";
case KW_CONST:return "keyword 'const'";
case KW_RETURN:return "keyword 'return'";
case KW_IMPORT:return "keyword 'import'";
case KW_SWITCH:return "keyword 'switch'";
case KW_DEFAULT:return "keyword 'default'";
case KW_FUNCTION:return "keyword 'function'";
case KW_CONTINUE:return "keyword 'continue'";
}
return{"symbol '",token_type_to_string(type),"'"};
}

function@_tokens_char(c)
{
var s={" "};
s[0]=c;
return s;
}













































































function@_token_list_dump(tokens,src)
{
var s={""};
var last_line=1,last_type=-1;

for(var i=0;i<length(tokens);i+=TOK_SIZE){
if(last_line!=tokens[i+TOK_line]){
s[]='\n';
last_line=tokens[i+TOK_line];
}
else{
if(last_type<' '&&tokens[i+TOK_type]<' '){
s[]=' ';
}
}
var len=length(s);
array_set_length(s,len+tokens[i+TOK_len]);
array_copy(s,len,src,tokens[i+TOK_off],tokens[i+TOK_len]);
last_type=tokens[i+TOK_type];
}
log(s);
}






























































function@replace_array(dest,src)
{
array_set_length(dest,length(src));
array_copy(dest,0,src,0,length(src));
}

function@string_starts_with(s,match)
{
var len=length(match);
if(length(s)<len)return false;
return array_extract(s,0,len)==match;
}

function@merge_hash(dest,src)
{
for(var i=0;i<length(src);i++){
var(k,v)=hash_entry(src,i);
dest{k}=v;
}
}

function process_tokens(fname,tokens,src)
{
if(!initialized){
initialized=true;
classes={};
functions={};
static_functions={};
instance_functions={};
locals={};
init_builtin_functions();
var(r1,e1)=script_query("object",null,null,null,null);
var(r2,e2)=@fixide_is_present();
has_object_script=!e1;
fixide=r2;
}

var list_tokens=tokens,list_src=src,list_off=-4;;
if(has_object_script&&fname!="object.fix"){
var _macro_tmp_2_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_2_0++;continue;case ')','}',']':if(!_macro_tmp_2_0)break;_macro_tmp_2_0--;continue;case ',',';':if(!_macro_tmp_2_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};

while(((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off])==KW_USE){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_STRING){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_STRING)});};
for(;;){
var _macro_tmp_9_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_9_0++;continue;case ')','}',']':if(!_macro_tmp_9_0)break;_macro_tmp_9_0--;continue;case ',',';':if(!_macro_tmp_9_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens)))break;
if((list_tokens[list_off]===(';'))){
list_off-=TOK_SIZE;;
break;
}
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}
break;
}
if(has_object_script){
array_insert_array(tokens,(list_off),tokens_parse([],src,"import \"object\";",(list_tokens[list_off+TOK_line])));
list_off-=TOK_SIZE;;
}
}

var gen=object_create(GEN_SIZE);
gen->GEN_result_tokens=[];
gen->GEN_func_tokens=[];
gen->GEN_func_offsets_replacements={};
gen->GEN_const_tokens=[];
gen->GEN_src=src;
gen->GEN_vars={};
gen->GEN_var_stack=[];
gen->GEN_consts={};
gen->GEN_parse_classes=[];
gen->GEN_parse_funcs=[];
gen->GEN_fname=fname;
gen->GEN_imported_scripts={};
gen->GEN_imported_classes={};
gen->GEN_imported_functions={};
gen->GEN_imported_operators={};
gen->GEN_classes={};
gen->GEN_functions={};
if(contexts){
var ctx=hash_get(contexts,fname,null);
if(ctx){
hash_remove(contexts,fname);
if(length(contexts)==0){
contexts=null;
}
ctx->CTX_gen=gen;
gen->GEN_custom_ctx=ctx;
}
}
if(fixide){
gen->GEN_fixide_cursor=@fixide_get_cursor(fname);
}
classes{fname}=gen->GEN_classes;
functions{fname}=gen->GEN_functions;

process_tokens_inner(gen,list_tokens,list_src,list_off);

if(gen->GEN_custom_ctx){
for(;;){
var append_tokens=gen->GEN_custom_ctx->CTX_append_tokens;
if(append_tokens&&length(append_tokens)>0){
var new_tokens=append_tokens[0];
array_remove(append_tokens,0);
var new_list_tokens=new_tokens,new_list_src=src,new_list_off=-4;;
new_list_off+=TOK_SIZE;;
gen->GEN_last_result_pos=new_list_off;;;
new_list_off-=TOK_SIZE;;
hash_clear(gen->GEN_func_offsets_replacements);
process_tokens_inner(gen,new_list_tokens,new_list_src,new_list_off);
continue;
}
break;
}
}

replace_array(tokens,gen->GEN_result_tokens);
list_off=-4;;
var inserted=false;
while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){
case KW_VAR,KW_FUNCTION:
array_insert_array(tokens,(list_off),gen->GEN_const_tokens);
inserted=true;
break;
}
if(inserted)break;
}
if(!inserted){
array_append(tokens,gen->GEN_const_tokens);
}

array_append(tokens,gen->GEN_func_tokens);


if(gen->GEN_uses_float_shorthands){
process_float_shorthands(tokens,src);
}

for(var i=0;i<length(gen->GEN_classes);i++){
var(k,v)=hash_entry(gen->GEN_classes,i);
if(v->CLASS_private){
hash_remove(gen->GEN_classes,k);
i--;
continue;
}
if(v->CLASS_ext_type!=EXT_TYPE_STRUCT){
for(var j=0;j<length(v->CLASS_fields);j++){
var(k2,v2)=hash_entry(v->CLASS_fields,j);
if(v2->FIELD_private){
hash_remove(v->CLASS_fields,k2);
j--;
continue;
}
}
}
for(var j=0;j<length(v->CLASS_functions);j++){
var(k2,v2)=hash_entry(v->CLASS_functions,j);
if(v2->FUNC_flags&FUNC_FLAG_PRIVATE){
hash_remove(v->CLASS_functions,k2);
j--;
continue;
}
}
}

for(var i=0;i<length(gen->GEN_functions);i++){
var(k,v)=hash_entry(gen->GEN_functions,i);
if(v->FUNC_flags&(FUNC_FLAG_PRIVATE|FUNC_FLAG_EXTENSION)){
hash_remove(gen->GEN_functions,k);
i--;
continue;
}
}

if(gen->GEN_locals){
for(var i=0;i<length(gen->GEN_locals);i++){
var(k,v)=hash_entry(gen->GEN_locals,i);
if(v->LOCAL_private){
hash_remove(gen->GEN_locals,k);
i--;
continue;
}
}
if(length(gen->GEN_locals)==0){
hash_remove(locals,fname);
}
}

if(gen->GEN_custom_ctx){
var postprocess=gen->GEN_custom_ctx->CTX_postprocess;
for(var i=length(postprocess)-2;i>=0;i-=2){
postprocess[i+0](postprocess[i+1],fname,tokens,src);
}
}






}

function@process_tokens_inner(gen,list_tokens,list_src,list_off)
{
var fname=gen->GEN_fname;
var src=list_src;
var parse_locals=null;



while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){
case KW_IMPORT:{
var import_pos=(list_off);
var import_line=(list_tokens[list_off+TOK_line]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_STRING){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_STRING)});};
var script_name=token_parse_string(array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]));
var script_alias=null;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
script_alias=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
var import_fname={""};
var consts={};
if(script_alias){
var locals=[];
var funcs=[];
script_query(script_name,import_fname,consts,locals,funcs);
var consts_map={};
for(var i=0;i<length(consts);i++){
var(k,v)=hash_entry(consts,i);
if(k[0]=='@')continue;
if(is_array(v)){
v=v[0];
}
var type=TYPE_DYNAMIC;
if(is_int(v)){
type=TYPE_INTEGER;
}
else if(is_float(v)){
type=TYPE_FLOAT;
}
else if(is_string(v)){
type=TYPE_STRING;
}
consts_map{k}=type;
}
var locals_set={};
for(var i=0;i<length(locals);i++){
locals_set{locals[i]}=true;
}
var funcs_set={};
for(var i=0;i<length(funcs);i++){
var name=funcs[i];
funcs_set{name}=true;
name={name};
for(var j=length(name)-1;j>=0;j--){
if(name[j]=='#'){
array_set_length(name,j);
break;
}
}
funcs_set{name}=true;
}
var ia=object_create(IMPORT_ALIAS_SIZE);
ia->IMPORT_ALIAS_consts=consts_map;
ia->IMPORT_ALIAS_locals=locals_set;
ia->IMPORT_ALIAS_funcs=funcs_set;
if(!gen->GEN_import_aliases){
gen->GEN_import_aliases={};
}
gen->GEN_import_aliases{script_alias}=ia;
}
else{
var(r,e)=script_query(script_name,import_fname,consts,null,null);
if(is_array(e)&&length(e)>=2&&is_string(e[0])){

var s=e[0];
var prefix="script ";
var suffix=" not found";
if(length(s)>=length(prefix)+length(suffix)&&array_extract(s,0,length(prefix))==prefix&&array_extract(s,length(s)-length(suffix),length(suffix))==suffix){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": ",s});
}
else{
return 0,e;
}
}
else if(e){
return 0,e;
}
}
var import_state=hash_get(gen->GEN_imported_scripts,script_name,0);
if(import_state==3){
gen->GEN_imported_scripts{script_name}=2;
}
else if(import_state==2){
gen->GEN_imported_scripts{script_name}=1;
array_remove(list_tokens,import_pos,(list_off)-import_pos+TOK_SIZE);
list_off=import_pos-TOK_SIZE;;
continue;
}
else{
gen->GEN_imported_scripts{script_name}=1;
}
var import_scripts=hash_get(consts,"@import_scripts",null);
if(import_scripts){
var scripts=string_split(import_scripts,',');
var new_tokens=null;
for(var i=0;i<length(scripts);i++){
var script=scripts[i];
if(hash_contains(gen->GEN_imported_scripts,script))continue;
if(!new_tokens){
new_tokens=[];
}
tokens_parse(new_tokens,src,{"import ",token_escape_string(script),";"},import_line);
gen->GEN_imported_scripts{script}=3;
}
if(new_tokens){
array_insert_array(list_tokens,import_pos,new_tokens);
list_off=import_pos-TOK_SIZE;;
continue;
}
}
var import_classes=hash_get(classes,import_fname,null);
if(import_classes){
for(var i=0;i<length(import_classes);i++){
var(cls_name,v)=hash_entry(import_classes,i);
if(!v->CLASS_private&&!hash_contains(gen->GEN_imported_classes,cls_name)){
gen->GEN_imported_classes{cls_name}=v;
var operators=v->CLASS_operators;
if(operators){
merge_operators(gen->GEN_imported_operators,operators);
}
}
}
for(var i=0;i<length(consts);i++){
var(k,v)=hash_entry(consts,i);
if(k[0]=='@')continue;
if(!hash_contains(gen->GEN_consts,k)){
if(is_array(v)){
v=v[0];
}
gen->GEN_consts{k}=is_string(v)?TYPE_STRING:is_float(v)?TYPE_FLOAT:TYPE_INTEGER;
}
}
}
else{
var class_attribs=null;
var funcs=null;










for(var i=0;i<length(consts);i++){
var(k,v)=hash_entry(consts,i);
var private=(k[0]=='@');
if(private&&length(k)>5){
var short=k[1]|(k[2]<<8)|(k[3]<<16)|(k[4]<<24);
switch(short){
case 'clas':
if(length(k)>7&&array_extract(k,1,6)=="class_"){
var cls_name=string_const(k,7,length(k)-7);
class_attribs=parse_class_attrib(gen,import_fname,cls_name,v,class_attribs,(list_tokens[list_off+TOK_line]));
}
break;

case 'glob':
if(length(k)>8&&array_extract(k,1,7)=="global_"){
var func_name=array_extract(k,8,length(k)-8);
for(var j=length(func_name)-1;j>=0;j--){
if(func_name[j]=='_'){
func_name[j]='#';
break;
}
}
if(!funcs){var _macro_tmp_51_0=[];script_query(script_name,null,null,null,_macro_tmp_51_0);funcs={};for(var _macro_tmp_51_1=0;_macro_tmp_51_1<length(_macro_tmp_51_0);_macro_tmp_51_1++){funcs{_macro_tmp_51_0[_macro_tmp_51_1]}=true;}};
var(func,e)=parse_method_attrib(gen,null,func_name,v,null,true,false,funcs,(list_tokens[list_off+TOK_line]));
if(e){
return 0,adjust_method_attrib_error(fname,(list_tokens[list_off+TOK_line]),e,null,func_name);
}
var map=hash_get(functions,import_fname,null);
if(!map){
map={};
functions{import_fname}=map;
}
map{func_name}=func;
}
break;
}
continue;
}
if(!private&&!hash_contains(gen->GEN_consts,k)){
if(is_array(v)){
v=v[0];
}
gen->GEN_consts{k}=is_string(v)?TYPE_STRING:is_float(v)?TYPE_FLOAT:TYPE_INTEGER;
}
}
if(class_attribs){
if(!funcs){var _macro_tmp_54_0=[];script_query(script_name,null,null,null,_macro_tmp_54_0);funcs={};for(var _macro_tmp_54_1=0;_macro_tmp_54_1<length(_macro_tmp_54_0);_macro_tmp_54_1++){funcs{_macro_tmp_54_0[_macro_tmp_54_1]}=true;}};
class_attribs=finish_class_attribs(gen,class_attribs,consts,funcs);
for(var i=0;i<length(consts);i++){
var(k,v)=hash_entry(consts,i);
if(k[0]=='@'&&length(k)>5){
var short=k[1]|(k[2]<<8)|(k[3]<<16)|(k[4]<<24);
switch(short){
case 'fiel':
if(length(k)>7&&array_extract(k,1,6)=="field_"){
consts{k}=null;
var cls_name=null;
var field_name=array_extract(k,7,length(k)-7);
for(var j=0;j<length(class_attribs);j++){
var(name,map)=hash_entry(class_attribs,j);
if(length(name)+1<length(field_name)){
if(array_extract(field_name,0,length(name))==name&&field_name[length(name)]=='_'){
cls_name=name;
array_remove(field_name,0,length(name)+1);
break;
}
}
}
if(cls_name){
var(r,e)=parse_field_attrib(gen,cls_name,field_name,v,class_attribs,(list_tokens[list_off+TOK_line]));
if(e){
return 0,adjust_field_attrib_error(fname,(list_tokens[list_off+TOK_line]),e,cls_name,field_name);
}
}
}
break;

case 'meth','stat':
if(length(k)>8&&((short=='meth'&&array_extract(k,1,7)=="method_")||(short=='stat'&&array_extract(k,1,7)=="static_"))){
consts{k}=null;
var is_static=(k[1]=='s');
var cls_name=null;
var method_name=array_extract(k,8,length(k)-8);
for(var j=0;j<length(class_attribs);j++){
var(name,map)=hash_entry(class_attribs,j);
if(length(name)+1<length(method_name)){
if(array_extract(method_name,0,length(name))==name&&method_name[length(name)]=='_'){
cls_name=name;
array_remove(method_name,0,length(name)+1);
break;
}
}
}
if(cls_name){
for(var j=length(method_name)-1;j>=0;j--){
if(method_name[j]=='_'){
method_name[j]='#';
break;
}
}
var(r,e)=parse_method_attrib(gen,cls_name,method_name,v,class_attribs,is_static,false,null,(list_tokens[list_off+TOK_line]));
if(e){
return 0,adjust_method_attrib_error(fname,(list_tokens[list_off+TOK_line]),e,cls_name,method_name);
}
}
}
break;

case 'oper':
if(length(k)>10&&array_extract(k,1,9)=="operator_"){
consts{k}=null;
var cls_name=null;
var op_name=array_extract(k,10,length(k)-10);
for(var j=length(op_name)-1;j>=0;j--){
if(op_name[j]=='_'){
array_set_length(op_name,j);
break;
}
}
for(var j=length(op_name)-1;j>=0;j--){
if(op_name[j]=='_'){
cls_name=array_extract(op_name,0,j);
array_remove(op_name,0,j+1);
break;
}
}
if(cls_name){
if(op_name=="inplace"){
for(var j=length(cls_name)-1;j>=0;j--){
if(cls_name[j]=='_'){
array_insert(op_name,0,'_');
array_insert_array(op_name,0,cls_name,j+1,length(cls_name)-j-1);
array_set_length(cls_name,j);
break;
}
}
}
if(!funcs){var _macro_tmp_59_0=[];script_query(script_name,null,null,null,_macro_tmp_59_0);funcs={};for(var _macro_tmp_59_1=0;_macro_tmp_59_1<length(_macro_tmp_59_0);_macro_tmp_59_1++){funcs{_macro_tmp_59_0[_macro_tmp_59_1]}=true;}};
var(r,e)=parse_operator_attrib(gen,cls_name,op_name,v,class_attribs,funcs,(list_tokens[list_off+TOK_line]));
if(e){
return 0,adjust_operator_attrib_error(fname,(list_tokens[list_off+TOK_line]),e,cls_name,op_name);
}
}
}
break;
}
}
}
}
for(var i=0;i<length(consts);i++){
var(k,v)=hash_entry(consts,i);
if(k[0]=='@'&&length(k)>5&&v){
var short=k[1]|(k[2]<<8)|(k[3]<<16)|(k[4]<<24);
var match=false;
switch(short){
case 'fiel':
if(length(k)>7&&array_extract(k,1,6)=="field_"){
match=true;
}
break;

case 'meth':
if(length(k)>14&&array_extract(k,1,13)=="method_Array_"){
if(!funcs){var _macro_tmp_62_0=[];script_query(script_name,null,null,null,_macro_tmp_62_0);funcs={};for(var _macro_tmp_62_1=0;_macro_tmp_62_1<length(_macro_tmp_62_0);_macro_tmp_62_1++){funcs{_macro_tmp_62_0[_macro_tmp_62_1]}=true;}};
parse_extension_method_attrib(gen,"array",k,v,false,2,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>15&&array_extract(k,1,14)=="method_String_"){
if(!funcs){var _macro_tmp_64_0=[];script_query(script_name,null,null,null,_macro_tmp_64_0);funcs={};for(var _macro_tmp_64_1=0;_macro_tmp_64_1<length(_macro_tmp_64_0);_macro_tmp_64_1++){funcs{_macro_tmp_64_0[_macro_tmp_64_1]}=true;}};
parse_extension_method_attrib(gen,"string",k,v,false,0,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>13&&array_extract(k,1,12)=="method_Hash_"){
if(!funcs){var _macro_tmp_66_0=[];script_query(script_name,null,null,null,_macro_tmp_66_0);funcs={};for(var _macro_tmp_66_1=0;_macro_tmp_66_1<length(_macro_tmp_66_0);_macro_tmp_66_1++){funcs{_macro_tmp_66_0[_macro_tmp_66_1]}=true;}};
parse_extension_method_attrib(gen,"hash",k,v,false,1|2,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>8&&array_extract(k,1,7)=="method_"){
match=true;
}
break;

case 'stat':
if(length(k)>14&&array_extract(k,1,13)=="static_Array_"){
if(!funcs){var _macro_tmp_68_0=[];script_query(script_name,null,null,null,_macro_tmp_68_0);funcs={};for(var _macro_tmp_68_1=0;_macro_tmp_68_1<length(_macro_tmp_68_0);_macro_tmp_68_1++){funcs{_macro_tmp_68_0[_macro_tmp_68_1]}=true;}};
parse_extension_method_attrib(gen,"array",k,v,true,2,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>15&&array_extract(k,1,14)=="static_String_"){
if(!funcs){var _macro_tmp_70_0=[];script_query(script_name,null,null,null,_macro_tmp_70_0);funcs={};for(var _macro_tmp_70_1=0;_macro_tmp_70_1<length(_macro_tmp_70_0);_macro_tmp_70_1++){funcs{_macro_tmp_70_0[_macro_tmp_70_1]}=true;}};
parse_extension_method_attrib(gen,"string",k,v,true,0,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>13&&array_extract(k,1,12)=="static_Hash_"){
if(!funcs){var _macro_tmp_72_0=[];script_query(script_name,null,null,null,_macro_tmp_72_0);funcs={};for(var _macro_tmp_72_1=0;_macro_tmp_72_1<length(_macro_tmp_72_0);_macro_tmp_72_1++){funcs{_macro_tmp_72_0[_macro_tmp_72_1]}=true;}};
parse_extension_method_attrib(gen,"hash",k,v,true,1|2,funcs,(list_tokens[list_off+TOK_line]));
break;
}
if(length(k)>8&&array_extract(k,1,7)=="static_"){
match=true;
}
break;

case 'oper':
if(length(k)>10&&array_extract(k,1,9)=="operator_"){
match=true;
}
break;
}
if(match){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": undefined class in attribute ",k," in ",script_name,".fix"});
}
}
}
}
var import_functions=hash_get(functions,import_fname,null);
if(import_functions){
for(var i=0;i<length(import_functions);i++){
var(k,v)=hash_entry(import_functions,i);
if((v->FUNC_flags&FUNC_FLAG_PRIVATE==0)&&!hash_contains(gen->GEN_imported_functions,k)){
gen->GEN_imported_functions{k}=v;
}
}
}
var import_static_functions=hash_get(static_functions,import_fname,null);
if(import_static_functions){
if(!gen->GEN_imported_static_functions){
gen->GEN_imported_static_functions={};
}
for(var i=0;i<length(import_static_functions);i++){
var(k,v)=hash_entry(import_static_functions,i);
if((v->FUNC_flags&FUNC_FLAG_PRIVATE==0)&&!hash_contains(gen->GEN_imported_static_functions,k)){
gen->GEN_imported_static_functions{k}=v;
}
}
}
var import_instance_functions=hash_get(instance_functions,import_fname,null);
if(import_instance_functions){
if(!gen->GEN_imported_instance_functions){
gen->GEN_imported_instance_functions={};
}
for(var i=0;i<length(import_instance_functions);i++){
var(k,v)=hash_entry(import_instance_functions,i);
if((v->FUNC_flags&FUNC_FLAG_PRIVATE==0)&&!hash_contains(gen->GEN_imported_instance_functions,k)){
gen->GEN_imported_instance_functions{k}=v;
}
}
}
var import_locals=hash_get(locals,import_fname,null);
if(import_locals){
for(var i=0;i<length(import_locals);i++){
var(k,v)=hash_entry(import_locals,i);
if(!v->LOCAL_private){
if(!gen->GEN_imported_locals){
gen->GEN_imported_locals={};
}
if(!hash_contains(gen->GEN_imported_locals,k)){
gen->GEN_imported_locals{k}=v;
}
}
}
}
break;
}

case KW_CONST:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('@'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}
if((list_tokens[list_off])==TOK_IDENT){
var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='='){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('='),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off])==TOK_IDENT){
var alias=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var ia=gen->GEN_import_aliases?hash_get(gen->GEN_import_aliases,alias,null):null;
if(!ia){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown import alias"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var type=hash_get(ia->IMPORT_ALIAS_consts,array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]),-1);
if(type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown constant name"});
}
gen->GEN_consts{name}=type;
}
else{
list_off-=TOK_SIZE;;
var type=hash_get(gen->GEN_consts,array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]),-1);
if(type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown constant name"});
}
gen->GEN_consts{name}=type;
}
}
else if((list_tokens[list_off])==TOK_STRING){
gen->GEN_consts{name}=TYPE_STRING;
}
else if((list_tokens[list_off])=='+'||(list_tokens[list_off])=='-'){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off])==TOK_FLOAT_NUMBER){
gen->GEN_consts{name}=TYPE_FLOAT;
}
else{
gen->GEN_consts{name}=TYPE_INTEGER;
}
}
else if((list_tokens[list_off])==TOK_FLOAT_NUMBER){
gen->GEN_consts{name}=TYPE_FLOAT;
}
else{
gen->GEN_consts{name}=TYPE_INTEGER;
}
}
else if((list_tokens[list_off]===('{'))){
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===('@'))){
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
gen->GEN_consts{name}=TYPE_INTEGER;
while(((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off]===(',')))break;
if((list_tokens[list_off]===('}')))break;
}
if((list_tokens[list_off]===('}')))break;
}
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
break;
}

case KW_VAR:{
if(!parse_locals){
parse_locals=[];
}
for(;;){
var local=object_create(LOCAL_SIZE);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('@'))){
local->LOCAL_private=true;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
local->LOCAL_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var _macro_tmp_131_0=gen->GEN_result_tokens;var _macro_tmp_131_1=length(_macro_tmp_131_0);var _macro_tmp_131_2=list_off-gen->GEN_last_result_pos;array_set_length(_macro_tmp_131_0,_macro_tmp_131_1+_macro_tmp_131_2);array_copy(_macro_tmp_131_0,_macro_tmp_131_1,list_tokens,gen->GEN_last_result_pos,_macro_tmp_131_2);gen->GEN_last_result_pos=list_off;;;
local->LOCAL_type=[];
var start=(list_off)+TOK_SIZE;
var level=0;
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
switch((list_tokens[list_off])){
case '{','(','[':level++;continue;
case '}',')',']':level--;continue;
case ',',';':if(level==0)break;continue;
default:continue;
}
break;
}
var end=(list_off);
if(end-start==0){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": missing type"});
}
array_append(local->LOCAL_type,list_tokens,start,end-start);
gen->GEN_last_result_pos=list_off;;;
}
parse_locals[]=local;
if((list_tokens[list_off]===(',')))continue;
break;
}
list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
break;
}

case TOK_IDENT:
if((list_tokens[list_off+TOK_len]===length("class")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("class"))){
list_off=skip_class(gen,list_tokens,list_src,list_off,false);;
continue;
}
if((list_tokens[list_off+TOK_len]===length("struct")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("struct"))){
list_off=skip_class(gen,list_tokens,list_src,list_off,true);;
continue;
}
if((list_tokens[list_off+TOK_len]===length("static")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("static"))){
var _macro_tmp_155_0=gen->GEN_result_tokens;var _macro_tmp_155_1=length(_macro_tmp_155_0);var _macro_tmp_155_2=list_off-gen->GEN_last_result_pos;array_set_length(_macro_tmp_155_0,_macro_tmp_155_1+_macro_tmp_155_2);array_copy(_macro_tmp_155_0,_macro_tmp_155_1,list_tokens,gen->GEN_last_result_pos,_macro_tmp_155_2);gen->GEN_last_result_pos=list_off;;;
list_off=skip_function(gen,list_tokens,list_src,list_off,null,FUNC_FLAG_EXTENSION|FUNC_FLAG_STATIC);;
list_off+=TOK_SIZE;;
gen->GEN_last_result_pos=list_off;;;
list_off-=TOK_SIZE;;
continue;
}
break;

case KW_FUNCTION:{
var _macro_tmp_163_0=gen->GEN_result_tokens;var _macro_tmp_163_1=length(_macro_tmp_163_0);var _macro_tmp_163_2=list_off-gen->GEN_last_result_pos;array_set_length(_macro_tmp_163_0,_macro_tmp_163_1+_macro_tmp_163_2);array_copy(_macro_tmp_163_0,_macro_tmp_163_1,list_tokens,gen->GEN_last_result_pos,_macro_tmp_163_2);gen->GEN_last_result_pos=list_off;;;
list_off-=TOK_SIZE;;
list_off=skip_function(gen,list_tokens,list_src,list_off,null,0);;
list_off+=TOK_SIZE;;
gen->GEN_last_result_pos=list_off;;;
list_off-=TOK_SIZE;;
continue;
}
}
}

if(parse_locals){
for(var i=0;i<length(parse_locals);i++){
parse_local(gen,src,parse_locals[i]);
}
}

var _macro_tmp_172_0=gen->GEN_result_tokens;var _macro_tmp_172_1=length(_macro_tmp_172_0);var _macro_tmp_172_2=list_off-gen->GEN_last_result_pos;array_set_length(_macro_tmp_172_0,_macro_tmp_172_1+_macro_tmp_172_2);array_copy(_macro_tmp_172_0,_macro_tmp_172_1,list_tokens,gen->GEN_last_result_pos,_macro_tmp_172_2);gen->GEN_last_result_pos=list_off;;;

var parse_classes=gen->GEN_parse_classes;
for(var i=0;i<length(parse_classes);i+=2){
list_off=parse_classes[i];;
parse_class(gen,list_tokens,list_src,list_off,parse_classes[i+1]);
}
array_clear(parse_classes);

var parse_funcs=gen->GEN_parse_funcs;
for(var i=0;i<length(parse_funcs);i+=3){
list_off=parse_funcs[i];;
var func=parse_funcs[i+2];
if(func->FUNC_flags&FUNC_FLAG_EXTENSION){
if(func->EXTENFUNC_kind=="array"){
parse_type_allow_generics=2;
}
else if(func->EXTENFUNC_kind=="hash"){
parse_type_allow_generics=1|2;
}
var(r,e)=parse_function(gen,list_tokens,list_src,list_off,parse_funcs[i+1],func);
parse_type_allow_generics=0;
if(e)return 0,e;
}
else{
parse_function(gen,list_tokens,list_src,list_off,parse_funcs[i+1],func);
}
}
array_clear(parse_funcs);
}

function@parse_class_attrib(gen,import_fname,name,value,class_attribs,line)
{
if(!class_attribs){
class_attribs={};
}

var map={};
var parts=string_split(value,',');
for(var i=0;i<length(parts);i++){
var parts2=string_split(parts[i],'=');
if(length(parts2)!=2){
return 0,error({script_line(line),": invalid value for class attribute ",name});
}
map{parts2[0]}=parts2[1];
}

var class=object_create(CLASS_SIZE);
class->CLASS_ext_type=EXT_TYPE_CLASS;
class->CLASS_name=name;
class->CLASS_fields={};
class->CLASS_functions={};

var class_map=hash_get(classes,import_fname,null);
if(!class_map){
class_map={};
classes{import_fname}=class_map;
}
class_map{name}=class;

var prefix=hash_get(map,"prefix",null);
class->CLASS_method_prefix=prefix?{prefix,"_"}:get_method_prefix(class->CLASS_name);

var struct=hash_get(map,"struct",null);
class->CLASS_compat_name=struct?struct:get_class_compat_name(prefix?prefix:class->CLASS_name);

gen->GEN_imported_classes{class->CLASS_name}=class;

map{0}=class;
class_attribs{class->CLASS_name}=map;
return class_attribs;
}

function@finish_class_attribs(gen,class_attribs,consts,funcs)
{
var sorted=[];

for(var i=0;i<length(class_attribs);i++){
var(name,map)=hash_entry(class_attribs,i);
var class=map{0};

var extend=hash_get(map,"extend",null);
if(extend){
class->CLASS_parent=find_class(gen,extend);
}

var struct={class->CLASS_compat_name,"_"};
for(var j=0;j<length(consts);j++){
var(k,v)=hash_entry(consts,j);
if(k[0]=='@')continue;

if(length(k)>length(struct)&&array_extract(k,0,length(struct))==struct){
var field_name=string_const(k,length(struct),length(k)-length(struct));
if(field_name=="SIZE")continue;

var field=object_create(FIELD_SIZE);
field->FIELD_name=field_name;
field->FIELD_compat_name=k;
field->FIELD_type=TYPE_DYNAMIC;
class->CLASS_fields{field_name}=field;
}
}

var static=hash_get(map,"static",null);
var static_funcs={};
if(static){
var list=string_split(static,':');
for(var j=0;j<length(list);j++){
static_funcs{list[j]}=true;
}
}

var prefix=class->CLASS_method_prefix;
for(var j=0;j<length(funcs);j++){
var(func_name,unused)=hash_entry(funcs,j);
if(length(func_name)>length(prefix)&&array_extract(func_name,0,length(prefix))==prefix){
func_name=array_extract(func_name,length(prefix),length(func_name)-length(prefix));
var func_name2;
var num_params=0;
for(var k=length(func_name)-1;k>=0;k--){
if(func_name[k]=='#'){
func_name2=string_const(func_name,0,k);
num_params=string_parse_int(func_name,k+1,length(func_name)-k-1);
break;
}
}

var func=object_create(FUNC_SIZE);
func->FUNC_name=func_name2;
func->FUNC_flags=hash_contains(static_funcs,func_name)?FUNC_FLAG_STATIC:0;
func->FUNC_params={};
for(var k=0;k<num_params;k++){
func->FUNC_params{string_const({"p",k})}=TYPE_DYNAMIC;
}
func->FUNC_return_type=TYPE_DYNAMIC;

class->CLASS_functions{string_const(func_name)}=func;
}
}

var inserted=false;
for(var j=0;j<length(sorted);j++){
if(length(name)>length(sorted[j])){
array_insert(sorted,j,name);
inserted=true;
break;
}
}
if(!inserted){
sorted[]=name;
}
}

var new_attribs={};
for(var i=0;i<length(sorted);i++){
var name=sorted[i];
new_attribs{name}=class_attribs{name};
}

return new_attribs;
}

function@get_class_from_attribs(class_attribs,cls_name)
{
var attribs=hash_get(class_attribs,cls_name,null);
if(attribs){
return attribs{0};
}
return null;
}

function@adjust_field_attrib_error(fname,line,error,cls_name,field_name)
{
var prefix={fname,"(-1): "};
var msg=error[0];
if(length(msg)>length(prefix)&&array_extract(msg,0,length(prefix))==prefix){
array_replace_range(msg,0,length(prefix)-2,script_line(line));
array_append(msg,{" (for field attribute ",field_name," in ",cls_name,")"});
}
return error;
}

function@parse_field_attrib(gen,cls_name,field_name,value,class_attribs,line)
{
var src={""};
var tokens=tokens_parse([],src,value,-1);
var list_tokens=tokens,list_src=src,list_off=-4;;
var(type,pos)=parse_type_func(gen,list_tokens,list_src,list_off,false,false);
if(!is_int(pos))return 0,pos;
if(pos!=length(tokens)){
return 0,error({script_line(line),": parse error in field attribute ",field_name," in ",cls_name});
}
var class=get_class_from_attribs(class_attribs,cls_name);
if(!class){

return 0,error({script_line(line),": class not found for field attribute ",field_name," in ",cls_name});
}
var field=hash_get(class->CLASS_fields,field_name,null);
if(!field){
return 0,error({script_line(line),": no field found for attribute ",field_name," in ",cls_name});
}
field->FIELD_type=type;
}

function@adjust_method_attrib_error(fname,line,error,cls_name,method_name)
{
var prefix={fname,"(-1): "};
var msg=error[0];
if(length(msg)>length(prefix)&&array_extract(msg,0,length(prefix))==prefix){
array_replace_range(msg,0,length(prefix)-2,script_line(line));
if(cls_name){
array_append(msg,{" (for method attribute ",method_name," in ",cls_name,")"});
}
else{
array_append(msg,{" (for global function attribute ",method_name,")"});
}
}
return error;
}

function@parse_method_attrib(gen,cls_name,method_name,value,class_attribs,is_static,is_extension,funcs,line)
{
var src={""};
var tokens=tokens_parse([],src,value,-1);
var list_tokens=tokens,list_src=src,list_off=-4;;

var param_types=[];
var ret_type=TYPE_DYNAMIC;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(')'))){
list_off-=TOK_SIZE;;
for(;;){
var(type,pos)=parse_type_func(gen,list_tokens,list_src,list_off,false,true);
if(!is_int(pos))return 0,pos;
list_off=pos;;
param_types[]=type;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(')')))break;
if((list_tokens[list_off]===(','))){
continue;
}
if(cls_name){
return 0,error({script_line(line),": parse error in method attribute ",method_name," in ",cls_name});
}
else{
return 0,error({script_line(line),": parse error in global function attribute ",method_name});
}
}
}
if(((list_off+=TOK_SIZE)<length(list_tokens))){
list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};

var(type,pos)=parse_type_func(gen,list_tokens,list_src,list_off,true,false);
if(!is_int(pos))return 0,pos;
list_off=pos;;
ret_type=type;
}

if((list_off)!=length(tokens)){
if(cls_name){
return 0,error({script_line(line),": parse error in method attribute ",method_name," in ",cls_name});
}
else{
return 0,error({script_line(line),": parse error in global function attribute ",method_name});
}
}

var func;

if(cls_name){
if(is_extension){
func=object_create(EXTENFUNC_SIZE);
func->FUNC_params={};
}
else{
var class=get_class_from_attribs(class_attribs,cls_name);
if(!class){

return 0,error({script_line(line),": class not found for method attribute ",method_name," in ",cls_name});
}
func=hash_get(class->CLASS_functions,method_name,null);
if(!func){
return 0,error({script_line(line),": method not found for method attribute ",method_name," in ",cls_name});
}
}
}
else{
if(!hash_contains(funcs,method_name)){
return 0,error({script_line(line),": global function not found for attribute ",method_name});
}
func=object_create(FUNC_SIZE);
func->FUNC_params={};
if(!hash_contains(gen->GEN_imported_functions,method_name)){
gen->GEN_imported_functions{method_name}=func;
}
}

var declared_num_params=-1;
for(var i=length(method_name)-1;i>=0;i--){
if(method_name[i]=='#'){
declared_num_params=string_parse_int(method_name,i+1,length(method_name)-i-1);
}
}

if(is_static){
func->FUNC_flags|=FUNC_FLAG_STATIC;
}
if((func->FUNC_flags&FUNC_FLAG_STATIC)==0){
array_insert(param_types,0,TYPE_DYNAMIC);
}
if(cls_name){
if(length(param_types)!=declared_num_params||(!is_extension&&length(param_types)!=length(func->FUNC_params))){
return 0,error({script_line(line),": incorrect number of parameters in method attribute ",method_name," in ",cls_name});
}
}
else{
if(length(param_types)!=declared_num_params){
return 0,error({script_line(line),": incorrect number of parameters in global function attribute ",method_name});
}
}
for(var i=0;i<length(param_types);i++){
func->FUNC_params{string_const({"p",i})}=param_types[i];
}
func->FUNC_return_type=ret_type;
return func;
}

function@parse_extension_method_attrib(gen,kind,attrib_name,attrib_value,is_static,allow_generics,funcs,line)
{
var cnt=0;
var class_idx=-1;
var func_idx=-1;
for(var i=0;i<length(attrib_name);i++){
if(attrib_name[i]=='_'){
cnt++;
if(cnt==1){
class_idx=i+1;
}
if(cnt==2){
func_idx=i+1;
break;
}
}
}
var cls_name=array_extract(attrib_name,class_idx,func_idx-class_idx-1);
var func_name=array_extract(attrib_name,func_idx,length(attrib_name)-func_idx);
for(var i=length(func_name)-1;i>=0;i--){
if(func_name[i]=='_'){
func_name[i]='#';
break;
}
}
parse_type_allow_generics=allow_generics;
var(func,e)=parse_method_attrib(gen,cls_name,func_name,attrib_value,null,is_static,true,funcs,line);
parse_type_allow_generics=0;
if(e){
return 0,adjust_method_attrib_error(gen->GEN_fname,line,e,cls_name,func_name);
}

var full_name={kind,"_",func_name};
var plain_name={full_name};
for(var i=length(plain_name)-1;i>=0;i--){
if(plain_name[i]=='#'){
array_set_length(plain_name,i);
break;
}
}

func->FUNC_name=plain_name;
func->FUNC_flags|=FUNC_FLAG_EXTENSION;
func->EXTENFUNC_kind=kind;

if(is_static){
if(!gen->GEN_imported_static_functions){
gen->GEN_imported_static_functions={};
}
if(!hash_contains(gen->GEN_imported_static_functions,full_name)){
gen->GEN_imported_static_functions{full_name}=func;
}
}
else{
if(!gen->GEN_imported_instance_functions){
gen->GEN_imported_instance_functions={};
}
if(!hash_contains(gen->GEN_imported_instance_functions,full_name)){
gen->GEN_imported_instance_functions{full_name}=func;
}
}
}

function@adjust_operator_attrib_error(fname,line,error,cls_name,op_name)
{
var prefix={fname,"(-1): "};
var msg=error[0];
if(length(msg)>length(prefix)&&array_extract(msg,0,length(prefix))==prefix){
array_replace_range(msg,0,length(prefix)-2,script_line(line));
array_append(msg,{" (for operator attribute ",op_name," in ",cls_name,")"});
}
return error;
}

function@parse_operator_attrib(gen,cls_name,op_name,value,class_attribs,funcs,line)
{
var class=get_class_from_attribs(class_attribs,cls_name);
if(!class){
return 0,error({script_line(line),": class not found for operator attribute ",op_name," in ",cls_name});
}
if(length(op_name)==0){
return 0,error({script_line(line),": empty operator name for operator attribute in ",cls_name});
}

var prio=-1;
var ret_type=class;
var single_param=false;

switch(op_name[0]){
case 'a':
if(op_name=="add"){prio=PRIO_ADDITIVE_ADD;break;}
if(op_name=="and"){prio=PRIO_BITWISE_AND;break;}
if(op_name=="add_inplace"){prio=PRIO_SPECIAL_ADD_INPLACE;single_param=true;break;}
if(op_name=="and_inplace"){prio=PRIO_SPECIAL_AND_INPLACE;single_param=true;break;}
break;

case 'c':
if(op_name=="cmp"){prio=PRIO_SPECIAL_COMPARE;ret_type=TYPE_INTEGER;break;}
break;

case 'd':
if(op_name=="div"){prio=PRIO_MULTIPLICATIVE_DIV;break;}
if(op_name=="div_inplace"){prio=PRIO_SPECIAL_DIV_INPLACE;single_param=true;break;}
break;

case 'e':
if(op_name=="eq"){prio=PRIO_EQUALITY_EQ_VALUE;ret_type=TYPE_BOOLEAN;break;}
break;

case 'g':
if(op_name=="gt"){prio=PRIO_COMPARISON_GT;ret_type=TYPE_BOOLEAN;break;}
if(op_name=="ge"){prio=PRIO_COMPARISON_GE;ret_type=TYPE_BOOLEAN;break;}
break;

case 'l':
if(op_name=="lt"){prio=PRIO_COMPARISON_LT;ret_type=TYPE_BOOLEAN;break;}
if(op_name=="le"){prio=PRIO_COMPARISON_LE;ret_type=TYPE_BOOLEAN;break;}
break;

case 'm':
if(op_name=="mul"){prio=PRIO_MULTIPLICATIVE_MUL;break;}
if(op_name=="mul_inplace"){prio=PRIO_SPECIAL_MUL_INPLACE;single_param=true;break;}
break;

case 'n':
if(op_name=="ne"){prio=PRIO_EQUALITY_NE_VALUE;ret_type=TYPE_BOOLEAN;break;}
break;

case 'o':
if(op_name=="or"){prio=PRIO_BITWISE_OR;break;}
if(op_name=="or_inplace"){prio=PRIO_SPECIAL_OR_INPLACE;single_param=true;break;}
break;

case 'r':
if(op_name=="rem"){prio=PRIO_MULTIPLICATIVE_REM;break;}
if(op_name=="rem_inplace"){prio=PRIO_SPECIAL_REM_INPLACE;single_param=true;break;}
break;

case 's':
if(op_name=="sub"){prio=PRIO_ADDITIVE_SUB;break;}
if(op_name=="shl"){prio=PRIO_BITWISE_SHL;break;}
if(op_name=="shr"){prio=PRIO_BITWISE_SHR;break;}
if(op_name=="sub_inplace"){prio=PRIO_SPECIAL_SUB_INPLACE;single_param=true;break;}
if(op_name=="shl_inplace"){prio=PRIO_SPECIAL_SHL_INPLACE;single_param=true;break;}
if(op_name=="shr_inplace"){prio=PRIO_SPECIAL_SHR_INPLACE;single_param=true;break;}
break;

case 'u':
if(op_name=="ushr"){prio=PRIO_BITWISE_USHR;break;}
if(op_name=="ushr_inplace"){prio=PRIO_SPECIAL_USHR_INPLACE;single_param=true;break;}
break;

case 'x':
if(op_name=="xor"){prio=PRIO_BITWISE_XOR;break;}
if(op_name=="xor_inplace"){prio=PRIO_SPECIAL_XOR_INPLACE;single_param=true;break;}
break;
}

if(prio==-1){
return 0,error({script_line(line),": unknown operator name for operator attribute ",op_name," in ",cls_name});
}

var src={""};
var tokens=tokens_parse([],src,value,-1);
var list_tokens=tokens,list_src=src,list_off=-4;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var op1_type,op2_type,pos;
if(single_param){
op1_type=class;
}
else{
(op1_type,pos)=parse_type_func(gen,list_tokens,list_src,list_off,false,false);
if(!is_int(pos))return 0,pos;
list_off=pos;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};
}
(op2_type,pos)=parse_type_func(gen,list_tokens,list_src,list_off,false,false);
if(!is_int(pos))return 0,pos;
list_off=pos;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if((list_off)+TOK_SIZE!=length(tokens)){
return 0,error({script_line(line),": parse type error for operator attribute ",op_name," in ",cls_name});
}
if(op1_type!==class&&op2_type!==class){
return 0,error({script_line(line),": at least one operand must be the owner class type for operator attribute ",op_name," in ",cls_name});
}

func_name={class->CLASS_method_prefix,func_name};
if(!hash_contains(funcs,{func_name,"#2"})){
return 0,error({script_line(line),": function ",func_name," not found for operator attribute ",op_name," in ",cls_name});
}

if(!class->CLASS_operators){
class->CLASS_operators={};
}
if(register_operator(class->CLASS_operators,prio,op1_type,op2_type,ret_type,func_name,false,false)){
return 0,error({script_line(line),": duplicate operator attribute ",op_name," in ",cls_name});
}

register_operator(gen->GEN_imported_operators,prio,op1_type,op2_type,ret_type,func_name,false,true);

if(prio==PRIO_SPECIAL_COMPARE){
register_compare_operators(class->CLASS_operators,op1_type,op2_type,func_name);
register_compare_operators(gen->GEN_imported_operators,op1_type,op2_type,func_name);
}
}

function@process_float_shorthands(tokens,src)
{
for(var i=length(tokens)-TOK_SIZE;i>=0;i-=TOK_SIZE){
switch(tokens[i]){
case '+=f':
case '-=f':
case '*=f':
case '/=f':{
var var_name=null;
var after="";
var remove_semicolon=false;
var token_before=tokens[i-TOK_SIZE];
switch(token_before){
case TOK_IDENT:
if(tokens[i-TOK_SIZE*2]=='->'){
var outer_var={"__classes_tmp_",tmp_cnt++};
var field_name=array_extract(src,tokens[i-TOK_SIZE+TOK_off],tokens[i-TOK_SIZE+TOK_len]);

var start_pos=find_shorthand_start(tokens,src,i-TOK_SIZE*2);
if(start_pos==i-TOK_SIZE*3&&tokens[i-TOK_SIZE*3]==TOK_IDENT){
var outer_name=array_extract(src,tokens[i-TOK_SIZE*3+TOK_off],tokens[i-TOK_SIZE*3+TOK_len]);
var_name={outer_name,"->",field_name};
}
else{
var new_tokens=tokens_parse([],src,{"{var ",outer_var,"="},tokens[i+TOK_line]);
array_insert_array(tokens,start_pos,new_tokens);
i+=length(new_tokens);

array_clear(new_tokens);
tokens_parse(new_tokens,src,{";",outer_var},tokens[i+TOK_line]);
array_insert_array(tokens,i-TOK_SIZE*2,new_tokens);
i+=length(new_tokens);

var_name={outer_var,"->",field_name};
after=";}";
remove_semicolon=true;
}
}
else{
var off=i-TOK_SIZE;
var_name=array_extract(src,tokens[off+TOK_off],tokens[off+TOK_len]);
}
break;

case ']':
case '}':{
var is_hash=token_before=='}';
var outer_var={"__classes_tmp_",tmp_cnt++};
var index_var={"__classes_tmp_",tmp_cnt++};
var index_start=find_shorthand_index_start(tokens,src,i);
var start_pos=find_shorthand_start(tokens,src,index_start);

var new_tokens=tokens_parse([],src,{"{var ",outer_var,"="},tokens[i+TOK_line]);
array_insert_array(tokens,start_pos,new_tokens);
index_start+=length(new_tokens);
i+=length(new_tokens);

array_clear(new_tokens);
tokens_parse(new_tokens,src,{",",index_var,"="},tokens[i+TOK_line]);
array_insert_array(tokens,index_start,new_tokens);
i+=length(new_tokens);
array_remove(tokens,i-TOK_SIZE,TOK_SIZE);
array_remove(tokens,index_start+TOK_SIZE*3,TOK_SIZE);
i-=TOK_SIZE*2;

array_clear(new_tokens);
tokens_parse(new_tokens,src,{";",outer_var,is_hash?"{":"[",index_var,is_hash?"}":"]"},tokens[i+TOK_line]);
array_insert_array(tokens,i,new_tokens);
i+=length(new_tokens);

var_name={outer_var,is_hash?"{":"[",index_var,is_hash?"}":"]"};
after=";}";
remove_semicolon=true;
break;
}

default:
return 0,error({script_line(tokens[i+TOK_line]),": invalid assignment destination"});
break;
}

var end_pos=find_shorthand_end(tokens,src,i);
var off=length(src);

if(remove_semicolon&&tokens[end_pos]==';'){
array_remove(tokens,end_pos,TOK_SIZE);
}

var append=tokens_parse([],src,{")}",after},tokens[end_pos-TOK_SIZE+TOK_line]);
array_insert_array(tokens,end_pos,append);

var s={"={(",var_name,")"};
s[]=tokens[i]&0xFF;
s[]='(';
var prepend=tokens_parse([],src,s,tokens[i+TOK_line]);
array_replace_range(tokens,i,i+TOK_SIZE,prepend);
break;
}
}
}
}

function@find_shorthand_start(tokens,src,i)
{
var level=0;
i-=TOK_SIZE;
for(;i>=0;i-=TOK_SIZE){
switch(tokens[i]){
case ')','}',']':
level++;
break;
case '(','{','[':
if(level==0){
return i+TOK_SIZE;
}
level--;
break;
case TOK_IDENT:
case '->':
continue;
default:
if(level==0){
return i+TOK_SIZE;
}
}
}
return 0;
}

function@find_shorthand_index_start(tokens,src,i)
{
var level=0;
for(;i>=0;i-=TOK_SIZE){
switch(tokens[i]){
case ')','}',']':
level++;
break;
case '(','{','[':
if(level==1){
return i;
}
level--;
break;
}
}
return 0,error("shouldn't happen");
}

function@find_shorthand_end(tokens,src,i)
{
var level=0;
i+=TOK_SIZE;
for(;i<length(tokens);i+=TOK_SIZE){
switch(tokens[i]){
case '(','{','[':
level++;
break;
case ')','}',']':
if(level==0){
return i;
}
level--;
break;
case ',',';':
if(level==0){
return i;
}
break;
}
}
return i;
}

function@string_split(s,c)
{
var result=[];
var last=0;
for(var i=0;i<length(s);i++){
if(s[i]==c){
result[]=array_extract(s,last,i-last);
last=i+1;
}
}
if(last<length(s)){
result[]=array_extract(s,last,length(s)-last);
}
return result;
}

function@get_class_compat_name(name)
{
var s={""};
for(var i=0;i<length(name);i++){
var c=name[i];
switch(c){
case 'a'..'z':
s[]=c-'a'+'A';
continue;
default:
s[]=c;
continue;
}
}
return s;
}

function@get_method_prefix(name)
{
var s={""};
for(var i=0;i<length(name);i++){
var c=name[i];
switch(c){
case 'A'..'Z':
if(i>0){
if((i+1<length(name)&&name[i+1]>='a'&&name[i+1]<='z')){
var c1=i>=2?name[i-2]:0;
var c2=i>=1?name[i-1]:0;
var match1=(c1==0||(c1>='a'&&c1<='z'));
var match2=(c2>='A'&&c2<='Z');
if(!match1||!match2){
s[]='_';
}
}
else if((name[i-1]>='a'&&name[i-1]<='z')){
s[]='_';
}
}
s[]=c-'A'+'a';
break;

default:
s[]=c;
break;
}
}
s[]='_';
return s;
}

function@find_class(gen,name)
{
var cls=hash_get(gen->GEN_classes,name,null);
if(!cls){
cls=hash_get(gen->GEN_imported_classes,name,null);
}
return cls;
}

function@find_function(gen,name)
{
var func=hash_get(gen->GEN_functions,name,null);
if(!func){
func=hash_get(gen->GEN_imported_functions,name,null);
if(!func){
func=hash_get(builtin_functions,name,null);
}
}
return func;
}



























function@parse_type_func(gen,list_tokens,list_src,list_off,allow_void,allow_multiple)
{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
var(ret,pos)=parse_type_inner(gen,list_tokens,list_src,list_off,allow_void,allow_multiple);
return ret,pos;
}

function@parse_type_inner(gen,list_tokens,list_src,list_off,allow_void,allow_multiple)
{
var line=(list_tokens[list_off+TOK_line]);
var type=-1;

var tok_type=list_tokens[list_off];
if(tok_type=='['){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
var struct_type=TYPE_DYNAMIC;
if(name!="Dynamic"){
struct_type=find_class(gen,name);
if(!struct_type){
return 0,error({script_line(line),": can't find struct ",name});
}
if(struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){
return 0,error({script_line(line),": must be struct"});
}
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};

type=create_array_type(struct_type);
type->ARRAY_ext_type=EXT_TYPE_STRUCT_ARRAY;
}
else{
if(tok_type!=TOK_IDENT){
return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected identifier"});
}

var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
switch(length(name)){
case 3:
if(name=="Key"&&(parse_type_allow_generics&1)){
type=TYPE_KEY;
break;
}
break;

case 4:
if(name=="Void"){
if(!allow_void){
return 0,error({script_line(line),": type Void not allowed"});
}
type=TYPE_VOID;
break;
}
if(name=="Byte"){type=TYPE_INTEGER;break;}
break;

case 5:
if(name=="Float"){type=TYPE_FLOAT;break;}
if(name=="Short"){type=TYPE_INTEGER;break;}
if(name=="Value"&&(parse_type_allow_generics&2)){
type=TYPE_VALUE;
break;
}
break;

case 6:
if(name=="String"){type=TYPE_STRING;break;}
break;

case 7:
if(name=="Integer"){type=TYPE_INTEGER;break;}
if(name=="Dynamic"){type=TYPE_DYNAMIC;break;}
if(name=="Boolean"){type=TYPE_BOOLEAN;break;}
break;
}
if(type==-1){
type=find_class(gen,name);
if(!type){
return 0,error({script_line(line),": can't find class ",name});
}
}
}

while(((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off])=='['){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(']'))){
if(type==TYPE_VOID){
return 0,error({script_line(line),": can't create array of Void"});
}
type=create_array_type(type);
continue;
}
list_off-=TOK_SIZE;;
if(type==TYPE_VOID){
return 0,error({script_line(line),": can't create hash table with Void type"});
}
var index_type;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_234_0,_macro_tmp_234_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_234_1))return 0,_macro_tmp_234_1;list_off=_macro_tmp_234_1;;index_type=_macro_tmp_234_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};
type=create_hash_type(type,index_type);
continue;
}
list_off-=TOK_SIZE;;
break;
}

if(allow_multiple&&((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off]===TOK_IDENT&&(list_tokens[list_off+TOK_len]===length("or")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("or")))){
type=[EXT_TYPE_MULTIPLE,type];
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
var(ret,pos)=parse_type_inner(gen,list_tokens,list_src,list_off,allow_void,false);
if(!is_int(pos))return 0,pos;
list_off=pos;;
type[]=ret;
if(!((list_off+=TOK_SIZE)<length(list_tokens)))break;
if(!(list_tokens[list_off]===TOK_IDENT&&(list_tokens[list_off+TOK_len]===length("or")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("or")))){
list_off-=TOK_SIZE;;
break;
}
}
}
else{
list_off-=TOK_SIZE;;
}
}

return type,(list_off);
}

function@create_array_type(base_type)
{
var array=object_create(ARRAY_SIZE);
array->ARRAY_ext_type=EXT_TYPE_ARRAY;
array->ARRAY_base_type=base_type;
return array;
}

function@create_hash_type(base_type,index_type)
{
var hash=object_create(HASH_SIZE);
hash->HASH_ext_type=EXT_TYPE_HASH;
hash->HASH_base_type=base_type;
hash->HASH_index_type=index_type;
return hash;
}

function@parse_local(gen,src,local)
{
if(local->LOCAL_type){
var list_tokens=local->LOCAL_type,list_src=src,list_off=-4;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_259_0,_macro_tmp_259_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_259_1))return 0,_macro_tmp_259_1;list_off=_macro_tmp_259_1;;local->LOCAL_type=_macro_tmp_259_0;;;
if((list_off)!=length(list_tokens)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": invalid type declaration"});
}
}
else{
local->LOCAL_type=TYPE_DYNAMIC;
}
if(!gen->GEN_locals){
gen->GEN_locals={};
locals{gen->GEN_fname}=gen->GEN_locals;
}
gen->GEN_locals{local->LOCAL_name}=local;

var list=hash_get(locals,gen->GEN_fname,null);
if(!list){
list={};
locals{gen->GEN_fname}=list;
}
list{local->LOCAL_name}=local;
}

function@skip_class(gen,list_tokens,list_src,list_off,struct)
{
var _macro_tmp_268_0=gen->GEN_result_tokens;var _macro_tmp_268_1=length(_macro_tmp_268_0);var _macro_tmp_268_2=list_off-gen->GEN_last_result_pos;array_set_length(_macro_tmp_268_0,_macro_tmp_268_1+_macro_tmp_268_2);array_copy(_macro_tmp_268_0,_macro_tmp_268_1,list_tokens,gen->GEN_last_result_pos,_macro_tmp_268_2);gen->GEN_last_result_pos=list_off;;;
var start_pos=(list_off);

var class=object_create(CLASS_SIZE);
class->CLASS_ext_type=struct?EXT_TYPE_STRUCT:EXT_TYPE_CLASS;
class->CLASS_fields={};
class->CLASS_functions={};

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('@'))){
class->CLASS_private=true;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
class->CLASS_name=string_const(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
class->CLASS_compat_name=get_class_compat_name(class->CLASS_name);
class->CLASS_method_prefix=get_method_prefix(class->CLASS_name);

if(hash_contains(gen->GEN_classes,class->CLASS_name)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate class"});
}
gen->GEN_classes{class->CLASS_name}=class;

gen->GEN_parse_classes[]=(list_off);
gen->GEN_parse_classes[]=class;

var level=0;
var found_end=false;

while(((list_off+=TOK_SIZE)<length(list_tokens))){
var type=(list_tokens[list_off]);
if(type==TOK_IDENT&&(list_tokens[list_off+TOK_len])==5&&(list_src[list_tokens[list_off+TOK_off]])=='s'&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])=="super"){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(':'))){
list_off-=TOK_SIZE;;
var line=(list_tokens[list_off+TOK_line]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};

var num_params=0;
if((list_tokens[list_off]===(')'))){
list_off-=TOK_SIZE;;
}
else{
list_off-=TOK_SIZE;;
for(;;){
num_params++;
var _macro_tmp_301_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_301_0++;continue;case ')','}',']':if(!_macro_tmp_301_0)break;_macro_tmp_301_0--;continue;case ',',';':if(!_macro_tmp_301_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(',')))continue;
list_off-=TOK_SIZE;;
break;
}
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};

var name={func_name,"#",num_params+1};

if(!class->CLASS_supers){
class->CLASS_supers={};
}
if(!hash_contains(class->CLASS_supers,name)){
class->CLASS_supers{name}=line;
}
continue;
}
list_off-=TOK_SIZE;;
}

switch((list_tokens[list_off])){
case '{':
level++;
continue;

case '}':
if(--level==0){
found_end=true;
break;
}
continue;

default:
continue;
}
break;
}

if(!found_end){
list_off=start_pos;;
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unclosed ",struct?"struct":"class"});
}

list_off+=TOK_SIZE;;
gen->GEN_last_result_pos=list_off;;;
list_off-=TOK_SIZE;;
return(list_off);
}

function@parse_class(gen,list_tokens,list_src,list_off,class)
{
var line=(list_tokens[list_off+TOK_line]);

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var type;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_323_0,_macro_tmp_323_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_323_1))return 0,_macro_tmp_323_1;list_off=_macro_tmp_323_1;;type=_macro_tmp_323_0;;;
if(type->CLASS_ext_type!=class->CLASS_ext_type){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't mix between classes and structs when extending"});
}
class->CLASS_parent=type;
if(type->CLASS_generate_to_string){
class->CLASS_generate_to_string=true;
}
else if(has_object_script&&type->CLASS_name=="Object"){
class->CLASS_generate_to_string=true;
}
}
else{
list_off-=TOK_SIZE;;
}



var const_list_tokens=gen->GEN_const_tokens,const_list_src=list_src,const_list_off=-4;;
const_list_tokens[]=KW_CONST;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("const");const_list_tokens[]=line;var _macro_tmp_333_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_333_0+length("const"));array_copy(const_list_src,_macro_tmp_333_0,"const",0,length("const"));;;;
const_list_tokens[]='{';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("{");const_list_tokens[]=line;var _macro_tmp_335_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_335_0+length("{"));array_copy(const_list_src,_macro_tmp_335_0,"{",0,length("{"));;;
gen->GEN_first_const=(class->CLASS_parent!==null);

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};
list_off=parse_class_body(gen,list_tokens,list_src,list_off,class);;


var supers=class->CLASS_supers;
if(supers){
for(var i=0;i<length(supers);i++){
var(name,v)=hash_entry(supers,i);
var adj_name={""};
for(var j=0;j<length(name);j++){
if(name[j]=='#'){
adj_name[]='_';
adj_name[]='_';
continue;
}
adj_name[]=name[j];
}
var const_name={class->CLASS_compat_name,"__super__",adj_name};
const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(const_name);const_list_tokens[]=line;var _macro_tmp_341_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_341_0+length(const_name));array_copy(const_list_src,_macro_tmp_341_0,const_name,0,length(const_name));;;
if(gen->GEN_first_const){
const_list_tokens[]='=';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("=");const_list_tokens[]=line;var _macro_tmp_343_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_343_0+length("="));array_copy(const_list_src,_macro_tmp_343_0,"=",0,length("="));;;
var _macro_tmp_344_0={class->CLASS_parent->CLASS_compat_name,"_SIZE"};const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_344_0);const_list_tokens[]=line;var _macro_tmp_345_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_345_0+length(_macro_tmp_344_0));array_copy(const_list_src,_macro_tmp_345_0,_macro_tmp_344_0,0,length(_macro_tmp_344_0));;;
gen->GEN_first_const=false;
}
const_list_tokens[]=',';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(",");const_list_tokens[]=line;var _macro_tmp_347_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_347_0+length(","));array_copy(const_list_src,_macro_tmp_347_0,",",0,length(","));;;
}
}

var _macro_tmp_348_0={class->CLASS_compat_name,"_SIZE"};const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_348_0);const_list_tokens[]=line;var _macro_tmp_349_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_349_0+length(_macro_tmp_348_0));array_copy(const_list_src,_macro_tmp_349_0,_macro_tmp_348_0,0,length(_macro_tmp_348_0));;;
if(gen->GEN_first_const){
const_list_tokens[]='=';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("=");const_list_tokens[]=line;var _macro_tmp_351_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_351_0+length("="));array_copy(const_list_src,_macro_tmp_351_0,"=",0,length("="));;;
var _macro_tmp_352_0={class->CLASS_parent->CLASS_compat_name,"_SIZE"};const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_352_0);const_list_tokens[]=line;var _macro_tmp_353_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_353_0+length(_macro_tmp_352_0));array_copy(const_list_src,_macro_tmp_353_0,_macro_tmp_352_0,0,length(_macro_tmp_352_0));;;
}
const_list_tokens[]='}';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("}");const_list_tokens[]=line;var _macro_tmp_355_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_355_0+length("}"));array_copy(const_list_src,_macro_tmp_355_0,"}",0,length("}"));;;
const_list_tokens[]=';';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(";");const_list_tokens[]=line;var _macro_tmp_357_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_357_0+length(";"));array_copy(const_list_src,_macro_tmp_357_0,";",0,length(";"));;;

if(class->CLASS_generate_to_string){
var func=hash_get(class->CLASS_functions,"to_string#1",null);
if(func){
class->CLASS_generate_to_string=false;
}
else{
func=object_create(FUNC_SIZE);
func->FUNC_name="to_string";
func->FUNC_flags=FUNC_FLAG_VIRTUAL|FUNC_FLAG_OVERRIDE;
func->FUNC_params={"this":class};
func->FUNC_return_type=TYPE_STRING;
class->CLASS_functions{"to_string#1"}=func;
class->CLASS_virtual=true;

var short_name={class->CLASS_method_prefix,func->FUNC_name};
var func_name={short_name,"__vfunc"};
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",short_name,"_",length(func->FUNC_params)," = \"\";"},line);
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",func_name,"_",length(func->FUNC_params)," = \"",class->CLASS_name,".",func->FUNC_name,"\";"},line);

var prefix={class->CLASS_compat_name,"_"};
var s={"function @",func_name,"(this) {"};
var fields=class->CLASS_fields;
if(length(fields)>0){
array_append(s,{"var s = {\"",class->CLASS_name," {\\n  \"};"});
for(var i=0;i<length(fields);i++){
var(name,field)=hash_entry(fields,i);
var priv=field->FIELD_private?"@":"";
array_append(s,{"array_append(s, \"",priv,name,": \");"});
var type=field->FIELD_type;
if(is_int(type)){
switch(type){
case TYPE_DYNAMIC:
array_append(s,{"array_append(s, __classes_insert_prefix(to_string(this->",prefix,name,", true), \"  \"));"});
break;

case TYPE_INTEGER:
array_append(s,{"array_append(s, {this->",prefix,name,"});"});
break;

case TYPE_FLOAT:
array_append(s,{"array_append(s, {{this->",prefix,name," * 1.0}});"});
break;

case TYPE_BOOLEAN:
array_append(s,{"array_append(s, this->",prefix,name,"? \"true\":\"false\");"});
break;

case TYPE_STRING:
array_append(s,{"array_append(s, this->",prefix,name,"? @to_string(this->",prefix,name,") : \"null\");"});
break;

default:
return 0,error("unknown type");
}
}
else{
array_append(s,{"array_append(s, this->",prefix,name,"? __classes_insert_prefix(to_string(this->",prefix,name,", true), \"  \") : \"null\");"});
}
if(i<length(fields)-1){
array_append(s,"array_append(s, \",\\n  \");");
}
}
array_append(s,"array_append(s, \"\\n}\");");
array_append(s,"return s;");
}
else{
array_append(s,{"return \"",class->CLASS_name," {}\";"});
}
array_append(s,"}");
tokens_parse(gen->GEN_func_tokens,list_src,s,line);
}
}

if(class->CLASS_virtual){
append_vfunc_object_create(gen,list_src,class,line,false);
if(class->CLASS_parent){
append_vfunc_object_create(gen,list_src,class,line,true);
}
}

return(list_off);
}

function@append_vfunc_object_create(gen,list_src,class,line,extend)
{
var func_list_tokens=gen->GEN_func_tokens,func_list_src=list_src,func_list_off=-4;;
func_list_tokens[]=KW_FUNCTION;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("function");func_list_tokens[]=line;var _macro_tmp_362_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_362_0+length("function"));array_copy(func_list_src,_macro_tmp_362_0,"function",0,length("function"));;;;
func_list_tokens[]='@';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("@");func_list_tokens[]=line;var _macro_tmp_364_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_364_0+length("@"));array_copy(func_list_src,_macro_tmp_364_0,"@",0,length("@"));;;
if(extend){
var _macro_tmp_365_0={"vfunc__",class->CLASS_method_prefix,"_object_extend"};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_365_0);func_list_tokens[]=line;var _macro_tmp_366_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_366_0+length(_macro_tmp_365_0));array_copy(func_list_src,_macro_tmp_366_0,_macro_tmp_365_0,0,length(_macro_tmp_365_0));;;
}
else{
var _macro_tmp_367_0={"vfunc__",class->CLASS_method_prefix,"_object_create"};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_367_0);func_list_tokens[]=line;var _macro_tmp_368_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_368_0+length(_macro_tmp_367_0));array_copy(func_list_src,_macro_tmp_368_0,_macro_tmp_367_0,0,length(_macro_tmp_367_0));;;
}
func_list_tokens[]='(';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("(");func_list_tokens[]=line;var _macro_tmp_370_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_370_0+length("("));array_copy(func_list_src,_macro_tmp_370_0,"(",0,length("("));;;
if(extend){
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("obj");func_list_tokens[]=line;var _macro_tmp_372_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_372_0+length("obj"));array_copy(func_list_src,_macro_tmp_372_0,"obj",0,length("obj"));;;
}
func_list_tokens[]=')';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(")");func_list_tokens[]=line;var _macro_tmp_374_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_374_0+length(")"));array_copy(func_list_src,_macro_tmp_374_0,")",0,length(")"));;;
func_list_tokens[]='{';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("{");func_list_tokens[]=line;var _macro_tmp_376_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_376_0+length("{"));array_copy(func_list_src,_macro_tmp_376_0,"{",0,length("{"));;;
if(!extend){
func_list_tokens[]=KW_VAR;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("var");func_list_tokens[]=line;var _macro_tmp_379_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_379_0+length("var"));array_copy(func_list_src,_macro_tmp_379_0,"var",0,length("var"));;;;
}
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("obj");func_list_tokens[]=line;var _macro_tmp_381_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_381_0+length("obj"));array_copy(func_list_src,_macro_tmp_381_0,"obj",0,length("obj"));;;
func_list_tokens[]='=';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("=");func_list_tokens[]=line;var _macro_tmp_383_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_383_0+length("="));array_copy(func_list_src,_macro_tmp_383_0,"=",0,length("="));;;
if(extend){
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("object_extend");func_list_tokens[]=line;var _macro_tmp_385_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_385_0+length("object_extend"));array_copy(func_list_src,_macro_tmp_385_0,"object_extend",0,length("object_extend"));;;
}
else{
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("object_create");func_list_tokens[]=line;var _macro_tmp_387_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_387_0+length("object_create"));array_copy(func_list_src,_macro_tmp_387_0,"object_create",0,length("object_create"));;;
}
func_list_tokens[]='(';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("(");func_list_tokens[]=line;var _macro_tmp_389_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_389_0+length("("));array_copy(func_list_src,_macro_tmp_389_0,"(",0,length("("));;;
if(extend){
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("obj");func_list_tokens[]=line;var _macro_tmp_391_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_391_0+length("obj"));array_copy(func_list_src,_macro_tmp_391_0,"obj",0,length("obj"));;;
func_list_tokens[]=',';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(",");func_list_tokens[]=line;var _macro_tmp_393_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_393_0+length(","));array_copy(func_list_src,_macro_tmp_393_0,",",0,length(","));;;
}
var _macro_tmp_394_0={class->CLASS_compat_name,"_SIZE"};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_394_0);func_list_tokens[]=line;var _macro_tmp_395_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_395_0+length(_macro_tmp_394_0));array_copy(func_list_src,_macro_tmp_395_0,_macro_tmp_394_0,0,length(_macro_tmp_394_0));;;
func_list_tokens[]=')';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(")");func_list_tokens[]=line;var _macro_tmp_397_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_397_0+length(")"));array_copy(func_list_src,_macro_tmp_397_0,")",0,length(")"));;;
func_list_tokens[]=';';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(";");func_list_tokens[]=line;var _macro_tmp_399_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_399_0+length(";"));array_copy(func_list_src,_macro_tmp_399_0,";",0,length(";"));;;
var supers=class->CLASS_supers;
if(supers&&extend){
for(var i=0;i<length(supers);i++){
var(func_name,usage_line)=hash_entry(supers,i);
var func_class=class;
var func=null;
for(;;){
func_class=func_class->CLASS_parent;
if(!func_class){
var adj_name={func_name};
for(var j=length(adj_name)-1;j>=0;j--){
if(adj_name[j]=='#'){
array_set_length(adj_name,j);
break;
}
}
return 0,error({script_line(usage_line),": virtual function ",adj_name," not found in super classes"});
}

func=hash_get(func_class->CLASS_functions,func_name,null);
if(func&&(func->FUNC_flags&(FUNC_FLAG_VIRTUAL|FUNC_FLAG_OVERRIDE))==FUNC_FLAG_VIRTUAL){
break;
}
}
tokens_parse(func_list_tokens,func_list_src,{
"obj->",class->CLASS_compat_name,"__super__",func->FUNC_name,"__",length(func->FUNC_params)," = ",
"obj->",func_class->CLASS_compat_name,"__vfunc__",func->FUNC_name,"__",length(func->FUNC_params),";"
},line);
}
}
var funcs=class->CLASS_functions;
for(var i=0;i<length(funcs);i++){
var(k,func)=hash_entry(funcs,i);
if((func->FUNC_flags&(FUNC_FLAG_VIRTUAL|FUNC_FLAG_ABSTRACT))==FUNC_FLAG_VIRTUAL){
var base_class=class;
var base_func=func;
if(func->FUNC_flags&FUNC_FLAG_OVERRIDE){
var name={func->FUNC_name,"#",length(func->FUNC_params)};
base_class=base_class->CLASS_parent;
base_func=null;
while(base_class){
var f=hash_get(base_class->CLASS_functions,name,null);
if(f&&(f->FUNC_flags&FUNC_FLAG_VIRTUAL)&&!(f->FUNC_flags&FUNC_FLAG_OVERRIDE)){
base_func=f;
break;
}
base_class=base_class->CLASS_parent;
}
if(!base_func){
return 0,error({script_line(line),": can't find base function"});
}
}
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("obj");func_list_tokens[]=line;var _macro_tmp_401_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_401_0+length("obj"));array_copy(func_list_src,_macro_tmp_401_0,"obj",0,length("obj"));;;
func_list_tokens[]='->';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("->");func_list_tokens[]=line;var _macro_tmp_403_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_403_0+length("->"));array_copy(func_list_src,_macro_tmp_403_0,"->",0,length("->"));;;
var _macro_tmp_404_0={base_class->CLASS_compat_name,"__vfunc__",base_func->FUNC_name,"__",length(base_func->FUNC_params)};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_404_0);func_list_tokens[]=line;var _macro_tmp_405_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_405_0+length(_macro_tmp_404_0));array_copy(func_list_src,_macro_tmp_405_0,_macro_tmp_404_0,0,length(_macro_tmp_404_0));;;
func_list_tokens[]='=';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("=");func_list_tokens[]=line;var _macro_tmp_407_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_407_0+length("="));array_copy(func_list_src,_macro_tmp_407_0,"=",0,length("="));;;
var _macro_tmp_408_0={class->CLASS_method_prefix,func->FUNC_name,"__vfunc#",length(func->FUNC_params)};func_list_tokens[]=TOK_FUNC_REF;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_408_0);func_list_tokens[]=line;var _macro_tmp_409_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_409_0+length(_macro_tmp_408_0));array_copy(func_list_src,_macro_tmp_409_0,_macro_tmp_408_0,0,length(_macro_tmp_408_0));;;
func_list_tokens[]=';';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(";");func_list_tokens[]=line;var _macro_tmp_411_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_411_0+length(";"));array_copy(func_list_src,_macro_tmp_411_0,";",0,length(";"));;;
}
}
func_list_tokens[]=KW_RETURN;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("return");func_list_tokens[]=line;var _macro_tmp_414_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_414_0+length("return"));array_copy(func_list_src,_macro_tmp_414_0,"return",0,length("return"));;;;
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("obj");func_list_tokens[]=line;var _macro_tmp_416_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_416_0+length("obj"));array_copy(func_list_src,_macro_tmp_416_0,"obj",0,length("obj"));;;
func_list_tokens[]=';';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(";");func_list_tokens[]=line;var _macro_tmp_418_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_418_0+length(";"));array_copy(func_list_src,_macro_tmp_418_0,";",0,length(";"));;;
func_list_tokens[]='}';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("}");func_list_tokens[]=line;var _macro_tmp_420_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_420_0+length("}"));array_copy(func_list_src,_macro_tmp_420_0,"}",0,length("}"));;;
}

function@parse_class_body(gen,list_tokens,list_src,list_off,class)
{
var const_list_tokens=gen->GEN_const_tokens,const_list_src=list_src,const_list_off=-4;;

while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){
case KW_VAR:{
var field=object_create(FIELD_SIZE);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
var line=(list_tokens[list_off+TOK_line]);
if((list_tokens[list_off]===('@'))){
field->FIELD_private=true;
const_list_tokens[]='@';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("@");const_list_tokens[]=line;var _macro_tmp_430_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_430_0+length("@"));array_copy(const_list_src,_macro_tmp_430_0,"@",0,length("@"));;;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
field->FIELD_name=string_const(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
field->FIELD_compat_name={class->CLASS_compat_name,"_",field->FIELD_name};
var _macro_tmp_435_0=field->FIELD_compat_name;const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_435_0);const_list_tokens[]=line;var _macro_tmp_436_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_436_0+length(_macro_tmp_435_0));array_copy(const_list_src,_macro_tmp_436_0,_macro_tmp_435_0,0,length(_macro_tmp_435_0));;;
if(gen->GEN_first_const){
const_list_tokens[]='=';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("=");const_list_tokens[]=line;var _macro_tmp_438_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_438_0+length("="));array_copy(const_list_src,_macro_tmp_438_0,"=",0,length("="));;;
var _macro_tmp_439_0={class->CLASS_parent->CLASS_compat_name,"_SIZE"};const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_439_0);const_list_tokens[]=line;var _macro_tmp_440_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_440_0+length(_macro_tmp_439_0));array_copy(const_list_src,_macro_tmp_440_0,_macro_tmp_439_0,0,length(_macro_tmp_439_0));;;
gen->GEN_first_const=false;
}
const_list_tokens[]=',';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(",");const_list_tokens[]=line;var _macro_tmp_442_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_442_0+length(","));array_copy(const_list_src,_macro_tmp_442_0,",",0,length(","));;;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_447_0,_macro_tmp_447_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_447_1))return 0,_macro_tmp_447_1;list_off=_macro_tmp_447_1;;field->FIELD_type=_macro_tmp_447_0;;;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
class->CLASS_fields{field->FIELD_name}=field;
continue;
}

case TOK_IDENT:{
var line=(list_tokens[list_off+TOK_line]);
var ident=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
var flags=0;
if(ident=="static"){
flags=FUNC_FLAG_STATIC;
}
else if(ident=="virtual"){
if(class->CLASS_ext_type==EXT_TYPE_STRUCT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": virtual functions can't be used in structs"});
}
flags=FUNC_FLAG_VIRTUAL;
}
else if(ident=="override"){
if(class->CLASS_ext_type==EXT_TYPE_STRUCT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": virtual functions can't be used in structs"});
}
flags=FUNC_FLAG_VIRTUAL|FUNC_FLAG_OVERRIDE;
}
else if(ident=="constructor"){
if(class->CLASS_ext_type==EXT_TYPE_STRUCT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": constructors can't be used in structs"});
}
flags=FUNC_FLAG_STATIC|FUNC_FLAG_CONSTRUCTOR;
}
else if(ident=="operator"){
if(class->CLASS_ext_type==EXT_TYPE_STRUCT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": operators can't be used in structs"});
}
flags=FUNC_FLAG_STATIC|FUNC_FLAG_OPERATOR;
}
if(flags){
if(!(flags&(FUNC_FLAG_CONSTRUCTOR|FUNC_FLAG_OPERATOR))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==KW_FUNCTION){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(KW_FUNCTION)});};
list_off-=TOK_SIZE;;
}
list_off=skip_function(gen,list_tokens,list_src,list_off,class,flags);;
if(flags&FUNC_FLAG_VIRTUAL){
var(k,func)=hash_entry(class->CLASS_functions,length(class->CLASS_functions)-1);
class->CLASS_virtual=true;

if(!(flags&FUNC_FLAG_OVERRIDE)){
var const_name={class->CLASS_compat_name,"__vfunc__",func->FUNC_name,"__",length(func->FUNC_params)};
const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(const_name);const_list_tokens[]=line;var _macro_tmp_467_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_467_0+length(const_name));array_copy(const_list_src,_macro_tmp_467_0,const_name,0,length(const_name));;;
if(gen->GEN_first_const){
const_list_tokens[]='=';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length("=");const_list_tokens[]=line;var _macro_tmp_469_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_469_0+length("="));array_copy(const_list_src,_macro_tmp_469_0,"=",0,length("="));;;
var _macro_tmp_470_0={class->CLASS_parent->CLASS_compat_name,"_SIZE"};const_list_tokens[]=TOK_IDENT;const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(_macro_tmp_470_0);const_list_tokens[]=line;var _macro_tmp_471_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_471_0+length(_macro_tmp_470_0));array_copy(const_list_src,_macro_tmp_471_0,_macro_tmp_470_0,0,length(_macro_tmp_470_0));;;
gen->GEN_first_const=false;
}
const_list_tokens[]=',';const_list_tokens[]=length(const_list_src);const_list_tokens[]=length(",");const_list_tokens[]=line;var _macro_tmp_473_0=length(const_list_src);array_set_length(const_list_src,_macro_tmp_473_0+length(","));array_copy(const_list_src,_macro_tmp_473_0,",",0,length(","));;;

var func_list_tokens=gen->GEN_func_tokens,func_list_src=list_src,func_list_off=-4;;
func_list_tokens[]=KW_FUNCTION;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("function");func_list_tokens[]=line;var _macro_tmp_477_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_477_0+length("function"));array_copy(func_list_src,_macro_tmp_477_0,"function",0,length("function"));;;;
if(func->FUNC_flags&FUNC_FLAG_PRIVATE){
func_list_tokens[]='@';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("@");func_list_tokens[]=line;var _macro_tmp_479_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_479_0+length("@"));array_copy(func_list_src,_macro_tmp_479_0,"@",0,length("@"));;;
}
var _macro_tmp_480_0={class->CLASS_method_prefix,func->FUNC_name};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_480_0);func_list_tokens[]=line;var _macro_tmp_481_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_481_0+length(_macro_tmp_480_0));array_copy(func_list_src,_macro_tmp_481_0,_macro_tmp_480_0,0,length(_macro_tmp_480_0));;;
func_list_tokens[]='(';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("(");func_list_tokens[]=line;var _macro_tmp_483_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_483_0+length("("));array_copy(func_list_src,_macro_tmp_483_0,"(",0,length("("));;;
var params=func->FUNC_params;
for(var i=0;i<length(params);i++){
if(i>0){
func_list_tokens[]=',';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(",");func_list_tokens[]=line;var _macro_tmp_485_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_485_0+length(","));array_copy(func_list_src,_macro_tmp_485_0,",",0,length(","));;;
}
var _macro_tmp_486_0={"p",i};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_486_0);func_list_tokens[]=line;var _macro_tmp_487_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_487_0+length(_macro_tmp_486_0));array_copy(func_list_src,_macro_tmp_487_0,_macro_tmp_486_0,0,length(_macro_tmp_486_0));;;
}
func_list_tokens[]=')';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(")");func_list_tokens[]=line;var _macro_tmp_489_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_489_0+length(")"));array_copy(func_list_src,_macro_tmp_489_0,")",0,length(")"));;;
func_list_tokens[]='{';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("{");func_list_tokens[]=line;var _macro_tmp_491_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_491_0+length("{"));array_copy(func_list_src,_macro_tmp_491_0,"{",0,length("{"));;;
func_list_tokens[]=KW_RETURN;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("return");func_list_tokens[]=line;var _macro_tmp_494_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_494_0+length("return"));array_copy(func_list_src,_macro_tmp_494_0,"return",0,length("return"));;;;
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("p0");func_list_tokens[]=line;var _macro_tmp_496_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_496_0+length("p0"));array_copy(func_list_src,_macro_tmp_496_0,"p0",0,length("p0"));;;
func_list_tokens[]='->';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("->");func_list_tokens[]=line;var _macro_tmp_498_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_498_0+length("->"));array_copy(func_list_src,_macro_tmp_498_0,"->",0,length("->"));;;
func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(const_name);func_list_tokens[]=line;var _macro_tmp_500_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_500_0+length(const_name));array_copy(func_list_src,_macro_tmp_500_0,const_name,0,length(const_name));;;
func_list_tokens[]='(';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("(");func_list_tokens[]=line;var _macro_tmp_502_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_502_0+length("("));array_copy(func_list_src,_macro_tmp_502_0,"(",0,length("("));;;
for(var i=0;i<length(params);i++){
if(i>0){
func_list_tokens[]=',';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(",");func_list_tokens[]=line;var _macro_tmp_504_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_504_0+length(","));array_copy(func_list_src,_macro_tmp_504_0,",",0,length(","));;;
}
var _macro_tmp_505_0={"p",i};func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_505_0);func_list_tokens[]=line;var _macro_tmp_506_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_506_0+length(_macro_tmp_505_0));array_copy(func_list_src,_macro_tmp_506_0,_macro_tmp_505_0,0,length(_macro_tmp_505_0));;;
}
func_list_tokens[]=')';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(")");func_list_tokens[]=line;var _macro_tmp_508_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_508_0+length(")"));array_copy(func_list_src,_macro_tmp_508_0,")",0,length(")"));;;
func_list_tokens[]=';';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(";");func_list_tokens[]=line;var _macro_tmp_510_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_510_0+length(";"));array_copy(func_list_src,_macro_tmp_510_0,";",0,length(";"));;;
func_list_tokens[]='}';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("}");func_list_tokens[]=line;var _macro_tmp_512_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_512_0+length("}"));array_copy(func_list_src,_macro_tmp_512_0,"}",0,length("}"));;;
}
}
continue;
}
break;
}

case KW_FUNCTION:{
list_off-=TOK_SIZE;;
list_off=skip_function(gen,list_tokens,list_src,list_off,class,0);;
continue;
}
}

if((list_tokens[list_off])=='}'){
list_off-=TOK_SIZE;;
break;
}

return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected variable or function declaration"});
}
return(list_off);
}






function@register_operator(operators,prio,op1_type,op2_type,ret_type,func_name,compare,replace)
{
var key=add32(mul32(add32(mul32(op1_type,31),op2_type),31),prio);

var list=hash_get(operators,key,null);
if(!list){
list=[];
operators{key}=list;
}

for(var i=0;i<length(list);i+=OPERATOR_SIZE){
if(list[i+OPERATOR_prio]!==prio)continue;
if(list[i+OPERATOR_type1]!==op1_type)continue;
if(list[i+OPERATOR_type2]!==op2_type)continue;
if(replace){
list[i+OPERATOR_ret_type]=ret_type;
list[i+OPERATOR_func_name]=func_name;
list[i+OPERATOR_compare]=compare;
}
return true;
}

list[]=prio;
list[]=op1_type;
list[]=op2_type;
list[]=ret_type;
list[]=func_name;
list[]=compare;
return false;
}

function@register_compare_operators(operators,op1_type,op2_type,func_name)
{
register_operator(operators,PRIO_COMPARISON_LT,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
register_operator(operators,PRIO_COMPARISON_GT,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
register_operator(operators,PRIO_COMPARISON_LE,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
register_operator(operators,PRIO_COMPARISON_GE,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
register_operator(operators,PRIO_EQUALITY_EQ_VALUE,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
register_operator(operators,PRIO_EQUALITY_NE_VALUE,op1_type,op2_type,TYPE_BOOLEAN,func_name,true,false);
}

function@merge_operators(dest_operators,src_operators)
{
for(var i=0;i<length(src_operators);i++){
var(key,src_entries)=hash_entry(src_operators,i);
var dest_entries=hash_get(dest_operators,key,null);
if(!dest_entries){
dest_entries=[];
dest_operators{key}=dest_entries;
}
for(var j=0;j<length(src_entries);j+=OPERATOR_SIZE){
var prio=src_entries[j+OPERATOR_prio];
var type1=src_entries[j+OPERATOR_type1];
var type2=src_entries[j+OPERATOR_type2];
var added=false;
for(var l=0;l<length(dest_entries);l+=OPERATOR_SIZE){
if(dest_entries[l+OPERATOR_prio]!==prio)continue;
if(dest_entries[l+OPERATOR_type1]!==type1)continue;
if(dest_entries[l+OPERATOR_type2]!==type2)continue;

dest_entries[l+OPERATOR_ret_type]=src_entries[j+OPERATOR_ret_type];
dest_entries[l+OPERATOR_func_name]=src_entries[j+OPERATOR_func_name];
dest_entries[l+OPERATOR_compare]=src_entries[j+OPERATOR_compare];
added=true;
break;
}
if(!added){
dest_entries[]=prio;
dest_entries[]=type1;
dest_entries[]=type2;
dest_entries[]=src_entries[j+OPERATOR_ret_type];
dest_entries[]=src_entries[j+OPERATOR_func_name];
dest_entries[]=src_entries[j+OPERATOR_compare];
}
}
}
}

function@skip_function(gen,list_tokens,list_src,list_off,class,flags)
{
var func=object_create(FUNC_SIZE);
func->FUNC_params={};
func->FUNC_flags=flags;
func->FUNC_return_type=-1;

var func_line;
var has_param_types=false;

if(flags&FUNC_FLAG_OPERATOR){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
func_line=(list_tokens[list_off+TOK_line]);
var op_str=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
var single_param=false;
var prio;
switch((list_tokens[list_off])){
case '+':prio=PRIO_ADDITIVE_ADD;break;
case '-':prio=PRIO_ADDITIVE_SUB;break;
case '*':prio=PRIO_MULTIPLICATIVE_MUL;break;
case '/':prio=PRIO_MULTIPLICATIVE_DIV;break;
case '%':prio=PRIO_MULTIPLICATIVE_REM;break;
case '&':prio=PRIO_BITWISE_AND;break;
case '|':prio=PRIO_BITWISE_OR;break;
case '^':prio=PRIO_BITWISE_XOR;break;
case '<<':prio=PRIO_BITWISE_SHL;break;
case '>>':prio=PRIO_BITWISE_SHR;break;
case '>>>':prio=PRIO_BITWISE_USHR;break;
case '<':prio=PRIO_COMPARISON_LT;break;
case '>':prio=PRIO_COMPARISON_GT;break;
case '<=':{
var off=(list_tokens[list_off+TOK_off]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off])=='>'&&(list_tokens[list_off+TOK_off])==off+2){
prio=PRIO_SPECIAL_COMPARE;
op_str="<=>";
}
else{
list_off-=TOK_SIZE;;
prio=PRIO_COMPARISON_LE;
}
break;
}
case '>=':prio=PRIO_COMPARISON_GE;break;
case '==':prio=PRIO_EQUALITY_EQ_VALUE;break;
case '!=':prio=PRIO_EQUALITY_NE_VALUE;break;

case '+=':prio=PRIO_SPECIAL_ADD_INPLACE;single_param=true;break;
case '-=':prio=PRIO_SPECIAL_SUB_INPLACE;single_param=true;break;
case '*=':prio=PRIO_SPECIAL_MUL_INPLACE;single_param=true;break;
case '/=':prio=PRIO_SPECIAL_DIV_INPLACE;single_param=true;break;
case '%=':prio=PRIO_SPECIAL_REM_INPLACE;single_param=true;break;
case '&=':prio=PRIO_SPECIAL_AND_INPLACE;single_param=true;break;
case '|=':prio=PRIO_SPECIAL_OR_INPLACE;single_param=true;break;
case '^=':prio=PRIO_SPECIAL_XOR_INPLACE;single_param=true;break;
case '<<=':prio=PRIO_SPECIAL_SHL_INPLACE;single_param=true;break;
case '>>=':prio=PRIO_SPECIAL_SHR_INPLACE;single_param=true;break;
case '>>>=':prio=PRIO_SPECIAL_USHR_INPLACE;single_param=true;break;

default:
return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected operator +, -, *, /, %, &, |, ^, <<, >>, >>>, <, >, <=, >=, ==, !=, <=>, +=, -=, *=, /=, %=, &=, |=, ^=, <<=, >>= or >>>="});
}
var op1_name,op2_name;
var op1_type,op2_type;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
if(single_param){
op1_name="this";
op1_type=class;
func->FUNC_flags&=~FUNC_FLAG_STATIC;
}
else{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
op1_name=string_const(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_542_0,_macro_tmp_542_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_542_1))return 0,_macro_tmp_542_1;list_off=_macro_tmp_542_1;;op1_type=_macro_tmp_542_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
op2_name=string_const(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(op2_name==op1_name){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate parameter name"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_556_0,_macro_tmp_556_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_556_1))return 0,_macro_tmp_556_1;list_off=_macro_tmp_556_1;;op2_type=_macro_tmp_556_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};


if(op1_type!==class&&op2_type!==class){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": at least one operand must be the owner class type"});
}
func->FUNC_name={"__classes_operator_",tmp_cnt++};
func->FUNC_alt_name={"operator ",op_str};
func->FUNC_params{op1_name}=op1_type;
func->FUNC_params{op2_name}=op2_type;
switch(prio){
case PRIO_COMPARISON_LT..PRIO_COMPARISON_GE:
case PRIO_EQUALITY_EQ_VALUE..PRIO_EQUALITY_NE_VALUE:
func->FUNC_return_type=TYPE_BOOLEAN;
break;

case PRIO_SPECIAL_COMPARE:
func->FUNC_return_type=TYPE_INTEGER;
break;

default:
func->FUNC_return_type=class;
}

if(!class->CLASS_operators){
class->CLASS_operators={};
}
var func_name={class->CLASS_method_prefix,func->FUNC_name};

if(register_operator(class->CLASS_operators,prio,op1_type,op2_type,func->FUNC_return_type,func_name,false,false)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate operator"});
}
register_operator(gen->GEN_imported_operators,prio,op1_type,op2_type,func->FUNC_return_type,func_name,false,true);

if(prio==PRIO_SPECIAL_COMPARE){
register_compare_operators(class->CLASS_operators,op1_type,op2_type,func_name);
register_compare_operators(gen->GEN_imported_operators,op1_type,op2_type,func_name);
}
}
else{
if(!(flags&FUNC_FLAG_CONSTRUCTOR)){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==KW_FUNCTION){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(KW_FUNCTION)});};
}
func_line=(list_tokens[list_off+TOK_line]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('@'))){
func->FUNC_flags|=FUNC_FLAG_PRIVATE;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
var extension=false;
var allow_generics=0;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
extension=true;
flags|=FUNC_FLAG_EXTENSION;
}
else{
list_off-=TOK_SIZE;;
}
if((func->FUNC_flags&FUNC_FLAG_EXTENSION)&&!extension){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": invalid static extension function"});
}
if(extension){
object_extend(func,EXTENFUNC_SIZE);
if(func_name=="Array"){
func->EXTENFUNC_kind="array";
allow_generics=2;
}
else if(func_name=="String"){
func->EXTENFUNC_kind="string";
}
else if(func_name=="Hash"){
func->EXTENFUNC_kind="hash";
allow_generics=1|2;
}
else{
return 0,error({script_line((list_tokens[list_off+TOK_line])),": invalid extension function"});
}
func->FUNC_name=string_const({func->EXTENFUNC_kind,"_",array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])});
func->FUNC_flags|=FUNC_FLAG_EXTENSION;
}
else{
func->FUNC_name=string_const(func_name);
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};

if((flags&FUNC_FLAG_STATIC)==0){
if(class){
func->FUNC_params{"this"}=class;
}
else if(extension){
var this_type;
if(func->EXTENFUNC_kind=="array"){
this_type=create_array_type(TYPE_VALUE);
}
else if(func->EXTENFUNC_kind=="string"){
this_type=TYPE_STRING;
}
else if(func->EXTENFUNC_kind=="hash"){
this_type=create_hash_type(TYPE_VALUE,TYPE_KEY);
}
func->FUNC_params{"this"}=this_type;
}
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(')'))){
list_off-=TOK_SIZE;;
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var name=string_const(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);

var type=null;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};{parse_type_allow_generics=allow_generics;}var(_macro_tmp_599_0,_macro_tmp_599_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,true);{parse_type_allow_generics=0;}if(!is_int(_macro_tmp_599_1))return 0,_macro_tmp_599_1;list_off=_macro_tmp_599_1;;type=_macro_tmp_599_0;;;
has_param_types=true;
}
else{
list_off-=TOK_SIZE;;
}

func->FUNC_params{name}=type;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(','))){
continue;
}
list_off-=TOK_SIZE;;
break;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(flags&FUNC_FLAG_CONSTRUCTOR){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't set return type for constructors"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};{parse_type_allow_generics=allow_generics;}var(_macro_tmp_616_0,_macro_tmp_616_1)=parse_type_inner(gen,list_tokens,list_src,list_off,true,false);{parse_type_allow_generics=0;}if(!is_int(_macro_tmp_616_1))return 0,_macro_tmp_616_1;list_off=_macro_tmp_616_1;;func->FUNC_return_type=_macro_tmp_616_0;;;
has_param_types=true;
}
else{
list_off-=TOK_SIZE;;
if(flags&FUNC_FLAG_CONSTRUCTOR){
func->FUNC_return_type=class;
}
}

var name=string_const({func->FUNC_name,"#",length(func->FUNC_params)});
if(class){
if(hash_contains(class->CLASS_functions,name)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate function"});
}
class->CLASS_functions{name}=func;
}
else{
if(!extension){
func->FUNC_flags|=FUNC_FLAG_STATIC;
}
if(hash_contains(gen->GEN_functions,name)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate function"});
}
gen->GEN_functions{name}=func;
if(extension){
if(func->FUNC_flags&FUNC_FLAG_STATIC){
if(!gen->GEN_static_functions){
gen->GEN_static_functions={};
static_functions{gen->GEN_fname}=gen->GEN_static_functions;
}
gen->GEN_static_functions{name}=func;
}
else{
if(!gen->GEN_instance_functions){
gen->GEN_instance_functions={};
instance_functions{gen->GEN_fname}=gen->GEN_instance_functions;
}
gen->GEN_instance_functions{name}=func;
}
}
}
}

var level=0;

var parse_funcs=gen->GEN_parse_funcs;
parse_funcs[]=(list_off);
parse_funcs[]=class;
parse_funcs[]=func;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(';'))){
if(flags&FUNC_FLAG_VIRTUAL){
if(flags&FUNC_FLAG_OVERRIDE){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": empty override function"});
}
func->FUNC_flags|=FUNC_FLAG_ABSTRACT;
}
if(func->FUNC_return_type==-1){
func->FUNC_return_type=TYPE_VOID;
}
return(list_off);
}
list_off-=TOK_SIZE;;

var found_end=false;
var returns_void=class||flags||has_param_types;
var returns_single_value=false;
var visited_return=false;
while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){
case '{':
level++;
continue;

case '}':
if(--level==0){
found_end=true;
break;
}
continue;

case KW_RETURN:
if(returns_void||visited_return){
continue;
}
if(((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off])==';'){
list_off-=TOK_SIZE;;
visited_return=true;
}
else{
list_off-=TOK_SIZE;;
var _macro_tmp_637_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_637_0++;continue;case ')','}',']':if(!_macro_tmp_637_0)break;_macro_tmp_637_0--;continue;case ',',';':if(!_macro_tmp_637_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;
if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off])==';'){
returns_single_value=true;
visited_return=true;
}
list_off-=TOK_SIZE;;
}
}
else{
list_off-=TOK_SIZE;;
}
continue;

default:
continue;
}
break;
}

if(!found_end){
return 0,error({script_line(func_line),": unclosed function"});
}
if(func->FUNC_return_type==-1){
if(returns_void||!returns_single_value){
func->FUNC_return_type=TYPE_VOID;
}
else{
func->FUNC_return_type=TYPE_DYNAMIC;
}
}
return(list_off);
}

function@parse_function(gen,list_tokens,list_src,list_off,class,func)
{
var line=(list_tokens[list_off+TOK_line]);
var out=(func->FUNC_flags&FUNC_FLAG_ABSTRACT)==0;

var func_list_tokens=gen->GEN_func_tokens,func_list_src=list_src,func_list_off=-4;;

if(out){
func_list_tokens[]=KW_FUNCTION;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("function");func_list_tokens[]=line;var _macro_tmp_648_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_648_0+length("function"));array_copy(func_list_src,_macro_tmp_648_0,"function",0,length("function"));;;;
}

if(func->FUNC_flags&FUNC_FLAG_VIRTUAL){
if(out){
func_list_tokens[]='@';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("@");func_list_tokens[]=line;var _macro_tmp_650_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_650_0+length("@"));array_copy(func_list_src,_macro_tmp_650_0,"@",0,length("@"));;;
}
var short_name={class->CLASS_method_prefix,func->FUNC_name};
var func_name={short_name,"__vfunc"};
if(out){
var _macro_tmp_651_0=func_name;func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_651_0);func_list_tokens[]=line;var _macro_tmp_652_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_652_0+length(_macro_tmp_651_0));array_copy(func_list_src,_macro_tmp_652_0,_macro_tmp_651_0,0,length(_macro_tmp_651_0));;;
}
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",short_name,"_",length(func->FUNC_params)," = \"\";"},line);
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",func_name,"_",length(func->FUNC_params)," = \"",class->CLASS_name,".",func->FUNC_name,"\";"},line);
}
else{
if(func->FUNC_flags&FUNC_FLAG_PRIVATE){
func_list_tokens[]='@';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("@");func_list_tokens[]=line;var _macro_tmp_654_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_654_0+length("@"));array_copy(func_list_src,_macro_tmp_654_0,"@",0,length("@"));;;
}
if(class){
var func_name={class->CLASS_method_prefix,func->FUNC_name};
var _macro_tmp_655_0=func_name;func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_655_0);func_list_tokens[]=line;var _macro_tmp_656_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_656_0+length(_macro_tmp_655_0));array_copy(func_list_src,_macro_tmp_656_0,_macro_tmp_655_0,0,length(_macro_tmp_655_0));;;
if(func->FUNC_flags&FUNC_FLAG_STATIC){
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",func_name,"_",length(func->FUNC_params)," = \"",class->CLASS_name,"::",func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name,"\";"},line);
}
else{
tokens_parse(gen->GEN_const_tokens,list_src,{"const @function_",func_name,"_",length(func->FUNC_params)," = \"",class->CLASS_name,".",func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name,"\";"},line);
}
}
else{
var _macro_tmp_657_0=func->FUNC_name;func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_657_0);func_list_tokens[]=line;var _macro_tmp_658_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_658_0+length(_macro_tmp_657_0));array_copy(func_list_src,_macro_tmp_658_0,_macro_tmp_657_0,0,length(_macro_tmp_657_0));;;
}
}

if(out){
func_list_tokens[]='(';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length("(");func_list_tokens[]=line;var _macro_tmp_660_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_660_0+length("("));array_copy(func_list_src,_macro_tmp_660_0,"(",0,length("("));;;
}

hash_clear(gen->GEN_vars);
var params=func->FUNC_params;
for(var i=0;i<length(params);i++){
var(k,v)=hash_entry(params,i);
if(i>0){
if(out){
func_list_tokens[]=',';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(",");func_list_tokens[]=line;var _macro_tmp_662_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_662_0+length(","));array_copy(func_list_src,_macro_tmp_662_0,",",0,length(","));;;
}
}
if(out){
var _macro_tmp_663_0=k;func_list_tokens[]=TOK_IDENT;func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(_macro_tmp_663_0);func_list_tokens[]=line;var _macro_tmp_664_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_664_0+length(_macro_tmp_663_0));array_copy(func_list_src,_macro_tmp_664_0,_macro_tmp_663_0,0,length(_macro_tmp_663_0));;;
}
if(is_array(v)&&v[0]==EXT_TYPE_MULTIPLE){
v=TYPE_DYNAMIC;
}
gen->GEN_vars{k}=v;
}

if(out){
func_list_tokens[]=')';func_list_tokens[]=length(func_list_src);func_list_tokens[]=length(")");func_list_tokens[]=line;var _macro_tmp_666_0=length(func_list_src);array_set_length(func_list_src,_macro_tmp_666_0+length(")"));array_copy(func_list_src,_macro_tmp_666_0,")",0,length(")"));;;
}

gen->GEN_cur_func=func;
gen->GEN_cur_class=class;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(';'))){
if(out){
gen->GEN_last_func_pos=list_off;;;
}
else{
list_off+=TOK_SIZE;;
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;
}
}
else{
list_off-=TOK_SIZE;;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};
gen->GEN_last_func_pos=list_off;;;
if(func->FUNC_flags&FUNC_FLAG_CONSTRUCTOR){
var parent=class->CLASS_parent;
if(parent){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===TOK_IDENT&&(list_tokens[list_off+TOK_len]===length("super")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("super")))){
line=(list_tokens[list_off+TOK_line]);
var _macro_tmp_688_0=gen->GEN_func_tokens;var _macro_tmp_688_1=length(_macro_tmp_688_0);var _macro_tmp_688_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_688_0,_macro_tmp_688_1+_macro_tmp_688_2);array_copy(_macro_tmp_688_0,_macro_tmp_688_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_688_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var pos=length(gen->GEN_func_tokens)-TOK_SIZE;
if(class->CLASS_virtual){
tokens_parse(gen->GEN_func_tokens,list_src,{"var this = vfunc__",class->CLASS_method_prefix,"_object_extend(",parent->CLASS_method_prefix,name},line);
}
else{
tokens_parse(gen->GEN_func_tokens,list_src,{"var this = object_extend(",parent->CLASS_method_prefix,name},line);
}
gen->GEN_last_func_pos=list_off;;;

var params_off=(list_off);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};

var num_params=0;
if((list_tokens[list_off]===(')'))){
list_off-=TOK_SIZE;;
}
else{
list_off-=TOK_SIZE;;
for(;;){
num_params++;
var _macro_tmp_706_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_706_0++;continue;case ')','}',']':if(!_macro_tmp_706_0)break;_macro_tmp_706_0--;continue;case ',',';':if(!_macro_tmp_706_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(',')))continue;
list_off-=TOK_SIZE;;
break;
}
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};

var func_name={name,"#",num_params};
var super_func=hash_get(parent->CLASS_functions,func_name,null);
if(!super_func||!(super_func->FUNC_flags&FUNC_FLAG_STATIC)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": static method ",func_name," not found in ",get_class_name_with_kind(parent)});
}

list_off=params_off;;
for(var i=0;i<num_params;i++){
if(i>0){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};
}
var(param_name,param_type)=hash_entry(super_func->FUNC_params,i);
var param_start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
var _macro_tmp_725_0=gen->GEN_func_tokens;var _macro_tmp_725_1=length(_macro_tmp_725_0);var _macro_tmp_725_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_725_0,_macro_tmp_725_1+_macro_tmp_725_2);array_copy(_macro_tmp_725_0,_macro_tmp_725_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_725_2);gen->GEN_last_func_pos=list_off;;;
if(class->CLASS_virtual){
tokens_parse(gen->GEN_func_tokens,list_src,")); {var __classes_padding",line);
}
else{
tokens_parse(gen->GEN_func_tokens,list_src,{"), ",class->CLASS_compat_name,"_SIZE); {var __classes_padding"},line);
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
gen->GEN_last_func_pos=list_off;;;
}
else{
list_off-=TOK_SIZE;;
var super_func=hash_get(parent->CLASS_functions,"create#0",null);
if(!super_func||!(super_func->FUNC_flags&FUNC_FLAG_STATIC)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": default constructor not found in class ",parent->CLASS_name});
}
if(class->CLASS_virtual){
tokens_parse(gen->GEN_func_tokens,list_src,{"{var this = vfunc__",class->CLASS_method_prefix,"_object_extend(",parent->CLASS_method_prefix,"create());"},line);
}
else{
tokens_parse(gen->GEN_func_tokens,list_src,{"{var this = object_extend(",parent->CLASS_method_prefix,"create(), ",class->CLASS_compat_name,"_SIZE);"},line);
}
}
}
else{
if(class->CLASS_virtual){
tokens_parse(gen->GEN_func_tokens,list_src,{"{var this=vfunc__",class->CLASS_method_prefix,"_object_create();"},line);
}
else{
tokens_parse(gen->GEN_func_tokens,list_src,{"{var this=object_create(",class->CLASS_compat_name,"_SIZE);"},line);
}
}
gen->GEN_vars{"this"}=class;
}
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
}

gen->GEN_cur_func=null;
gen->GEN_cur_class=null;

list_off+=TOK_SIZE;;
var _macro_tmp_736_0=gen->GEN_func_tokens;var _macro_tmp_736_1=length(_macro_tmp_736_0);var _macro_tmp_736_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_736_0,_macro_tmp_736_1+_macro_tmp_736_2);array_copy(_macro_tmp_736_0,_macro_tmp_736_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_736_2);gen->GEN_last_func_pos=list_off;;;

if(func->FUNC_flags&FUNC_FLAG_CONSTRUCTOR){
var pos=length(gen->GEN_func_tokens)-TOK_SIZE;
line=gen->GEN_func_tokens[pos+TOK_line];

tokens_parse(gen->GEN_func_tokens,list_src,"return this; }",line);
}

if(func->FUNC_flags&FUNC_FLAG_CONSTRUCTOR){
hash_remove(gen->GEN_vars,"this");
}

list_off-=TOK_SIZE;;
return(list_off);
}

function@parse_block(gen,list_tokens,list_src,list_off,block_type)
{
var stack_pos=length(gen->GEN_var_stack);
var type=-1;

for(;;){
if(block_type==BT_SINGLE&&type!=-1){
return(list_off);
}

if(!((list_off+=TOK_SIZE)<length(list_tokens)))break;
type=(list_tokens[list_off]);

switch(type){
case '{':{
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
continue;
}

case '}':{
for(var i=length(gen->GEN_var_stack)-1;i>=stack_pos;i--){
hash_remove(gen->GEN_vars,gen->GEN_var_stack[i]);
}
array_set_length(gen->GEN_var_stack,stack_pos);
return(list_off);
}

case '(':{
if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off])==TOK_IDENT){
if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===(','))){
list_off-=TOK_SIZE;;
var var1_type=hash_get(gen->GEN_vars,array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]),-1);
if(var1_type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown variable ",array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])});
}
list_off+=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var var2_type=hash_get(gen->GEN_vars,array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]),-1);
if(var2_type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown variable ",array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='='){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('='),"'"});};
gen->GEN_hash_entry_value_type=-1;
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
check_implicit_conv_with_error(var1_type,gen->GEN_ret_type,(list_tokens[list_off+TOK_line]));
if(gen->GEN_hash_entry_value_type!=-1){
check_implicit_conv_with_error(var2_type,gen->GEN_hash_entry_value_type,(list_tokens[list_off+TOK_line]));
}
gen->GEN_hash_entry_value_type=0;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}
else{
list_off-=TOK_SIZE;;
list_off-=TOK_SIZE;;
}
}
else{
list_off-=TOK_SIZE;;
}
break;
}

case '=':{
if(block_type==BT_EXPR){
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};
for(var i=length(gen->GEN_var_stack)-1;i>=stack_pos;i--){
hash_remove(gen->GEN_vars,gen->GEN_var_stack[i]);
}
array_set_length(gen->GEN_var_stack,stack_pos);
return(list_off);
}
break;
}

case KW_VAR:{
if(block_type==BT_SINGLE){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": declaring variables is not allowed in single statement"});
}
if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('('))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};

var var1=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(hash_contains(gen->GEN_vars,var1)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate variable"});
}
var var1_type=-1;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var _macro_tmp_791_0=gen->GEN_func_tokens;var _macro_tmp_791_1=length(_macro_tmp_791_0);var _macro_tmp_791_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_791_0,_macro_tmp_791_1+_macro_tmp_791_2);array_copy(_macro_tmp_791_0,_macro_tmp_791_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_791_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_793_0,_macro_tmp_793_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_793_1))return 0,_macro_tmp_793_1;list_off=_macro_tmp_793_1;;var1_type=_macro_tmp_793_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
}
list_off-=TOK_SIZE;;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};

var var2=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(hash_contains(gen->GEN_vars,var2)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate variable"});
}
var var2_type=-1;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var _macro_tmp_813_0=gen->GEN_func_tokens;var _macro_tmp_813_1=length(_macro_tmp_813_0);var _macro_tmp_813_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_813_0,_macro_tmp_813_1+_macro_tmp_813_2);array_copy(_macro_tmp_813_0,_macro_tmp_813_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_813_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_815_0,_macro_tmp_815_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_815_1))return 0,_macro_tmp_815_1;list_off=_macro_tmp_815_1;;var2_type=_macro_tmp_815_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
}
list_off-=TOK_SIZE;;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='='){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('='),"'"});};
var start_pos=(list_off);
gen->GEN_hash_entry_value_type=-1;
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(var1_type==-1){
var1_type=gen->GEN_ret_type;
}
if(var2_type==-1){
var2_type=gen->GEN_hash_entry_value_type;
}
if(var1_type==-1)var1_type=TYPE_DYNAMIC;
if(var2_type==-1)var2_type=TYPE_DYNAMIC;
check_implicit_conv_with_error(var1_type,gen->GEN_ret_type,(list_tokens[list_off+TOK_line]));
if(gen->GEN_hash_entry_value_type!=-1){
check_implicit_conv_with_error(var2_type,gen->GEN_hash_entry_value_type,(list_tokens[list_off+TOK_line]));
}
gen->GEN_hash_entry_value_type=0;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};

gen->GEN_vars{var1}=var1_type;
gen->GEN_vars{var2}=var2_type;
gen->GEN_var_stack[]=var1;
gen->GEN_var_stack[]=var2;
continue;
}
else{
list_off-=TOK_SIZE;;
}
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var var_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);

var var_type=-1;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var _macro_tmp_845_0=gen->GEN_func_tokens;var _macro_tmp_845_1=length(_macro_tmp_845_0);var _macro_tmp_845_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_845_0,_macro_tmp_845_1+_macro_tmp_845_2);array_copy(_macro_tmp_845_0,_macro_tmp_845_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_845_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_847_0,_macro_tmp_847_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_847_1))return 0,_macro_tmp_847_1;list_off=_macro_tmp_847_1;;var_type=_macro_tmp_847_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
}
if((list_tokens[list_off]===('='))){

var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,start_pos,var_type,gen->GEN_ret_type);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(var_type==-1){
var_type=gen->GEN_ret_type;
}
}
if(var_type==-1){
var_type=TYPE_DYNAMIC;
}

if(hash_contains(gen->GEN_vars,var_name)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate variable"});
}
gen->GEN_vars{var_name}=var_type;
gen->GEN_var_stack[]=var_name;

if((list_tokens[list_off]===(','))){
continue;
}
list_off-=TOK_SIZE;;
break;
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}

case KW_RETURN:{
var ret_type=gen->GEN_cur_func->FUNC_return_type;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(';'))){
if(gen->GEN_cur_func->FUNC_flags&FUNC_FLAG_CONSTRUCTOR){
var _macro_tmp_873_0=gen->GEN_func_tokens;var _macro_tmp_873_1=length(_macro_tmp_873_0);var _macro_tmp_873_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_873_0,_macro_tmp_873_1+_macro_tmp_873_2);array_copy(_macro_tmp_873_0,_macro_tmp_873_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_873_2);gen->GEN_last_func_pos=list_off;;;
tokens_parse(gen->GEN_func_tokens,list_src,"this",(list_tokens[list_off+TOK_line]));
gen->GEN_last_func_pos=list_off;;;
continue;
}
if(ret_type!=TYPE_DYNAMIC&&ret_type!=TYPE_VOID){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": function requires value to return"});
}
continue;
}
if(gen->GEN_cur_func->FUNC_flags&FUNC_FLAG_CONSTRUCTOR){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot return values in constructors"});
}
if(ret_type==TYPE_VOID){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot return value in void function"});
}
list_off-=TOK_SIZE;;
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,start_pos,ret_type,gen->GEN_ret_type);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(','))){
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}

case KW_IF:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(gen->GEN_ret_type==TYPE_INTEGER||gen->GEN_ret_type==TYPE_FLOAT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('{'))){
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off])==KW_ELSE){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('{'))){
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
}
else{
list_off-=TOK_SIZE;;
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_SINGLE);;
}
}
else{
list_off-=TOK_SIZE;;
}
}
else{
list_off-=TOK_SIZE;;
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_SINGLE);;
}
continue;
}

case KW_WHILE:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(gen->GEN_ret_type==TYPE_INTEGER||gen->GEN_ret_type==TYPE_FLOAT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('{'))){
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
}
else{
list_off-=TOK_SIZE;;
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_SINGLE);;
}
continue;
}

case KW_DO:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==KW_WHILE){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(KW_WHILE)});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(gen->GEN_ret_type==TYPE_INTEGER||gen->GEN_ret_type==TYPE_FLOAT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}

case KW_FOR:{
var for_stack_pos=length(gen->GEN_var_stack);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(';'))){
if((list_tokens[list_off])==KW_VAR){
for(;;){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var var_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);

var var_type=-1;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
var _macro_tmp_971_0=gen->GEN_func_tokens;var _macro_tmp_971_1=length(_macro_tmp_971_0);var _macro_tmp_971_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_971_0,_macro_tmp_971_1+_macro_tmp_971_2);array_copy(_macro_tmp_971_0,_macro_tmp_971_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_971_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_973_0,_macro_tmp_973_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_973_1))return 0,_macro_tmp_973_1;list_off=_macro_tmp_973_1;;var_type=_macro_tmp_973_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
}
if((list_tokens[list_off]===('='))){

var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,start_pos,var_type,gen->GEN_ret_type);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(var_type==-1){
var_type=gen->GEN_ret_type;
}
}
if(var_type==-1){
var_type=TYPE_DYNAMIC;
}

if(hash_contains(gen->GEN_vars,var_name)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate variable"});
}
gen->GEN_vars{var_name}=var_type;
gen->GEN_var_stack[]=var_name;

if((list_tokens[list_off]===(','))){
continue;
}
list_off-=TOK_SIZE;;
break;
}
}
else{
list_off-=TOK_SIZE;;
for(;;){
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(',')))continue;
list_off-=TOK_SIZE;;
break;
}
}
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(';'))){
list_off-=TOK_SIZE;;
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(gen->GEN_ret_type==TYPE_INTEGER||gen->GEN_ret_type==TYPE_FLOAT){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});
}
}
else{
list_off-=TOK_SIZE;;
}
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!(list_tokens[list_off]===(')'))){
list_off-=TOK_SIZE;;
list_off=parse_expression(gen,list_tokens,list_src,list_off,-2,(list_off),PRIO_PRIMARY);;
}
else{
list_off-=TOK_SIZE;;
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('{'))){
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
}
else{
list_off-=TOK_SIZE;;
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_SINGLE);;
}

for(var i=length(gen->GEN_var_stack)-1;i>=for_stack_pos;i--){
hash_remove(gen->GEN_vars,gen->GEN_var_stack[i]);
}
array_set_length(gen->GEN_var_stack,for_stack_pos);
continue;
}

case KW_SWITCH:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
var start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,start_pos,TYPE_INTEGER,gen->GEN_ret_type);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};

var end=false;
while(!end){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
switch((list_tokens[list_off])){
case KW_CASE:{

do{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('+'))||(list_tokens[list_off]===('-'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}
var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))&&gen->GEN_import_aliases&&hash_contains(gen->GEN_import_aliases,name)){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}
if((list_tokens[list_off])=='..'){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===('+'))||(list_tokens[list_off]===('-'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}
name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))&&gen->GEN_import_aliases&&hash_contains(gen->GEN_import_aliases,name)){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}
}
}
while((list_tokens[list_off]===(',')));
list_off-=TOK_SIZE;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
break;
}

case KW_DEFAULT:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};
break;
}

default:{
if((list_tokens[list_off]===('}'))){
end=true;
break;
}
if((list_tokens[list_off]===('{'))){
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;
}
else{
list_off-=TOK_SIZE;;
list_off=parse_block(gen,list_tokens,list_src,list_off,BT_SINGLE);;
}
break;
}
}
}
continue;
}

case KW_BREAK,KW_CONTINUE:{
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}

case TOK_IDENT:{
if((list_tokens[list_off+TOK_len]===length("throw")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("throw"))){
var line=(list_tokens[list_off+TOK_line]);
var _macro_tmp_1096_0=gen->GEN_func_tokens;var _macro_tmp_1096_1=length(_macro_tmp_1096_0);var _macro_tmp_1096_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1096_0,_macro_tmp_1096_1+_macro_tmp_1096_2);array_copy(_macro_tmp_1096_0,_macro_tmp_1096_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1096_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;

var src_off=length(list_src);array_set_length(list_src,src_off+length("return0,"));array_copy(list_src,src_off,"return0,",0,length("return0,"));;
gen->GEN_func_tokens[]=KW_RETURN;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=6;gen->GEN_func_tokens[]=line;;
gen->GEN_func_tokens[]=TOK_NUMBER;gen->GEN_func_tokens[]=src_off+6;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;
gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off+7;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;

list_off-=TOK_SIZE;;
gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)-TOK_SIZE);
var expr_start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
continue;
}
if((list_tokens[list_off+TOK_len]===length("foreach")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("foreach"))){
var line=(list_tokens[list_off+TOK_line]);
var _macro_tmp_1118_0=gen->GEN_func_tokens;var _macro_tmp_1118_1=length(_macro_tmp_1118_0);var _macro_tmp_1118_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1118_0,_macro_tmp_1118_1+_macro_tmp_1118_2);array_copy(_macro_tmp_1118_0,_macro_tmp_1118_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1118_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==KW_VAR){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(KW_VAR)});};

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var var1=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]),var2=null;
var type1=-1,type2=-1;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_1130_0,_macro_tmp_1130_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_1130_1))return 0,_macro_tmp_1130_1;list_off=_macro_tmp_1130_1;;type1=_macro_tmp_1130_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
}

if((list_tokens[list_off]===(','))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
var2=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
if((list_tokens[list_off]===(':'))){
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_1145_0,_macro_tmp_1145_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_1145_1))return 0,_macro_tmp_1145_1;list_off=_macro_tmp_1145_1;;type2=_macro_tmp_1145_0;;;
}
else{
list_off-=TOK_SIZE;;
}
}
else{
list_off-=TOK_SIZE;;
}

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};
if(!(list_tokens[list_off+TOK_len]===length("in")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("in"))){
return 0,error({script_line(line),": expected 'in'"});
}

var iter_var={"__classes_tmp_",tmp_cnt++};
var arr_var={"__classes_tmp_",tmp_cnt++};

tokens_parse(gen->GEN_func_tokens,list_src,{"for (var ",iter_var,"=0, ",arr_var,"="},line);

gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)-TOK_SIZE);
list_off+=TOK_SIZE;;
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;

var struct_type=null;
var expr_start_pos=(list_off);
list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;
if(gen->GEN_ret_type!=TYPE_DYNAMIC){
var arr_type=get_type_array_or_hash(gen->GEN_ret_type);
if(var2){
if(!arr_type||arr_type[0]!=EXT_TYPE_HASH){
return 0,error({script_line(line),": must be a hash table"});
}
if(type1==-1)type1=arr_type->HASH_index_type;
if(type2==-1)type2=arr_type->HASH_base_type;
}
else{
if(is_array(gen->GEN_ret_type)&&gen->GEN_ret_type[0]==EXT_TYPE_STRUCT_ARRAY){
struct_type=gen->GEN_ret_type->ARRAY_base_type;
if(struct_type==TYPE_DYNAMIC){
return 0,error({script_line(line),": struct array must use concrete struct type"});
}
if(type1!=-1){
return 0,error({script_line(line),": value retyping is not allowed for structs"});
}
type1=struct_type;
}
else{
if(gen->GEN_ret_type==TYPE_STRING){
if(type1==-1)type1=TYPE_INTEGER;
}
else{
if(!arr_type||arr_type[0]!=EXT_TYPE_ARRAY){
return 0,error({script_line(line),": must be an array or a string"});
}
if(type1==-1)type1=arr_type->ARRAY_base_type;
}
}
}
}
else{
if(type1==-1)type1=TYPE_DYNAMIC;
if(type2==-1)type2=TYPE_DYNAMIC;
}
append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};
var _macro_tmp_1169_0=gen->GEN_func_tokens;var _macro_tmp_1169_1=length(_macro_tmp_1169_0);var _macro_tmp_1169_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1169_0,_macro_tmp_1169_1+_macro_tmp_1169_2);array_copy(_macro_tmp_1169_0,_macro_tmp_1169_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1169_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};

if(var2){
tokens_parse(gen->GEN_func_tokens,list_src,{"; ",iter_var,"<length(",arr_var,"); ",iter_var,"++) { var (",var1,", ",var2,") = hash_entry(",arr_var,", ",iter_var,");"},line);
}
else{
if(struct_type){
tokens_parse(gen->GEN_func_tokens,list_src,{", ",var1,"; ",iter_var,"<length(",arr_var,"); ",iter_var,"+=",struct_type->CLASS_compat_name,"_SIZE) { ",var1," = add32(",iter_var,", ",struct_type->CLASS_compat_name,"_SIZE);"},line);
}
else{
tokens_parse(gen->GEN_func_tokens,list_src,{", ",var1,"; ",iter_var,"<length(",arr_var,"); ",iter_var,"++) { ",var1," = ",arr_var,"[",iter_var,"];"},line);
}
}

gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)-TOK_SIZE);
list_off+=TOK_SIZE;;
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;

var for_stack_pos=length(gen->GEN_var_stack);

if(hash_contains(gen->GEN_vars,var1)){
return 0,error({script_line(line),": duplicate variable"});
}
gen->GEN_vars{var1}=type1;
gen->GEN_var_stack[]=var1;

if(var2){
if(hash_contains(gen->GEN_vars,var2)){
return 0,error({script_line(line),": duplicate variable"});
}
gen->GEN_vars{var2}=type2;
gen->GEN_var_stack[]=var2;
}

list_off=parse_block(gen,list_tokens,list_src,list_off,BT_NORMAL);;

for(var i=length(gen->GEN_var_stack)-1;i>=for_stack_pos;i--){
hash_remove(gen->GEN_vars,gen->GEN_var_stack[i]);
}
array_set_length(gen->GEN_var_stack,for_stack_pos);
continue;
}
break;
}

case ';':{
continue;
}
}

list_off-=TOK_SIZE;;
list_off=parse_expression(gen,list_tokens,list_src,list_off,-2,(list_off),PRIO_PRIMARY);;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==';'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(';'),"'"});};
}

list_off-=TOK_SIZE;;
return 0,error({script_line((list_tokens[list_off+TOK_line])),": unexpected EOF"});
}


























































































function@obtain_generic_types(dest_type,src_type,generic_types)
{
if(dest_type==TYPE_KEY){
if(generic_types[0]==-1){
generic_types[0]=src_type;
}
return;
}
if(dest_type==TYPE_VALUE){
if(generic_types[1]==-1){
generic_types[1]=src_type;
}
return;
}

if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_ARRAY){
if(src_type==TYPE_STRING){
obtain_generic_types(dest_type->ARRAY_base_type,TYPE_INTEGER,generic_types);
}
else if(is_array(src_type)&&src_type[0]==EXT_TYPE_ARRAY){
obtain_generic_types(dest_type->ARRAY_base_type,src_type->ARRAY_base_type,generic_types);
}
return;
}

if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_HASH&&is_array(src_type)&&src_type[0]==EXT_TYPE_HASH){
obtain_generic_types(dest_type->HASH_base_type,src_type->HASH_base_type,generic_types);
obtain_generic_types(dest_type->HASH_index_type,src_type->HASH_index_type,generic_types);
return;
}
}

function@apply_generic_types(type,generic_types,line)
{
if(type==TYPE_KEY){
if(generic_types[0]==-1){
return 0,error({script_line(line),": generic key type not defined"});
}
return generic_types[0];
}
if(type==TYPE_VALUE){
if(generic_types[1]==-1){
return 0,error({script_line(line),": generic value type not defined"});
}
return generic_types[1];
}
if(is_array(type)&&type[0]==EXT_TYPE_ARRAY){
return create_array_type(
apply_generic_types(type->ARRAY_base_type,generic_types,line)
);
}
if(is_array(type)&&type[0]==EXT_TYPE_HASH){
return create_hash_type(
apply_generic_types(type->HASH_base_type,generic_types,line),
apply_generic_types(type->HASH_index_type,generic_types,line)
);
}
return type;
}
function@add_completion(value,prefix)
{
if(!prefix||string_starts_with(value,prefix)){
@fixide_add_completion(value);
}
}

function@export_type(gen,type,prefix)
{
var class=get_type_class_or_struct(type);
if(class){
for(var i=0;i<length(class->CLASS_fields);i++){
var(name,field)=hash_entry(class->CLASS_fields,i);
add_completion(name,prefix);
}
for(var i=0;i<length(class->CLASS_functions);i++){
var(name,func)=hash_entry(class->CLASS_functions,i);
add_completion({func->FUNC_name,"()"},prefix);
}
}
else if(is_array(type)){
if(type[0]==EXT_TYPE_ARRAY){
add_completion("length",prefix);
export_instance_functions(gen,"array_",prefix);
}
else if(type[0]==EXT_TYPE_HASH){
add_completion("length",prefix);
export_instance_functions(gen,"hash_",prefix);
}
else if(type[0]==EXT_TYPE_STRUCT_ARRAY){
add_completion("first",prefix);
add_completion("last",prefix);
add_completion("length",prefix);
}
}
else if(type==TYPE_STRING){
add_completion("length",prefix);
export_instance_functions(gen,"string_",prefix);
}
}

function@export_instance_functions(gen,func_prefix,prefix)
{
var map={};
merge_hash(map,builtin_instance_functions);
if(gen->GEN_imported_instance_functions){
merge_hash(map,gen->GEN_imported_instance_functions);
}
if(gen->GEN_instance_functions){
merge_hash(map,gen->GEN_instance_functions);
}
for(var i=0;i<length(map);i++){
var(name,func)=hash_entry(map,i);
if(string_starts_with(name,func_prefix)){
add_completion({array_extract(func->FUNC_name,length(func_prefix),length(func->FUNC_name)-length(func_prefix)),"()"},prefix);
}
}
}
function@parse_expression(gen,list_tokens,list_src,list_off,prev_type,start_pos,prio)
{
var is_statement=false;
if(prev_type==-2){
is_statement=true;
prev_type=-1;
}
var outer=(prev_type==-1);
var last_pos=(list_off)-TOK_SIZE;

for(;;){
var type=-1;
var off=(list_off);
var unary_off=off;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};

for(;;){
switch((list_tokens[list_off])){case '+','-':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};switch((list_tokens[list_off])){case TOK_NUMBER,TOK_HEX_NUMBER,TOK_FLOAT_NUMBER:list_off-=TOK_SIZE;;break;default:continue;}break;case '~','!':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};continue;case '++','--':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};continue;};
unary_off=(list_off)-TOK_SIZE;
break;
}

switch((list_tokens[list_off])){case '(':{list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};break;}case '[':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(']'))){type=create_array_type(TYPE_DYNAMIC);break;}else{list_off-=TOK_SIZE;;}var common_type=-1;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_type==-1){common_type=gen->GEN_ret_type;}else if(common_type!=gen->GEN_ret_type){common_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};type=create_array_type(common_type);break;}case '{':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}'))){type=create_hash_type(TYPE_DYNAMIC,TYPE_DYNAMIC);break;}if((list_tokens[list_off]===('='))){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}list_off-=TOK_SIZE;;var pos=(list_off);var ext_type=-1,level=0,first=true;while(((list_off+=TOK_SIZE)<length(list_tokens))){switch((list_tokens[list_off])){case '(':case '{':case '[':level++;first=false;continue;case ')':case '}':case ']':if(--level<0)break;if(level==0&&(list_tokens[list_off])=='}'){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('='))){ext_type=ET_BLOCK;break;}else{list_off-=TOK_SIZE;;}}first=false;continue;case '+':case '-':if(first){first=false;continue;}case '*':case '/':case '<':case '>':if(level==0&&ext_type==-1){ext_type=ET_FLOAT;}first=false;continue;case '?':if(level==0&&ext_type==-1){ext_type=ET_STRING;}first=false;continue;case ':':if(level==0&&ext_type==-1){ext_type=ET_HASH;}first=false;continue;case ',':if(level==0&&(ext_type==-1||ext_type==ET_FLOAT)){ext_type=ET_STRING;}first=false;continue;case ';':if(level==0){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('='))){ext_type=ET_BLOCK;break;}else{list_off-=TOK_SIZE;;}}first=false;continue;case '<=':case '>=':case '==':case '!=':if(level==0&&ext_type==-1){ext_type=ET_FLOAT;}first=false;continue;default:first=false;continue;}break;}if(ext_type==-1){ext_type=ET_STRING;}list_off=pos;;if(ext_type==ET_BLOCK){list_off=parse_block(gen,list_tokens,list_src,list_off,BT_EXPR);;type=gen->GEN_ret_type;break;}if(ext_type==ET_FLOAT){var float_op=-1;for(;;){list_off=parse_primary_expression(gen,list_tokens,list_src,list_off);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var fop=-1;var tok_type=(list_tokens[list_off]);if(tok_type>=' '){if(tok_type=='}'&&float_op!=-1)break;switch(tok_type){case '+','-':fop=FO_ADD_SUB;break;case '*','/':fop=FO_MUL_DIV;break;}}if(fop==-1||(float_op!=-1&&fop!=float_op)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected float operator"});}float_op=fop;}type=TYPE_FLOAT;break;}if(ext_type==ET_HASH){var common_base_type=-1;var common_index_type=-1;for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}')))break;list_off-=TOK_SIZE;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_index_type==-1){common_index_type=gen->GEN_ret_type;}else if(common_index_type!=gen->GEN_ret_type){common_index_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_base_type==-1){common_base_type=gen->GEN_ret_type;}else if(common_base_type!=gen->GEN_ret_type){common_base_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}type=create_hash_type(common_base_type,common_index_type);break;}if(ext_type==ET_STRING){for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}')))break;list_off-=TOK_SIZE;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}type=TYPE_STRING;break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": internal error: invalid extended operator"});}case '@':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1294_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1294_0++;continue;case ')','}',']':if(!_macro_tmp_1294_0)break;_macro_tmp_1294_0--;continue;case ',',';':if(!_macro_tmp_1294_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}var name={func_name,"#",num_params};var func=hash_get(builtin_functions,name,null);if(func){list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,(func->FUNC_flags&FUNC_FLAG_STATIC)?i:i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;}else{list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=TYPE_DYNAMIC;}break;}case '+','-':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};switch((list_tokens[list_off])){case TOK_NUMBER,TOK_HEX_NUMBER:type=TYPE_INTEGER;break;case TOK_FLOAT_NUMBER:type=TYPE_FLOAT;break;}break;case TOK_NUMBER,TOK_HEX_NUMBER,TOK_CHAR:type=TYPE_INTEGER;break;case TOK_FLOAT_NUMBER:type=TYPE_FLOAT;break;case TOK_STRING:type=TYPE_STRING;break;case TOK_FUNC_REF:type=TYPE_DYNAMIC;break;case TOK_IDENT:{var var_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(var_name=="new"){var line=(list_tokens[list_off+TOK_line]);var _macro_tmp_1327_0=gen->GEN_func_tokens;var _macro_tmp_1327_1=length(_macro_tmp_1327_0);var _macro_tmp_1327_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1327_0,_macro_tmp_1327_1+_macro_tmp_1327_2);array_copy(_macro_tmp_1327_0,_macro_tmp_1327_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1327_2);gen->GEN_last_func_pos=list_off;;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var class_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,class_name);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",class_name});}if(class->CLASS_ext_type==EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use new on structs"});}if(class!==hash_get(gen->GEN_classes,class->CLASS_name,null)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use new on class ",class_name," from other script"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var extend=false;if((list_tokens[list_off]===(':'))){extend=true;if(!class->CLASS_parent){return 0,error({script_line((list_tokens[list_off+TOK_line])),": class ",class_name," has no parent"});}}else{list_off-=TOK_SIZE;;}list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(extend){if(class->CLASS_virtual){var name={"vfunc__",class->CLASS_method_prefix,"_object_extend"};var src_off=length(list_src);array_set_length(list_src,src_off+length(name));array_copy(list_src,src_off,name,0,length(name));;var src_off2=length(list_src);array_set_length(list_src,src_off2+length("()"));array_copy(list_src,src_off2,"()",0,length("()"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(name);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,class->CLASS_parent,gen->GEN_ret_type);list_off+=TOK_SIZE;;var _macro_tmp_1354_0=gen->GEN_func_tokens;var _macro_tmp_1354_1=length(_macro_tmp_1354_0);var _macro_tmp_1354_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1354_0,_macro_tmp_1354_1+_macro_tmp_1354_2);array_copy(_macro_tmp_1354_0,_macro_tmp_1354_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1354_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off2+1;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("object_extend(,)"));array_copy(list_src,src_off,"object_extend(,)",0,length("object_extend(,)"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=13;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off+13;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,class->CLASS_parent,gen->GEN_ret_type);list_off+=TOK_SIZE;;var _macro_tmp_1367_0=gen->GEN_func_tokens;var _macro_tmp_1367_1=length(_macro_tmp_1367_0);var _macro_tmp_1367_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1367_0,_macro_tmp_1367_1+_macro_tmp_1367_2);array_copy(_macro_tmp_1367_0,_macro_tmp_1367_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1367_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off+14;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var size_const={class->CLASS_compat_name,"_SIZE"};var src_off2=length(list_src);array_set_length(list_src,src_off2+length(size_const));array_copy(list_src,src_off2,size_const,0,length(size_const));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=length(size_const);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off+15;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}}else{if(class->CLASS_virtual){var name={"vfunc__",class->CLASS_method_prefix,"_object_create"};var src_off=length(list_src);array_set_length(list_src,src_off+length(name));array_copy(list_src,src_off,name,0,length(name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(name);gen->GEN_func_tokens[]=line;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length("()"));array_copy(list_src,src_off2,"()",0,length("()"));;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off2+1;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("object_create()"));array_copy(list_src,src_off,"object_create()",0,length("object_create()"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=13;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off+13;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var size_const={class->CLASS_compat_name,"_SIZE"};var src_off2=length(list_src);array_set_length(list_src,src_off2+length(size_const));array_copy(list_src,src_off2,size_const,0,length(size_const));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=length(size_const);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off+14;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}}type=class;break;}else if(var_name=="super"){var line=(list_tokens[list_off+TOK_line]);var class=gen->GEN_cur_class;if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be used in class"});}if(gen->GEN_cur_func->FUNC_flags&FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be used in instance method"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1395_0=gen->GEN_func_tokens;var _macro_tmp_1395_1=length(_macro_tmp_1395_0);var _macro_tmp_1395_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1395_0,_macro_tmp_1395_1+_macro_tmp_1395_2);array_copy(_macro_tmp_1395_0,_macro_tmp_1395_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1395_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1408_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1408_0++;continue;case ')','}',']':if(!_macro_tmp_1408_0)break;_macro_tmp_1408_0--;continue;case ',',';':if(!_macro_tmp_1408_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};tokens_parse(gen->GEN_func_tokens,list_src,{"this->",gen->GEN_cur_class->CLASS_compat_name,"__super__",func_name,"__",num_params+1},line);var name={func_name,"#",num_params+1};var func=null;for(;;){class=class->CLASS_parent;if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": virtual function ",func_name," not found in super classes"});}func=hash_get(class->CLASS_functions,name,null);if(func&&(func->FUNC_flags&(FUNC_FLAG_VIRTUAL|FUNC_FLAG_OVERRIDE))==FUNC_FLAG_VIRTUAL){break;}}list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var _macro_tmp_1427_0=gen->GEN_func_tokens;var _macro_tmp_1427_1=length(_macro_tmp_1427_0);var _macro_tmp_1427_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1427_0,_macro_tmp_1427_1+_macro_tmp_1427_2);array_copy(_macro_tmp_1427_0,_macro_tmp_1427_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1427_2);gen->GEN_last_func_pos=list_off;;;if(num_params>0){var src_off=length(list_src);array_set_length(list_src,src_off+length("this,"));array_copy(list_src,src_off,"this,",0,length("this,"));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1430_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens[-params_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1430_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1430_1=length(func_tokens);var _macro_tmp_1430_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1430_1+_macro_tmp_1430_2);array_copy(func_tokens,func_pos+_macro_tmp_1430_2,func_tokens,func_pos,_macro_tmp_1430_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=4;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=',';func_tokens[func_pos++]=src_off+4;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("this"));array_copy(list_src,src_off,"this",0,length("this"));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1435_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens[-params_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1435_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1435_1=length(func_tokens);var _macro_tmp_1435_2=(1)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1435_1+_macro_tmp_1435_2);array_copy(func_tokens,func_pos+_macro_tmp_1435_2,func_tokens,func_pos,_macro_tmp_1435_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=4;func_tokens[func_pos++]=line;;}type=func->FUNC_return_type;break;}if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===(':'))){if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===(':'))){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off])==TOK_FUNC_REF){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var cls_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,cls_name);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",cls_name});}var _macro_tmp_1450_0=gen->GEN_func_tokens;var _macro_tmp_1450_1=length(_macro_tmp_1450_0);var _macro_tmp_1450_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1450_0,_macro_tmp_1450_1+_macro_tmp_1450_2);array_copy(_macro_tmp_1450_0,_macro_tmp_1450_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1450_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var func=hash_get(class->CLASS_functions,func_name,null);if(!func||((func->FUNC_flags&FUNC_FLAG_PRIVATE)&&class!==hash_get(gen->GEN_classes,class->CLASS_name,null))){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown method ",func_name," in ",cls_name});}var func_ref={class->CLASS_method_prefix,func_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(func_ref));array_copy(list_src,src_off,func_ref,0,length(func_ref));;list_tokens[list_off+TOK_off]=src_off;list_tokens[list_off+TOK_len]=length(func_ref);type=TYPE_DYNAMIC;break;}else if((list_tokens[list_off])!=TOK_IDENT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected identifier or function reference"});}var line=(list_tokens[list_off+TOK_line]);var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,var_name);if(!class){var kind;if(var_name=="Array"){kind="array";}else if(var_name=="String"){kind="string";}else if(var_name=="Hash"){kind="hash";}if(kind){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1467_0=gen->GEN_func_tokens;var _macro_tmp_1467_1=length(_macro_tmp_1467_0);var _macro_tmp_1467_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1467_0,_macro_tmp_1467_1+_macro_tmp_1467_2);array_copy(_macro_tmp_1467_0,_macro_tmp_1467_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1467_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1481_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1481_0++;continue;case ')','}',']':if(!_macro_tmp_1481_0)break;_macro_tmp_1481_0--;continue;case ',',';':if(!_macro_tmp_1481_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={kind,"_",func_name,"#",num_params};var func=null;if(gen->GEN_static_functions){func=hash_get(gen->GEN_static_functions,name,null);}if(!func){if(gen->GEN_imported_static_functions){func=hash_get(gen->GEN_imported_static_functions,name,null);}if(!func){func=hash_get(builtin_static_functions,name,null);}}if(!func){return 0,error({script_line(line),": static function ",name," not found for ",kind," type"});}var full_name=func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name;var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(full_name);gen->GEN_func_tokens[]=line;;var generic_types=[-1,-1];list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;obtain_generic_types(param_type,gen->GEN_ret_type,generic_types);param_type=apply_generic_types(param_type,generic_types,(list_tokens[list_off+TOK_line]));append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=apply_generic_types(func->FUNC_return_type,generic_types,line);break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",var_name});}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1506_0=gen->GEN_func_tokens;var _macro_tmp_1506_1=length(_macro_tmp_1506_0);var _macro_tmp_1506_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1506_0,_macro_tmp_1506_1+_macro_tmp_1506_2);array_copy(_macro_tmp_1506_0,_macro_tmp_1506_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1506_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===('('))){gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(func_name=="SIZE"){tokens_parse(gen->GEN_func_tokens,list_src,{class->CLASS_compat_name,"_SIZE"},line);type=TYPE_INTEGER;}else{var cls=class;var found=false;while(cls){var field=hash_get(cls->CLASS_fields,func_name,null);if(field&&(!field->FIELD_private||cls===hash_get(gen->GEN_classes,cls->CLASS_name,null))){tokens_parse(gen->GEN_func_tokens,list_src,{cls->CLASS_compat_name,"_",func_name},line);type=TYPE_INTEGER;found=true;break;}cls=cls->CLASS_parent;}if(!found){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown field ",func_name," in ",get_class_name_with_kind(class)});}}break;}gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1525_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1525_0++;continue;case ')','}',']':if(!_macro_tmp_1525_0)break;_macro_tmp_1525_0--;continue;case ',',';':if(!_macro_tmp_1525_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={func_name,"#",num_params};var func=hash_get(class->CLASS_functions,name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_STATIC)||((func->FUNC_flags&FUNC_FLAG_PRIVATE)&&class!==hash_get(gen->GEN_classes,class->CLASS_name,null)))){func=null;}if(!func){return 0,error({script_line(line),": static function ",name," not found in ",get_class_name_with_kind(class)});}var full_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(full_name);gen->GEN_func_tokens[]=line;;list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;break;}else if((list_tokens[list_off])==TOK_IDENT||(list_tokens[list_off])==TOK_FUNC_REF){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var alias=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var ia=gen->GEN_import_aliases?hash_get(gen->GEN_import_aliases,alias,null):null;if(ia){var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var const_type=hash_get(ia->IMPORT_ALIAS_consts,name,-1);if(const_type!=-1){type=const_type;break;}if(hash_contains(ia->IMPORT_ALIAS_locals,name)){type=TYPE_DYNAMIC;break;}if(hash_contains(ia->IMPORT_ALIAS_funcs,name)){if((list_tokens[list_off])==TOK_FUNC_REF){type=TYPE_DYNAMIC;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}type=TYPE_DYNAMIC;break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": constant, local variable or function not found in script with import alias '",alias,"'"});}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}type=hash_get(gen->GEN_consts,var_name,-1);if(type==-1){switch(length(var_name)){case 4:if(var_name=="null"){type=TYPE_DYNAMIC;break;}if(var_name=="true"){type=TYPE_BOOLEAN;break;}break;case 5:if(var_name=="false"){type=TYPE_BOOLEAN;break;}break;}}if(type==-1){type=hash_get(gen->GEN_vars,var_name,-1);}if(type==-1){var class=gen->GEN_cur_class;while(class){var field=hash_get(class->CLASS_fields,var_name,null);if(field&&(!field->FIELD_private||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){if((gen->GEN_cur_func->FUNC_flags&(FUNC_FLAG_STATIC|FUNC_FLAG_CONSTRUCTOR))==FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't reference instance fields"});}var _macro_tmp_1579_0=gen->GEN_func_tokens;var _macro_tmp_1579_1=length(_macro_tmp_1579_0);var _macro_tmp_1579_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1579_0,_macro_tmp_1579_1+_macro_tmp_1579_2);array_copy(_macro_tmp_1579_0,_macro_tmp_1579_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1579_2);gen->GEN_last_func_pos=list_off;;;var line=(list_tokens[list_off+TOK_line]);var src_off=length(list_src);array_set_length(list_src,src_off+length({"this->",field->FIELD_compat_name}));array_copy(list_src,src_off,{"this->",field->FIELD_compat_name},0,length({"this->",field->FIELD_compat_name}));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=4;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='->';gen->GEN_func_tokens[]=src_off+4;gen->GEN_func_tokens[]=2;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off+6;gen->GEN_func_tokens[]=length(field->FIELD_compat_name);gen->GEN_func_tokens[]=line;;gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);((list_off+=TOK_SIZE)<length(list_tokens));gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field->FIELD_type;break;}class=class->CLASS_parent;}}if(type==-1&&gen->GEN_locals){var local=hash_get(gen->GEN_locals,var_name,null);if(local){type=local->LOCAL_type;}}if(type==-1&&gen->GEN_imported_locals){var local=hash_get(gen->GEN_imported_locals,var_name,null);if(local){type=local->LOCAL_type;}}if(type==-1){if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===('('))){list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1602_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1602_0++;continue;case ')','}',']':if(!_macro_tmp_1602_0)break;_macro_tmp_1602_0--;continue;case ',',';':if(!_macro_tmp_1602_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={func_name,"#",num_params};if(gen->GEN_cur_class){var class=gen->GEN_cur_class;var func,orig_class=class,struct_type;var instance_name={func_name,"#",num_params+1};while(class){func=hash_get(class->CLASS_functions,instance_name,null);if(func){if(!(func->FUNC_flags&FUNC_FLAG_STATIC)&&!(func->FUNC_flags&FUNC_FLAG_OVERRIDE)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){if((gen->GEN_cur_func->FUNC_flags&(FUNC_FLAG_STATIC|FUNC_FLAG_CONSTRUCTOR))==FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't reference instance methods"});}break;}func=null;}class=class->CLASS_parent;}if(!func){class=orig_class;while(class){func=hash_get(class->CLASS_functions,name,null);if(func){if((func->FUNC_flags&FUNC_FLAG_STATIC)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){break;}func=null;}class=class->CLASS_parent;}if(!func){func=find_function(gen,name);if(!func&&num_params==1){struct_type=find_class(gen,func_name);if(!struct_type||struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){struct_type=null;}}}}list_off=params_off;;if(func){for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,(func->FUNC_flags&FUNC_FLAG_STATIC)?i:i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}}else if(struct_type){list_off-=TOK_SIZE;;var _macro_tmp_1620_0=gen->GEN_func_tokens;var _macro_tmp_1620_1=length(_macro_tmp_1620_0);var _macro_tmp_1620_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1620_0,_macro_tmp_1620_1+_macro_tmp_1620_2);array_copy(_macro_tmp_1620_0,_macro_tmp_1620_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1620_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,params_off,TYPE_INTEGER,gen->GEN_ret_type);}else{var ctx=gen->GEN_custom_ctx;var func_call_list=null,func_call_idx,func_types=null,call_start_pos;if(ctx){var func_list=hash_get(ctx->CTX_function_calls,func_name,ctx->CTX_function_calls_any);if(func_list){for(var i=0;i<length(func_list);i+=FUNC_CALL_SIZE){func_types=func_list[i+FUNC_CALL_get_types_func](func_list[i+FUNC_CALL_data],func_name,num_params,(list_tokens[list_off+TOK_line]));if(func_types){if(length(func_types)!=num_params+1){return 0,error({"improper number of function types returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}list_off+=TOK_SIZE;;var _macro_tmp_1632_0=gen->GEN_func_tokens;var _macro_tmp_1632_1=length(_macro_tmp_1632_0);var _macro_tmp_1632_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1632_0,_macro_tmp_1632_1+_macro_tmp_1632_2);array_copy(_macro_tmp_1632_0,_macro_tmp_1632_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1632_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;call_start_pos=length(gen->GEN_func_tokens);func_call_list=func_list;func_call_idx=i;break;}}}}for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(func_types){if(func_types[i+1]==TYPE_DYNAMIC){func_types[i+1]=gen->GEN_ret_type;}else{append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,func_types[i+1],gen->GEN_ret_type);}}}if(func_types){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_1645_0=gen->GEN_func_tokens;var _macro_tmp_1645_1=length(_macro_tmp_1645_0);var _macro_tmp_1645_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1645_0,_macro_tmp_1645_1+_macro_tmp_1645_2);array_copy(_macro_tmp_1645_0,_macro_tmp_1645_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1645_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var end_pos=func_call_list[func_call_idx+FUNC_CALL_adjust_call_func](func_call_list[func_call_idx+FUNC_CALL_data],func_name,func_types,gen->GEN_func_tokens,list_src,call_start_pos-TOK_SIZE*2,length(gen->GEN_func_tokens));if(end_pos!=length(gen->GEN_func_tokens)){return 0,error({"invalid end position returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}type=func_types[0];}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_1653_0=gen->GEN_func_tokens;var _macro_tmp_1653_1=length(_macro_tmp_1653_0);var _macro_tmp_1653_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1653_0,_macro_tmp_1653_1+_macro_tmp_1653_2);array_copy(_macro_tmp_1653_0,_macro_tmp_1653_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1653_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(func){if(class){var full_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;var search_off=list_tokens[params_off-TOK_SIZE+TOK_off];var func_tokens=gen->GEN_func_tokens;for(var idx=length(func_tokens)-TOK_SIZE;;idx-=TOK_SIZE){if(func_tokens[idx+TOK_off]==search_off){func_tokens[idx+TOK_type]=TOK_IDENT;func_tokens[idx+TOK_off]=src_off;func_tokens[idx+TOK_len]=length(full_name);break;}}}if(!(func->FUNC_flags&FUNC_FLAG_STATIC)){if(num_params>0){var src2_off=length(list_src);array_set_length(list_src,src2_off+length("this,"));array_copy(list_src,src2_off,"this,",0,length("this,"));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_1658_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens2[-params_off+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_1658_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1658_1=length(func_tokens2);var _macro_tmp_1658_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_1658_1+_macro_tmp_1658_2);array_copy(func_tokens2,func_pos+_macro_tmp_1658_2,func_tokens2,func_pos,_macro_tmp_1658_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src2_off;func_tokens2[func_pos++]=4;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]=',';func_tokens2[func_pos++]=src2_off+4;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;}else{var src2_off=length(list_src);array_set_length(list_src,src2_off+length("this"));array_copy(list_src,src2_off,"this",0,length("this"));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_1663_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens2[-params_off+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_1663_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1663_1=length(func_tokens2);var _macro_tmp_1663_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_1663_1+_macro_tmp_1663_2);array_copy(func_tokens2,func_pos+_macro_tmp_1663_2,func_tokens2,func_pos,_macro_tmp_1663_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src2_off;func_tokens2[func_pos++]=4;func_tokens2[func_pos++]=line;;}}type=func->FUNC_return_type;}else if(struct_type){var src_off=length(list_src);array_set_length(list_src,src_off+length("add32("));array_copy(list_src,src_off,"add32(",0,length("add32("));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_1667_0=params_off-2*TOK_SIZE>=0?list_tokens[params_off-2*TOK_SIZE+TOK_off]:func_tokens2[-params_off-2*TOK_SIZE+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_1667_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1667_1=length(func_tokens2);var _macro_tmp_1667_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_1667_1+_macro_tmp_1667_2);array_copy(func_tokens2,func_pos+_macro_tmp_1667_2,func_tokens2,func_pos,_macro_tmp_1667_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src_off;func_tokens2[func_pos++]=5;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]='(';func_tokens2[func_pos++]=src_off+5;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{"*",struct_type->CLASS_compat_name,"_SIZE, ",struct_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=struct_type;}}else{var func=find_function(gen,name),struct_type;if(!func&&num_params==1){struct_type=find_class(gen,func_name);if(!struct_type||struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){struct_type=null;}}list_off=params_off;;if(func){for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;}else if(struct_type){list_off-=TOK_SIZE;;var _macro_tmp_1683_0=gen->GEN_func_tokens;var _macro_tmp_1683_1=length(_macro_tmp_1683_0);var _macro_tmp_1683_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1683_0,_macro_tmp_1683_1+_macro_tmp_1683_2);array_copy(_macro_tmp_1683_0,_macro_tmp_1683_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1683_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,params_off,TYPE_INTEGER,gen->GEN_ret_type);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_1695_0=gen->GEN_func_tokens;var _macro_tmp_1695_1=length(_macro_tmp_1695_0);var _macro_tmp_1695_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1695_0,_macro_tmp_1695_1+_macro_tmp_1695_2);array_copy(_macro_tmp_1695_0,_macro_tmp_1695_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1695_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length("add32("));array_copy(list_src,src_off,"add32(",0,length("add32("));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_1699_0=params_off-2*TOK_SIZE>=0?list_tokens[params_off-2*TOK_SIZE+TOK_off]:func_tokens2[-params_off-2*TOK_SIZE+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_1699_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1699_1=length(func_tokens2);var _macro_tmp_1699_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_1699_1+_macro_tmp_1699_2);array_copy(func_tokens2,func_pos+_macro_tmp_1699_2,func_tokens2,func_pos,_macro_tmp_1699_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src_off;func_tokens2[func_pos++]=5;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]='(';func_tokens2[func_pos++]=src_off+5;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{"*",struct_type->CLASS_compat_name,"_SIZE, ",struct_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=struct_type;}else{var ctx=gen->GEN_custom_ctx;var func_call_list=null,func_call_idx,func_types=null,call_start_pos;if(ctx){var func_list=hash_get(ctx->CTX_function_calls,func_name,ctx->CTX_function_calls_any);if(func_list){for(var i=0;i<length(func_list);i+=FUNC_CALL_SIZE){func_types=func_list[i+FUNC_CALL_get_types_func](func_list[i+FUNC_CALL_data],func_name,num_params,(list_tokens[list_off+TOK_line]));if(func_types){if(length(func_types)!=num_params+1){return 0,error({"improper number of function types returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}list_off+=TOK_SIZE;;var _macro_tmp_1707_0=gen->GEN_func_tokens;var _macro_tmp_1707_1=length(_macro_tmp_1707_0);var _macro_tmp_1707_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1707_0,_macro_tmp_1707_1+_macro_tmp_1707_2);array_copy(_macro_tmp_1707_0,_macro_tmp_1707_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1707_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;call_start_pos=length(gen->GEN_func_tokens);func_call_list=func_list;func_call_idx=i;break;}}}}for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(func_types){if(func_types[i+1]==TYPE_DYNAMIC){func_types[i+1]=gen->GEN_ret_type;}else{append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,func_types[i+1],gen->GEN_ret_type);}}}if(func_types){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_1720_0=gen->GEN_func_tokens;var _macro_tmp_1720_1=length(_macro_tmp_1720_0);var _macro_tmp_1720_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1720_0,_macro_tmp_1720_1+_macro_tmp_1720_2);array_copy(_macro_tmp_1720_0,_macro_tmp_1720_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1720_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var end_pos=func_call_list[func_call_idx+FUNC_CALL_adjust_call_func](func_call_list[func_call_idx+FUNC_CALL_data],func_name,func_types,gen->GEN_func_tokens,list_src,call_start_pos-TOK_SIZE*2,length(gen->GEN_func_tokens));if(end_pos!=length(gen->GEN_func_tokens)){return 0,error({"invalid end position returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}type=func_types[0];}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}}}else{list_off-=TOK_SIZE;;}}}if(type==-1){type=TYPE_DYNAMIC;}break;}};

if(type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected value"});
}

while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){case '.':{if(fixide&&gen->GEN_fixide_cursor>=0){var ident_prefix=null;if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off])==TOK_IDENT){var token_off=(list_tokens[list_off+TOK_off]);var token_len=(list_tokens[list_off+TOK_len]);if(gen->GEN_fixide_cursor>=token_off&&gen->GEN_fixide_cursor<=token_off+token_len){ident_prefix=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);array_set_length(ident_prefix,gen->GEN_fixide_cursor-token_off);export_type(gen,type,ident_prefix);}}list_off-=TOK_SIZE;;}if(!ident_prefix){if((list_tokens[list_off+TOK_off])+1==gen->GEN_fixide_cursor){export_type(gen,type,null);}}};if(type==TYPE_STRING||(is_array(type)&&(type[0]==EXT_TYPE_ARRAY||type[0]==EXT_TYPE_HASH))){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){var kind,generic_types;if(is_array(type)&&type[0]==EXT_TYPE_ARRAY){kind="array";generic_types=[-1,type->ARRAY_base_type];}else if(type==TYPE_STRING){kind="string";generic_types=[-1,-1];}else if(is_array(type)&&type[0]==EXT_TYPE_HASH){kind="hash";generic_types=[type->HASH_index_type,type->HASH_base_type];}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1749_0=gen->GEN_func_tokens;var _macro_tmp_1749_1=length(_macro_tmp_1749_0);var _macro_tmp_1749_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1749_0,_macro_tmp_1749_1+_macro_tmp_1749_2);array_copy(_macro_tmp_1749_0,_macro_tmp_1749_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1749_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};gen->GEN_last_func_pos=list_off;;;var num_params=1;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length(","));array_copy(list_src,src_off,",",0,length(","));;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;for(;;){num_params++;var _macro_tmp_1762_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1762_0++;continue;case ')','}',']':if(!_macro_tmp_1762_0)break;_macro_tmp_1762_0--;continue;case ',',';':if(!_macro_tmp_1762_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};name={kind,"_",name,"#",num_params};var func=null;if(gen->GEN_instance_functions){func=hash_get(gen->GEN_instance_functions,name,null);}if(!func){if(gen->GEN_imported_instance_functions){func=hash_get(gen->GEN_imported_instance_functions,name,null);}if(!func){func=hash_get(builtin_instance_functions,name,null);}}if(!func){return 0,error({script_line(line),": function ",name," not found for ",kind," type"});}var full_name=func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name;var src_off=length(list_src);array_set_length(list_src,src_off+length({full_name,"("}));array_copy(list_src,src_off,{full_name,"("},0,length({full_name,"("}));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1771_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1771_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1771_1=length(func_tokens);var _macro_tmp_1771_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1771_1+_macro_tmp_1771_2);array_copy(func_tokens,func_pos+_macro_tmp_1771_2,func_tokens,func_pos,_macro_tmp_1771_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(full_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(full_name);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var save_off=length(gen->GEN_func_tokens)-TOK_SIZE;var save_val=gen->GEN_func_tokens[save_off+TOK_off];gen->GEN_func_tokens[save_off+TOK_off]=list_tokens[params_off+TOK_off];list_off=params_off;;for(var i=1;i<num_params;i++){if(i>1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;param_type=apply_generic_types(param_type,generic_types,(list_tokens[list_off+TOK_line]));append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};gen->GEN_func_tokens[save_off+TOK_off]=save_val;type=apply_generic_types(func->FUNC_return_type,generic_types,line);if(name=="hash_entry#2"){if(gen->GEN_hash_entry_value_type!=-1){return 0,error({script_line(line),": both return values must be obtained for entry function"});}gen->GEN_hash_entry_value_type=apply_generic_types(TYPE_VALUE,generic_types,line);}continue;}else{list_off-=TOK_SIZE;;}if(name=="length"){list_off-=TOK_SIZE;;var _macro_tmp_1788_0=gen->GEN_func_tokens;var _macro_tmp_1788_1=length(_macro_tmp_1788_0);var _macro_tmp_1788_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1788_0,_macro_tmp_1788_1+_macro_tmp_1788_2);array_copy(_macro_tmp_1788_0,_macro_tmp_1788_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1788_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("length("));array_copy(list_src,src_off,"length(",0,length("length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1796_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1796_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1796_1=length(func_tokens);var _macro_tmp_1796_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1796_1+_macro_tmp_1796_2);array_copy(func_tokens,func_pos+_macro_tmp_1796_2,func_tokens,func_pos,_macro_tmp_1796_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=TYPE_INTEGER;continue;}}if(is_array(type)){if(type[0]==EXT_TYPE_STRUCT_ARRAY){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(name=="first"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_1807_0=gen->GEN_func_tokens;var _macro_tmp_1807_1=length(_macro_tmp_1807_0);var _macro_tmp_1807_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1807_0,_macro_tmp_1807_1+_macro_tmp_1807_2);array_copy(_macro_tmp_1807_0,_macro_tmp_1807_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1807_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1814_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1814_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1814_1=length(func_tokens);var _macro_tmp_1814_2=(0)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1814_1+_macro_tmp_1814_2);array_copy(func_tokens,func_pos+_macro_tmp_1814_2,func_tokens,func_pos,_macro_tmp_1814_1-func_pos);;;array_set_length(func_tokens,func_pos);tokens_parse(gen->GEN_func_tokens,list_src,{base_type->CLASS_compat_name,"_SIZE"},line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=base_type;continue;}if(name=="last"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_1819_0=gen->GEN_func_tokens;var _macro_tmp_1819_1=length(_macro_tmp_1819_0);var _macro_tmp_1819_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1819_0,_macro_tmp_1819_1+_macro_tmp_1819_2);array_copy(_macro_tmp_1819_0,_macro_tmp_1819_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1819_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("length("));array_copy(list_src,src_off,"length(",0,length("length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1827_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1827_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1827_1=length(func_tokens);var _macro_tmp_1827_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1827_1+_macro_tmp_1827_2);array_copy(func_tokens,func_pos+_macro_tmp_1827_2,func_tokens,func_pos,_macro_tmp_1827_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=base_type;continue;}if(name=="length"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_1834_0=gen->GEN_func_tokens;var _macro_tmp_1834_1=length(_macro_tmp_1834_0);var _macro_tmp_1834_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1834_0,_macro_tmp_1834_1+_macro_tmp_1834_2);array_copy(_macro_tmp_1834_0,_macro_tmp_1834_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1834_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("(length("));array_copy(list_src,src_off,"(length(",0,length("(length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1842_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1842_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1842_1=length(func_tokens);var _macro_tmp_1842_2=(3)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1842_1+_macro_tmp_1842_2);array_copy(func_tokens,func_pos+_macro_tmp_1842_2,func_tokens,func_pos,_macro_tmp_1842_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+7;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{")/",base_type->CLASS_compat_name,"_SIZE",")"},line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=TYPE_INTEGER;continue;}}}var class=get_type_class_or_struct(type);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be class or struct type"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(class->CLASS_ext_type==EXT_TYPE_STRUCT&&name=="index"){list_off-=TOK_SIZE;;var _macro_tmp_1854_0=gen->GEN_func_tokens;var _macro_tmp_1854_1=length(_macro_tmp_1854_0);var _macro_tmp_1854_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1854_0,_macro_tmp_1854_1+_macro_tmp_1854_2);array_copy(_macro_tmp_1854_0,_macro_tmp_1854_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1854_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("(sub32("));array_copy(list_src,src_off,"(sub32(",0,length("(sub32("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1862_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1862_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1862_1=length(func_tokens);var _macro_tmp_1862_2=(3)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1862_1+_macro_tmp_1862_2);array_copy(func_tokens,func_pos+_macro_tmp_1862_2,func_tokens,func_pos,_macro_tmp_1862_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=5;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{", ",class->CLASS_compat_name,"_SIZE)/",class->CLASS_compat_name,"_SIZE)"},line);type=TYPE_INTEGER;continue;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1872_0=gen->GEN_func_tokens;var _macro_tmp_1872_1=length(_macro_tmp_1872_0);var _macro_tmp_1872_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1872_0,_macro_tmp_1872_1+_macro_tmp_1872_2);array_copy(_macro_tmp_1872_0,_macro_tmp_1872_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1872_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};gen->GEN_last_func_pos=list_off;;;var num_params=1;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length(","));array_copy(list_src,src_off,",",0,length(","));;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;for(;;){num_params++;var _macro_tmp_1885_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1885_0++;continue;case ')','}',']':if(!_macro_tmp_1885_0)break;_macro_tmp_1885_0--;continue;case ',',';':if(!_macro_tmp_1885_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};name={name,"#",num_params};var func,orig_class=class;while(class){func=hash_get(class->CLASS_functions,name,null);if(func){if(!(func->FUNC_flags&FUNC_FLAG_STATIC)&&!(func->FUNC_flags&FUNC_FLAG_OVERRIDE)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){break;}func=null;}class=class->CLASS_parent;}if(!func){return 0,error({script_line(line),": function ",name," not found in ",get_class_name_with_kind(orig_class)});}var real_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length({real_name,"("}));array_copy(list_src,src_off,{real_name,"("},0,length({real_name,"("}));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1894_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1894_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1894_1=length(func_tokens);var _macro_tmp_1894_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1894_1+_macro_tmp_1894_2);array_copy(func_tokens,func_pos+_macro_tmp_1894_2,func_tokens,func_pos,_macro_tmp_1894_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(real_name);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var save_off=length(gen->GEN_func_tokens)-TOK_SIZE;var save_val=gen->GEN_func_tokens[save_off+TOK_off];gen->GEN_func_tokens[save_off+TOK_off]=list_tokens[params_off+TOK_off];list_off=params_off;;for(var i=1;i<num_params;i++){if(i>1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};gen->GEN_func_tokens[save_off+TOK_off]=save_val;type=func->FUNC_return_type;}else{if(class->CLASS_ext_type!=EXT_TYPE_CLASS){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be class type"});}var field,orig_class=class;while(class){field=hash_get(class->CLASS_fields,name,null);if(field){if(!field->FIELD_private||class===hash_get(gen->GEN_classes,class->CLASS_name,null)){break;}field=null;}class=class->CLASS_parent;}if(!field){list_off-=TOK_SIZE;;return 0,error({script_line(line),": can't find field '",name,"' in class ",orig_class->CLASS_name});}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_1912_0=gen->GEN_func_tokens;var _macro_tmp_1912_1=length(_macro_tmp_1912_0);var _macro_tmp_1912_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1912_0,_macro_tmp_1912_1+_macro_tmp_1912_2);array_copy(_macro_tmp_1912_0,_macro_tmp_1912_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1912_2);gen->GEN_last_func_pos=list_off;;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"->",field->FIELD_compat_name}));array_copy(list_src,src_off,{"->",field->FIELD_compat_name},0,length({"->",field->FIELD_compat_name}));;gen->GEN_func_tokens[]='->';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=2;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off+2;gen->GEN_func_tokens[]=length(field->FIELD_compat_name);gen->GEN_func_tokens[]=line;;list_off+=TOK_SIZE;;gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field->FIELD_type;}continue;}case '[':{((list_off+=TOK_SIZE)<length(list_tokens));if((list_tokens[list_off]===(']'))){list_off-=TOK_SIZE;;break;}list_off-=TOK_SIZE;;var base_type=TYPE_DYNAMIC;var index_type=TYPE_INTEGER;var array=get_type_array_or_hash(type);var is_hash=false;var unsupported=false;if(array){if(array[0]==EXT_TYPE_HASH){base_type=array->HASH_base_type;index_type=array->HASH_index_type;is_hash=true;}else{base_type=array->ARRAY_base_type;}}else if(type==TYPE_STRING){base_type=TYPE_INTEGER;}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){base_type=TYPE_DYNAMIC;}else if(type!=TYPE_DYNAMIC){unsupported=true;}var off1=(list_tokens[list_off+TOK_off]);var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var struct_type=-1;if(is_array(gen->GEN_ret_type)&&gen->GEN_ret_type[0]==EXT_TYPE_STRUCT){struct_type=gen->GEN_ret_type;if(type!=TYPE_DYNAMIC){if(is_array(type)&&type[0]==EXT_TYPE_ARRAY){if(type->ARRAY_base_type!=TYPE_DYNAMIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in type ",get_type_name(type)});}}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){if(type->ARRAY_base_type!=TYPE_DYNAMIC&&type->ARRAY_base_type!==struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in an incompatible struct array"});}}else{if(unsupported){var orig_pos=(list_off);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===(']'))){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('.'))){var dot_pos=(list_off);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off])==TOK_IDENT){var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('('))){var line=(list_tokens[list_off+TOK_line]);var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_1951_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_1951_0++;continue;case ')','}',']':if(!_macro_tmp_1951_0)break;_macro_tmp_1951_0--;continue;case ',',';':if(!_macro_tmp_1951_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off=params_off;;var func_name={name,"#",num_params+2};var func=null;var struct=struct_type;for(;;){func=hash_get(struct->CLASS_functions,func_name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||struct===hash_get(gen->GEN_classes,struct->CLASS_name,null))){var(param_name,param_type)=hash_entry(func->FUNC_params,1);if(param_type!==type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," in struct ",get_type_name(struct_type)," has incompatible first parameter"});}break;}struct=struct->CLASS_parent;if(!struct){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," not found in struct ",get_type_name(struct_type)});}}list_off=dot_pos;;list_off+=TOK_SIZE;;var _macro_tmp_1964_0=gen->GEN_func_tokens;var _macro_tmp_1964_1=length(_macro_tmp_1964_0);var _macro_tmp_1964_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1964_0,_macro_tmp_1964_1+_macro_tmp_1964_2);array_copy(_macro_tmp_1964_0,_macro_tmp_1964_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1964_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var func_real_name={struct->CLASS_method_prefix,name};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(",func_real_name}));array_copy(list_src,src_off,{"(",func_real_name},0,length({"(",func_real_name}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_1968_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_1968_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_1968_1=length(func_tokens);var _macro_tmp_1968_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_1968_1+_macro_tmp_1968_2);array_copy(func_tokens,func_pos+_macro_tmp_1968_2,func_tokens,func_pos,_macro_tmp_1968_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=length(func_real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens=gen->GEN_func_tokens;var search_off1=list_tokens[expr_start_pos+TOK_off];var search_off2=list_tokens[dot_pos+TOK_off];var expr_pos1=-1;var expr_pos2=-1;for(var i=length(func_tokens)-TOK_SIZE;i>=0;i-=TOK_SIZE){if(func_tokens[i+TOK_off]==search_off1){expr_pos1=i;break;}if(func_tokens[i+TOK_off]==search_off2){expr_pos2=i;}}var expr_tokens=array_extract(func_tokens,expr_pos1+TOK_SIZE,expr_pos2-expr_pos1-2*TOK_SIZE);array_remove(func_tokens,expr_pos1,expr_pos2-expr_pos1);tokens_parse(expr_tokens,list_src,",",line);array_insert_array(func_tokens,func_pos,expr_tokens);var dot_off=length(func_tokens)-TOK_SIZE;if(num_params>0){var src_off2=length(list_src);array_set_length(list_src,src_off2+length(","));array_copy(list_src,src_off2,",",0,length(","));;func_tokens[dot_off++]=',';func_tokens[dot_off++]=src_off2;func_tokens[dot_off++]=1;func_tokens[dot_off++]=line;;}else{array_set_length(func_tokens,length(func_tokens)-TOK_SIZE);}list_off=params_off;;gen->GEN_last_func_pos=list_off;;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+2);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_1987_0=gen->GEN_func_tokens;var _macro_tmp_1987_1=length(_macro_tmp_1987_0);var _macro_tmp_1987_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_1987_0,_macro_tmp_1987_1+_macro_tmp_1987_2);array_copy(_macro_tmp_1987_0,_macro_tmp_1987_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_1987_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;array_remove(func_tokens,dot_off,TOK_SIZE);type=func->FUNC_return_type;continue;}}}}list_off=orig_pos;;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in type ",get_type_name(type)});}}}else{if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct array directly"});}append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,index_type,gen->GEN_ret_type);}if(unsupported){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be array or hash table"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};if(struct_type!=-1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('='))){var explicit_struct_name=false;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off])==TOK_IDENT){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('{'))){explicit_struct_name=true;list_off-=TOK_SIZE;;var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var explicit_struct_type=find_class(gen,name);if(!explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't find struct ",name});}if(explicit_struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be struct"});}if(struct_type!=TYPE_DYNAMIC&&struct_type!==explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": explicit ",get_class_name_with_kind(explicit_struct_type)," is different from ",get_class_name_with_kind(struct_type)});}struct_type=explicit_struct_type;}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}if(struct_type==TYPE_DYNAMIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": struct type must be specified"});}var array_var={"__classes_tmp_",tmp_cnt++};var index_var={"__classes_tmp_",tmp_cnt++};var line=(list_tokens[list_off+TOK_line]);if(explicit_struct_name)list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_2018_0=gen->GEN_func_tokens;var _macro_tmp_2018_1=length(_macro_tmp_2018_0);var _macro_tmp_2018_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2018_0,_macro_tmp_2018_1+_macro_tmp_2018_2);array_copy(_macro_tmp_2018_0,_macro_tmp_2018_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2018_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;if(explicit_struct_name)list_off+=TOK_SIZE;;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2022_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2022_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2022_1=length(func_tokens);var _macro_tmp_2022_2=(4)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2022_1+_macro_tmp_2022_2);array_copy(func_tokens,func_pos+_macro_tmp_2022_2,func_tokens,func_pos,_macro_tmp_2022_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"{var",array_var,"="}));array_copy(list_src,src_off,{"{var",array_var,"="},0,length({"{var",array_var,"="}));;func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=KW_VAR;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=3;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+4;func_tokens[func_pos++]=length(array_var);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='=';func_tokens[func_pos++]=src_off+4+length(array_var);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2029_0=expr_start_pos>=0?list_tokens[expr_start_pos+TOK_off]:func_tokens2[-expr_start_pos+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2029_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_2029_1=length(func_tokens2);var _macro_tmp_2029_2=(5)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2029_1+_macro_tmp_2029_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2029_2,func_tokens2,func_pos2,_macro_tmp_2029_1-func_pos2);;;func_pos2-=TOK_SIZE;array_remove(func_tokens2,func_pos2,TOK_SIZE);var src_off2=length(list_src);array_set_length(list_src,src_off2+length({",",index_var,"=sub32("}));array_copy(list_src,src_off2,{",",index_var,"=sub32("},0,length({",",index_var,"=sub32("}));;func_tokens2[func_pos2++]=',';func_tokens2[func_pos2++]=src_off2+0;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off2+1;func_tokens2[func_pos2++]=length(index_var);func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='=';func_tokens2[func_pos2++]=src_off2+1+length(index_var);func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off2+1+length(index_var)+1;func_tokens2[func_pos2++]=5;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='(';func_tokens2[func_pos2++]=src_off2+1+length(index_var)+6;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;tokens_parse(gen->GEN_func_tokens,list_src,{",",struct_type->CLASS_compat_name,"_SIZE);"},(list_tokens[list_off+TOK_line]));var fields={};var value_pos=length(gen->GEN_func_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('.'))){list_off-=TOK_SIZE;;for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(hash_contains(fields,name)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate field"});}var(field_type,offset)=get_struct_field(gen,struct_type,name);if(!is_int(offset)){return 0,offset;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};gen->GEN_last_func_pos=list_off;;;var field_value_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,field_value_pos,field_type,gen->GEN_ret_type);line=(list_tokens[list_off+TOK_line]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var _macro_tmp_2066_0=gen->GEN_func_tokens;var _macro_tmp_2066_1=length(_macro_tmp_2066_0);var _macro_tmp_2066_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2066_0,_macro_tmp_2066_1+_macro_tmp_2066_2);array_copy(_macro_tmp_2066_0,_macro_tmp_2066_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2066_2);gen->GEN_last_func_pos=list_off;;;fields{name}=array_extract(gen->GEN_func_tokens,value_pos+TOK_SIZE,length(gen->GEN_func_tokens)-value_pos-TOK_SIZE);array_set_length(gen->GEN_func_tokens,value_pos);if((list_tokens[list_off])==',')continue;list_off-=TOK_SIZE;;break;}}else{list_off-=TOK_SIZE;;}var cls=struct_type;var new_tokens=[],all_tokens=[];while(cls){var cls_fields=cls->CLASS_fields;for(var i=0;i<length(cls_fields);i++){var(k,v)=hash_entry(cls_fields,i);tokens_parse(new_tokens,list_src,{array_var,"[",index_var,"++]="},(list_tokens[list_off+TOK_line]));var tokens=hash_get(fields,k,null);if(tokens){hash_remove(fields,k);array_append(new_tokens,tokens);}else{tokens_parse(new_tokens,list_src,"0",line);}tokens_parse(new_tokens,list_src,";",line);}array_insert_array(all_tokens,0,new_tokens);array_clear(new_tokens);cls=cls->CLASS_parent;}if(length(fields)!=0){var(k,v)=hash_entry(fields,0);return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown field ",k," in ",get_class_name_with_kind(struct_type)});}array_append(gen->GEN_func_tokens,all_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};continue;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};var dot_pos=(list_off);list_off-=TOK_SIZE;;var _macro_tmp_2080_0=gen->GEN_func_tokens;var _macro_tmp_2080_1=length(_macro_tmp_2080_0);var _macro_tmp_2080_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2080_0,_macro_tmp_2080_1+_macro_tmp_2080_2);array_copy(_macro_tmp_2080_0,_macro_tmp_2080_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2080_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){var line=(list_tokens[list_off+TOK_line]);var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_2095_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_2095_0++;continue;case ')','}',']':if(!_macro_tmp_2095_0)break;_macro_tmp_2095_0--;continue;case ',',';':if(!_macro_tmp_2095_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off=params_off;;var func_name={name,"#",num_params+2};var func=null;var struct=struct_type;for(;;){func=hash_get(struct->CLASS_functions,func_name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||struct===hash_get(gen->GEN_classes,struct->CLASS_name,null))){var(param_name,param_type)=hash_entry(func->FUNC_params,1);if(!is_array(param_type)||param_type[0]!=EXT_TYPE_STRUCT_ARRAY||(param_type->ARRAY_base_type!=TYPE_DYNAMIC&&param_type->ARRAY_base_type!==struct_type)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," in struct ",get_type_name(struct_type)," has incompatible first parameter"});}break;}struct=struct->CLASS_parent;if(!struct){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," not found in struct ",get_type_name(struct_type)});}}list_off=dot_pos;;list_off+=TOK_SIZE;;var _macro_tmp_2108_0=gen->GEN_func_tokens;var _macro_tmp_2108_1=length(_macro_tmp_2108_0);var _macro_tmp_2108_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2108_0,_macro_tmp_2108_1+_macro_tmp_2108_2);array_copy(_macro_tmp_2108_0,_macro_tmp_2108_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2108_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var func_real_name={struct->CLASS_method_prefix,name};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(",func_real_name}));array_copy(list_src,src_off,{"(",func_real_name},0,length({"(",func_real_name}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2112_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2112_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2112_1=length(func_tokens);var _macro_tmp_2112_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2112_1+_macro_tmp_2112_2);array_copy(func_tokens,func_pos+_macro_tmp_2112_2,func_tokens,func_pos,_macro_tmp_2112_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=length(func_real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens=gen->GEN_func_tokens;var search_off1=list_tokens[expr_start_pos+TOK_off];var search_off2=list_tokens[dot_pos+TOK_off];var expr_pos1=-1;var expr_pos2=-1;for(var i=length(func_tokens)-TOK_SIZE;i>=0;i-=TOK_SIZE){if(func_tokens[i+TOK_off]==search_off1){expr_pos1=i;break;}if(func_tokens[i+TOK_off]==search_off2){expr_pos2=i;}}var expr_tokens=array_extract(func_tokens,expr_pos1+TOK_SIZE,expr_pos2-expr_pos1-2*TOK_SIZE);array_remove(func_tokens,expr_pos1,expr_pos2-expr_pos1);tokens_parse(expr_tokens,list_src,",",line);array_insert_array(func_tokens,func_pos,expr_tokens);var dot_off=length(func_tokens)-TOK_SIZE;if(num_params>0){var src_off2=length(list_src);array_set_length(list_src,src_off2+length(","));array_copy(list_src,src_off2,",",0,length(","));;func_tokens[dot_off++]=',';func_tokens[dot_off++]=src_off2;func_tokens[dot_off++]=1;func_tokens[dot_off++]=line;;}else{array_set_length(func_tokens,length(func_tokens)-TOK_SIZE);}list_off=params_off;;gen->GEN_last_func_pos=list_off;;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+2);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_2131_0=gen->GEN_func_tokens;var _macro_tmp_2131_1=length(_macro_tmp_2131_0);var _macro_tmp_2131_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2131_0,_macro_tmp_2131_1+_macro_tmp_2131_2);array_copy(_macro_tmp_2131_0,_macro_tmp_2131_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2131_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;array_remove(func_tokens,dot_off,TOK_SIZE);type=func->FUNC_return_type;}else{list_off-=TOK_SIZE;;var(field_type,offset)=get_struct_field(gen,struct_type,name);if(!is_int(offset)){return 0,offset;}if(offset<0){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't find field ",name," in struct ",struct_type->CLASS_name});}var line=(list_tokens[list_off+TOK_line]);var prepend=tokens_parse([],list_src,"sub32(",line);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2137_0=expr_start_pos>=0?list_tokens[expr_start_pos+TOK_off]:func_tokens[-expr_start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2137_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2137_1=length(func_tokens);var _macro_tmp_2137_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2137_1+_macro_tmp_2137_2);array_copy(func_tokens,func_pos+_macro_tmp_2137_2,func_tokens,func_pos,_macro_tmp_2137_1-func_pos);;;array_copy(func_tokens,func_pos,prepend,0,length(prepend));tokens_parse(gen->GEN_func_tokens,list_src,{", ",offset,")"},line);list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;var _macro_tmp_2144_0=gen->GEN_func_tokens;var _macro_tmp_2144_1=length(_macro_tmp_2144_0);var _macro_tmp_2144_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2144_0,_macro_tmp_2144_1+_macro_tmp_2144_2);array_copy(_macro_tmp_2144_0,_macro_tmp_2144_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2144_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field_type;if(type==TYPE_FLOAT){var is_assign=false;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};switch((list_tokens[list_off])){case '=','+=','-=','*=','/=':is_assign=true;break;}list_off-=TOK_SIZE;;if(!is_assign){var src_off=length(list_src);array_set_length(list_src,src_off+length("{("));array_copy(list_src,src_off,"{(",0,length("{("));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2156_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens2[-adj_off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2156_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_2156_1=length(func_tokens2);var _macro_tmp_2156_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2156_1+_macro_tmp_2156_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2156_2,func_tokens2,func_pos2,_macro_tmp_2156_1-func_pos2);;;func_tokens2[func_pos2++]='{';func_tokens2[func_pos2++]=src_off;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='(';func_tokens2[func_pos2++]=src_off+1;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")*1.0}",line);}}}continue;}var off2=(list_tokens[list_off+TOK_off]);if(is_hash){list_off+=TOK_SIZE;;var _macro_tmp_2162_0=gen->GEN_func_tokens;var _macro_tmp_2162_1=length(_macro_tmp_2162_0);var _macro_tmp_2162_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2162_0,_macro_tmp_2162_1+_macro_tmp_2162_2);array_copy(_macro_tmp_2162_0,_macro_tmp_2162_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2162_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length("{}"));array_copy(list_src,src_off,"{}",0,length("{}"));;var func_tokens=gen->GEN_func_tokens;for(var i=length(func_tokens)-TOK_SIZE;;i-=TOK_SIZE){var foff=func_tokens[i+TOK_off];if(foff==off2){func_tokens[i+TOK_type]='}';func_tokens[i+TOK_off]=src_off+1;continue;}if(foff==off1){func_tokens[i+TOK_type]='{';func_tokens[i+TOK_off]=src_off;break;}}}type=base_type;continue;}case '{':{var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};type=TYPE_DYNAMIC;continue;}case '(':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}type=TYPE_DYNAMIC;continue;case '->':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};type=TYPE_DYNAMIC;continue;};
list_off-=TOK_SIZE;;
break;
}

while(unary_off>off){
switch(list_tokens[unary_off+TOK_type]){case '!':if(type==TYPE_INTEGER||type==TYPE_FLOAT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in logical negation"});}type=TYPE_BOOLEAN;break;case '~':if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": bitwise negation is supported only for integers"});}type=TYPE_INTEGER;break;case '+':if(type==TYPE_FLOAT){list_off-=TOK_SIZE;;var _macro_tmp_2193_0=gen->GEN_func_tokens;var _macro_tmp_2193_1=length(_macro_tmp_2193_0);var _macro_tmp_2193_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2193_0,_macro_tmp_2193_1+_macro_tmp_2193_2);array_copy(_macro_tmp_2193_0,_macro_tmp_2193_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2193_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;break;}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unary plus is supported only for integers and floats"});}type=TYPE_INTEGER;break;case '-':if(type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2200_0=gen->GEN_func_tokens;var _macro_tmp_2200_1=length(_macro_tmp_2200_0);var _macro_tmp_2200_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2200_0,_macro_tmp_2200_1+_macro_tmp_2200_2);array_copy(_macro_tmp_2200_0,_macro_tmp_2200_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2200_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_unary_op(gen,list_tokens,list_src,list_off,unary_off-TOK_SIZE);break;}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unary minus is supported only for integers and floats"});}type=TYPE_INTEGER;break;case '++','--':if(is_array(type)&&type[0]==EXT_TYPE_STRUCT){list_off+=TOK_SIZE;;var _macro_tmp_2206_0=gen->GEN_func_tokens;var _macro_tmp_2206_1=length(_macro_tmp_2206_0);var _macro_tmp_2206_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2206_0,_macro_tmp_2206_1+_macro_tmp_2206_2);array_copy(_macro_tmp_2206_0,_macro_tmp_2206_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2206_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2210_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2210_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2210_1=length(func_tokens);var _macro_tmp_2210_2=(0)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2210_1+_macro_tmp_2210_2);array_copy(func_tokens,func_pos+_macro_tmp_2210_2,func_tokens,func_pos,_macro_tmp_2210_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length("("));array_copy(list_src,src_off,"(",0,length("("));;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{list_tokens[unary_off+TOK_type]=='++'?"+=":"-=",type->CLASS_compat_name,"_SIZE)"},line);break;}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": pre increment/decrement is supported only for integers"});}type=TYPE_INTEGER;break;};
unary_off-=TOK_SIZE;
}

if(((list_off+=TOK_SIZE)<length(list_tokens))){
var has_postincdec=false;
switch((list_tokens[list_off])){
case '++','--':
has_postincdec=true;
break;
}
if(has_postincdec){
if(is_array(type)&&type[0]==EXT_TYPE_STRUCT){
var postincdec_type=(list_tokens[list_off]);
var _macro_tmp_2218_0=gen->GEN_func_tokens;var _macro_tmp_2218_1=length(_macro_tmp_2218_0);var _macro_tmp_2218_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2218_0,_macro_tmp_2218_1+_macro_tmp_2218_2);array_copy(_macro_tmp_2218_0,_macro_tmp_2218_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2218_2);gen->GEN_last_func_pos=list_off;;;
list_off+=TOK_SIZE;;
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;
var line=(list_tokens[list_off+TOK_line]);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2225_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2225_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2225_1=length(func_tokens);var _macro_tmp_2225_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2225_1+_macro_tmp_2225_2);array_copy(func_tokens,func_pos+_macro_tmp_2225_2,func_tokens,func_pos,_macro_tmp_2225_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("(("));array_copy(list_src,src_off,"((",0,length("(("));;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
var after=")";
if(!is_statement){
after={postincdec_type=='++'?"-":"+",type->CLASS_compat_name,"_SIZE)"};
}
tokens_parse(gen->GEN_func_tokens,list_src,{postincdec_type=='++'?"+=":"-=",type->CLASS_compat_name,"_SIZE)",after},line);
}
else if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": post increment/decrement is supported only for integers"});
}
}
else if((list_tokens[list_off]===TOK_IDENT&&(list_tokens[list_off+TOK_len]===length("as")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("as")))){
var _macro_tmp_2234_0=gen->GEN_func_tokens;var _macro_tmp_2234_1=length(_macro_tmp_2234_0);var _macro_tmp_2234_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2234_0,_macro_tmp_2234_1+_macro_tmp_2234_2);array_copy(_macro_tmp_2234_0,_macro_tmp_2234_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2234_2);gen->GEN_last_func_pos=list_off;;;
var new_type;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_2236_0,_macro_tmp_2236_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_2236_1))return 0,_macro_tmp_2236_1;list_off=_macro_tmp_2236_1;;new_type=_macro_tmp_2236_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;
var is_struct1=is_array(type)&&type[0]==EXT_TYPE_STRUCT;
var is_struct2=is_array(new_type)&&new_type[0]==EXT_TYPE_STRUCT;
if(is_struct1&&is_struct2){
var change=get_struct_size(new_type)-get_struct_size(type);
if(change!=0){
var line=(list_tokens[list_off+TOK_line]);
var prepend=tokens_parse([],list_src,change>=0?"add32(":"sub32(",line);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2248_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2248_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2248_1=length(func_tokens);var _macro_tmp_2248_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2248_1+_macro_tmp_2248_2);array_copy(func_tokens,func_pos+_macro_tmp_2248_2,func_tokens,func_pos,_macro_tmp_2248_1-func_pos);;;
array_copy(func_tokens,func_pos,prepend,0,length(prepend));
tokens_parse(gen->GEN_func_tokens,list_src,{", ",abs(change),")"},line);
}
}
else if(is_struct1&&new_type!=TYPE_DYNAMIC){
if(new_type!=TYPE_INTEGER){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't convert struct reference to non-integer"});
}
var line=(list_tokens[list_off+TOK_line]);
var prepend=tokens_parse([],list_src,"sub32(",line);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2252_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2252_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2252_1=length(func_tokens);var _macro_tmp_2252_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2252_1+_macro_tmp_2252_2);array_copy(func_tokens,func_pos+_macro_tmp_2252_2,func_tokens,func_pos,_macro_tmp_2252_1-func_pos);;;
array_copy(func_tokens,func_pos,prepend,0,length(prepend));
tokens_parse(gen->GEN_func_tokens,list_src,{", ",type->CLASS_compat_name,"_SIZE)"},line);
}
else if(type!=TYPE_DYNAMIC&&is_struct2){
if(type!=TYPE_INTEGER){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't convert struct reference from non-integer"});
}
var line=(list_tokens[list_off+TOK_line]);
var prepend=tokens_parse([],list_src,"add32(",line);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2256_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2256_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2256_1=length(func_tokens);var _macro_tmp_2256_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2256_1+_macro_tmp_2256_2);array_copy(func_tokens,func_pos+_macro_tmp_2256_2,func_tokens,func_pos,_macro_tmp_2256_1-func_pos);;;
array_copy(func_tokens,func_pos,prepend,0,length(prepend));
tokens_parse(gen->GEN_func_tokens,list_src,{", ",new_type->CLASS_compat_name,"_SIZE)"},line);
}
type=new_type;
}
else{
list_off-=TOK_SIZE;;
}
}

if(((list_off+=TOK_SIZE)<length(list_tokens))){
var assignment=0;var op_prio=-1;switch((list_tokens[list_off])){case '=':assignment=2;break;case '[':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(']'))){assignment=1;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='='){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('='),"'"});};var struct_type=-1;var explicit_struct_name=false;if(type==TYPE_DYNAMIC){struct_type=TYPE_DYNAMIC;}else if(is_array(type)){var ext_type=type[0];if(ext_type==EXT_TYPE_ARRAY&&type->ARRAY_base_type==TYPE_DYNAMIC){struct_type=TYPE_DYNAMIC;}else if(ext_type==EXT_TYPE_STRUCT_ARRAY){struct_type=type->ARRAY_base_type;}}if(struct_type!=-1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off])==TOK_IDENT){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('{'))){explicit_struct_name=true;list_off-=TOK_SIZE;;var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var explicit_struct_type=find_class(gen,name);if(!explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't find struct ",name});}if(explicit_struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be struct"});}if(struct_type!=TYPE_DYNAMIC&&struct_type!==explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": explicit ",get_class_name_with_kind(explicit_struct_type)," is different from ",get_class_name_with_kind(struct_type)});}struct_type=explicit_struct_type;}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}if(struct_type==TYPE_DYNAMIC){break;}var array_var={"__classes_tmp_",tmp_cnt++};var line=(list_tokens[list_off+TOK_line]);if(explicit_struct_name)list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_2285_0=gen->GEN_func_tokens;var _macro_tmp_2285_1=length(_macro_tmp_2285_0);var _macro_tmp_2285_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2285_0,_macro_tmp_2285_1+_macro_tmp_2285_2);array_copy(_macro_tmp_2285_0,_macro_tmp_2285_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2285_2);gen->GEN_last_func_pos=list_off;;;var adj_off=hash_get(gen->GEN_func_offsets_replacements,off,off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2287_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2287_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2287_1=length(func_tokens);var _macro_tmp_2287_2=(4)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2287_1+_macro_tmp_2287_2);array_copy(func_tokens,func_pos+_macro_tmp_2287_2,func_tokens,func_pos,_macro_tmp_2287_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"{var",array_var,"="}));array_copy(list_src,src_off,{"{var",array_var,"="},0,length({"{var",array_var,"="}));;func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=KW_VAR;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=3;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+4;func_tokens[func_pos++]=length(array_var);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='=';func_tokens[func_pos++]=src_off+4+length(array_var);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(explicit_struct_name)list_off+=TOK_SIZE;;tokens_parse(gen->GEN_func_tokens,list_src,";",line);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var fields={};var value_pos=length(gen->GEN_func_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('.'))){list_off-=TOK_SIZE;;for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(hash_contains(fields,name)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate field"});}var(field_type,offset)=get_struct_field(gen,struct_type,name);if(!is_int(offset)){return 0,offset;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};gen->GEN_last_func_pos=list_off;;;var field_value_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,field_value_pos,field_type,gen->GEN_ret_type);line=(list_tokens[list_off+TOK_line]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var _macro_tmp_2325_0=gen->GEN_func_tokens;var _macro_tmp_2325_1=length(_macro_tmp_2325_0);var _macro_tmp_2325_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2325_0,_macro_tmp_2325_1+_macro_tmp_2325_2);array_copy(_macro_tmp_2325_0,_macro_tmp_2325_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2325_2);gen->GEN_last_func_pos=list_off;;;fields{name}=array_extract(gen->GEN_func_tokens,value_pos+TOK_SIZE,length(gen->GEN_func_tokens)-value_pos-TOK_SIZE);array_set_length(gen->GEN_func_tokens,value_pos);if((list_tokens[list_off])==',')continue;list_off-=TOK_SIZE;;break;}}else{list_off-=TOK_SIZE;;}var cls=struct_type;var new_tokens=[],all_tokens=[];while(cls){var cls_fields=cls->CLASS_fields;for(var i=0;i<length(cls_fields);i++){var(k,v)=hash_entry(cls_fields,i);tokens_parse(new_tokens,list_src,{array_var,"[]="},(list_tokens[list_off+TOK_line]));var tokens=hash_get(fields,k,null);if(tokens){hash_remove(fields,k);array_append(new_tokens,tokens);}else{tokens_parse(new_tokens,list_src,"0",line);}tokens_parse(new_tokens,list_src,";",line);}array_insert_array(all_tokens,0,new_tokens);array_clear(new_tokens);cls=cls->CLASS_parent;}if(length(fields)!=0){var(k,v)=hash_entry(fields,0);return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown field ",k," in ",get_class_name_with_kind(struct_type)});}array_append(gen->GEN_func_tokens,all_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};assignment=-1;}break;}else{list_off-=TOK_SIZE;;}break;case '+=':{assignment=3;op_prio=PRIO_SPECIAL_ADD_INPLACE;break;}case '-=':{assignment=3;op_prio=PRIO_SPECIAL_SUB_INPLACE;break;}case '*=':{assignment=3;op_prio=PRIO_SPECIAL_MUL_INPLACE;break;}case '/=':{assignment=3;op_prio=PRIO_SPECIAL_DIV_INPLACE;break;}case '%=':{assignment=3;op_prio=PRIO_SPECIAL_REM_INPLACE;break;}case '&=':{assignment=3;op_prio=PRIO_SPECIAL_AND_INPLACE;break;}case '|=':{assignment=3;op_prio=PRIO_SPECIAL_OR_INPLACE;break;}case '^=':{assignment=3;op_prio=PRIO_SPECIAL_XOR_INPLACE;break;}case '<<=':{assignment=3;op_prio=PRIO_SPECIAL_SHL_INPLACE;break;}case '>>=':{assignment=3;op_prio=PRIO_SPECIAL_SHR_INPLACE;break;}case '>>>=':{assignment=3;op_prio=PRIO_SPECIAL_USHR_INPLACE;break;}}if(assignment){if(assignment==-1){break;}if(prev_type!=-1){return 0,error({script_line((list_tokens[list_off+TOK_line])),": invalid assignment"});}var value_pos=(list_off);prev_type=type;if(assignment==3&&prev_type==TYPE_FLOAT){var op_type=(list_tokens[list_off]);if(op_type!='+='&&op_type!='-='&&op_type!='*='&&op_type!='/='){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unsupported arithmetic operation for floats"});}var _macro_tmp_2339_0=gen->GEN_func_tokens;var _macro_tmp_2339_1=length(_macro_tmp_2339_0);var _macro_tmp_2339_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2339_0,_macro_tmp_2339_1+_macro_tmp_2339_2);array_copy(_macro_tmp_2339_0,_macro_tmp_2339_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2339_2);gen->GEN_last_func_pos=list_off;;;var op_pos=length(gen->GEN_func_tokens);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;if(type==TYPE_INTEGER){append_type_conv(gen,list_tokens,list_src,list_off,value_pos,TYPE_FLOAT,type);type=TYPE_FLOAT;}else if(type!=TYPE_FLOAT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;var _macro_tmp_2347_0=gen->GEN_func_tokens;var _macro_tmp_2347_1=length(_macro_tmp_2347_0);var _macro_tmp_2347_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2347_0,_macro_tmp_2347_1+_macro_tmp_2347_2);array_copy(_macro_tmp_2347_0,_macro_tmp_2347_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2347_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;gen->GEN_func_tokens[op_pos]|='f'<<16;gen->GEN_uses_float_shorthands=true;}else if(assignment==3&&prev_type==TYPE_STRING&&(list_tokens[list_off])=='+='){var _macro_tmp_2351_0=gen->GEN_func_tokens;var _macro_tmp_2351_1=length(_macro_tmp_2351_0);var _macro_tmp_2351_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2351_0,_macro_tmp_2351_1+_macro_tmp_2351_2);array_copy(_macro_tmp_2351_0,_macro_tmp_2351_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2351_2);gen->GEN_last_func_pos=list_off;;;var line=(list_tokens[list_off+TOK_line]);var adj_off=hash_get(gen->GEN_func_offsets_replacements,off,off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2354_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2354_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2354_1=length(func_tokens);var _macro_tmp_2354_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2354_1+_macro_tmp_2354_2);array_copy(func_tokens,func_pos+_macro_tmp_2354_2,func_tokens,func_pos,_macro_tmp_2354_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length("array_append(,"));array_copy(list_src,src_off,"array_append(,",0,length("array_append(,"));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=12;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+12;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var comma_pos=list_off;list_tokens[comma_pos++]=',';list_tokens[comma_pos++]=src_off+13;list_tokens[comma_pos++]=1;list_tokens[comma_pos++]=line;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;list_off+=TOK_SIZE;;var _macro_tmp_2364_0=gen->GEN_func_tokens;var _macro_tmp_2364_1=length(_macro_tmp_2364_0);var _macro_tmp_2364_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2364_0,_macro_tmp_2364_1+_macro_tmp_2364_2);array_copy(_macro_tmp_2364_0,_macro_tmp_2364_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2364_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var ret_type=gen->GEN_ret_type;if(ret_type!=TYPE_STRING){if(is_array(ret_type)&&ret_type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(ret_type);if(to_string_cls){var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2367_0=value_pos>=0?list_tokens[value_pos+TOK_off]:func_tokens2[-value_pos+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2367_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_2367_1=length(func_tokens2);var _macro_tmp_2367_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2367_1+_macro_tmp_2367_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2367_2,func_tokens2,func_pos2,_macro_tmp_2367_1-func_pos2);;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length(prepend));array_copy(list_src,src_off2,prepend,0,length(prepend));;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off2;func_tokens2[func_pos2++]=length(prepend)-1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='(';func_tokens2[func_pos2++]=src_off2+length(prepend)-1;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);}}wrap_string_conv(gen,list_tokens,list_src,list_off,value_pos);}tokens_parse(gen->GEN_func_tokens,list_src,")",(list_tokens[list_off+TOK_line]));}else if(assignment==3&&is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT&&((list_tokens[list_off])=='+='||(list_tokens[list_off])=='-=')){list_off+=TOK_SIZE;;var _macro_tmp_2377_0=gen->GEN_func_tokens;var _macro_tmp_2377_1=length(_macro_tmp_2377_0);var _macro_tmp_2377_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2377_0,_macro_tmp_2377_1+_macro_tmp_2377_2);array_copy(_macro_tmp_2377_0,_macro_tmp_2377_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2377_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;tokens_parse(gen->GEN_func_tokens,list_src,"((",(list_tokens[list_off+TOK_line]));list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(gen->GEN_ret_type!=TYPE_DYNAMIC&&gen->GEN_ret_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": struct pointer offset must be Integer"});}list_off+=TOK_SIZE;;var _macro_tmp_2386_0=gen->GEN_func_tokens;var _macro_tmp_2386_1=length(_macro_tmp_2386_0);var _macro_tmp_2386_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2386_0,_macro_tmp_2386_1+_macro_tmp_2386_2);array_copy(_macro_tmp_2386_0,_macro_tmp_2386_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2386_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;tokens_parse(gen->GEN_func_tokens,list_src,{")*",type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));}else if(assignment==3&&is_array(prev_type)&&prev_type[0]==EXT_TYPE_CLASS){var _macro_tmp_2390_0=gen->GEN_func_tokens;var _macro_tmp_2390_1=length(_macro_tmp_2390_0);var _macro_tmp_2390_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2390_0,_macro_tmp_2390_1+_macro_tmp_2390_2);array_copy(_macro_tmp_2390_0,_macro_tmp_2390_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2390_2);gen->GEN_last_func_pos=list_off;;;var line=(list_tokens[list_off+TOK_line]);var comma_off=(list_tokens[list_off+TOK_off]);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var ret_type=gen->GEN_ret_type;list_off+=TOK_SIZE;;var _macro_tmp_2398_0=gen->GEN_func_tokens;var _macro_tmp_2398_1=length(_macro_tmp_2398_0);var _macro_tmp_2398_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2398_0,_macro_tmp_2398_1+_macro_tmp_2398_2);array_copy(_macro_tmp_2398_0,_macro_tmp_2398_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2398_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var operator_list,operator_off;var _macro_tmp_2400_0=add32(mul32(add32(mul32(prev_type,31),ret_type),31),op_prio);var _macro_tmp_2400_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2400_0,null);if(_macro_tmp_2400_1){var found=false;for(var _macro_tmp_2400_2=0;_macro_tmp_2400_2<length(_macro_tmp_2400_1);_macro_tmp_2400_2+=OPERATOR_SIZE){if(_macro_tmp_2400_1[_macro_tmp_2400_2+OPERATOR_prio]!==op_prio)continue;if(_macro_tmp_2400_1[_macro_tmp_2400_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2400_1[_macro_tmp_2400_2+OPERATOR_type2]!==ret_type)continue;operator_list=_macro_tmp_2400_1;operator_off=_macro_tmp_2400_2;break;}};if(!operator_list){var _macro_tmp_2402_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),op_prio);var _macro_tmp_2402_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2402_0,null);if(_macro_tmp_2402_1){var found=false;for(var _macro_tmp_2402_2=0;_macro_tmp_2402_2<length(_macro_tmp_2402_1);_macro_tmp_2402_2+=OPERATOR_SIZE){if(_macro_tmp_2402_1[_macro_tmp_2402_2+OPERATOR_prio]!==op_prio)continue;if(_macro_tmp_2402_1[_macro_tmp_2402_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2402_1[_macro_tmp_2402_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2402_1;operator_off=_macro_tmp_2402_2;break;}};}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2406_0=gen->GEN_func_tokens;var _macro_tmp_2406_1=length(_macro_tmp_2406_0);var _macro_tmp_2406_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2406_0,_macro_tmp_2406_1+_macro_tmp_2406_2);array_copy(_macro_tmp_2406_0,_macro_tmp_2406_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2406_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var func_name=operator_list[operator_off+OPERATOR_func_name];var adj_off=hash_get(gen->GEN_func_offsets_replacements,off,off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2409_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2409_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2409_1=length(func_tokens);var _macro_tmp_2409_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2409_1+_macro_tmp_2409_2);array_copy(func_tokens,func_pos+_macro_tmp_2409_2,func_tokens,func_pos,_macro_tmp_2409_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"(,",func_name}));array_copy(list_src,src_off,{"(,",func_name},0,length({"(,",func_name}));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+2;func_tokens[func_pos++]=length(func_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;for(var j=length(func_tokens)-TOK_SIZE;j>=0;j-=TOK_SIZE){if(func_tokens[j+TOK_off]==comma_off){func_tokens[j++]=',';func_tokens[j++]=src_off+1;func_tokens[j++]=1;func_tokens[j++]=line;;break;}}tokens_parse(gen->GEN_func_tokens,list_src,")",(list_tokens[list_off+TOK_line]));}else{return 0,error({script_line((list_tokens[list_off+TOK_line])),": invalid assignment"});}}else{list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;}if(assignment>=2){list_off+=TOK_SIZE;;var _macro_tmp_2421_0=gen->GEN_func_tokens;var _macro_tmp_2421_1=length(_macro_tmp_2421_0);var _macro_tmp_2421_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2421_0,_macro_tmp_2421_1+_macro_tmp_2421_2);array_copy(_macro_tmp_2421_0,_macro_tmp_2421_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2421_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;append_type_conv(gen,list_tokens,list_src,list_off,value_pos,prev_type,type);}break;}else{list_off-=TOK_SIZE;;};
}

var prev_last_pos=last_pos;
last_pos=(list_off);
if(!((list_off+=TOK_SIZE)<length(list_tokens))){
prev_type=type;
break;
}

var next_prio=-1;
switch((list_tokens[list_off])){case '*':next_prio=PRIO_MULTIPLICATIVE_MUL;break;case '/':next_prio=PRIO_MULTIPLICATIVE_DIV;break;case '%':next_prio=PRIO_MULTIPLICATIVE_REM;break;case '+':next_prio=PRIO_ADDITIVE_ADD;break;case '-':next_prio=PRIO_ADDITIVE_SUB;break;case '&':next_prio=PRIO_BITWISE_AND;break;case '|':next_prio=PRIO_BITWISE_OR;break;case '^':next_prio=PRIO_BITWISE_XOR;break;case '<':next_prio=PRIO_COMPARISON_LT;break;case '>':next_prio=PRIO_COMPARISON_GT;break;case '<<':next_prio=PRIO_BITWISE_SHL;break;case '>>':next_prio=PRIO_BITWISE_SHR;break;case '&&':next_prio=PRIO_LOGICAL_AND;break;case '||':next_prio=PRIO_LOGICAL_OR;break;case '<=':next_prio=PRIO_COMPARISON_LE;break;case '>=':next_prio=PRIO_COMPARISON_GE;break;case '==':next_prio=PRIO_EQUALITY_EQ_VALUE;break;case '!=':next_prio=PRIO_EQUALITY_NE_VALUE;break;case '===':next_prio=PRIO_EQUALITY_EQ_REF;break;case '!==':next_prio=PRIO_EQUALITY_NE_REF;break;case '>>>':next_prio=PRIO_BITWISE_USHR;break;};
if(next_prio==-1){
list_off-=TOK_SIZE;;
switch(prio){case PRIO_ADDITIVE_ADD..PRIO_ADDITIVE_SUB,PRIO_MULTIPLICATIVE_MUL..PRIO_MULTIPLICATIVE_REM:{if(prio==PRIO_ADDITIVE_ADD&&(prev_type==TYPE_STRING||type==TYPE_STRING)){list_off+=TOK_SIZE;;var _macro_tmp_2433_0=gen->GEN_func_tokens;var _macro_tmp_2433_1=length(_macro_tmp_2433_0);var _macro_tmp_2433_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2433_0,_macro_tmp_2433_1+_macro_tmp_2433_2);array_copy(_macro_tmp_2433_0,_macro_tmp_2433_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2433_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(prev_type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2437_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2437_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2437_1=length(func_tokens);var _macro_tmp_2437_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2437_1+_macro_tmp_2437_2);array_copy(func_tokens,func_pos+_macro_tmp_2437_2,func_tokens,func_pos,_macro_tmp_2437_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2442_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2442_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2442_1=length(func_tokens2);var _macro_tmp_2442_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2442_1+_macro_tmp_2442_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2442_2,func_tokens2,func_pos2,_macro_tmp_2442_1-func_pos2);;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length(")"));array_copy(list_src,src_off2,")",0,length(")"));;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;}}else if(is_array(type)&&type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2447_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2447_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2447_1=length(func_tokens);var _macro_tmp_2447_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2447_1+_macro_tmp_2447_2);array_copy(func_tokens,func_pos+_macro_tmp_2447_2,func_tokens,func_pos,_macro_tmp_2447_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);}}wrap_concat_op(gen,list_tokens,list_src,list_off,start_pos,off);type=TYPE_STRING;break;}else if(prio==PRIO_ADDITIVE_ADD||prio==PRIO_ADDITIVE_SUB){if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2454_0=gen->GEN_func_tokens;var _macro_tmp_2454_1=length(_macro_tmp_2454_0);var _macro_tmp_2454_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2454_0,_macro_tmp_2454_1+_macro_tmp_2454_2);array_copy(_macro_tmp_2454_0,_macro_tmp_2454_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2454_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var src_off=length(list_src);array_set_length(list_src,src_off+length("(("));array_copy(list_src,src_off,"((",0,length("(("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2459_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2459_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2459_1=length(func_tokens);var _macro_tmp_2459_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2459_1+_macro_tmp_2459_2);array_copy(func_tokens,func_pos+_macro_tmp_2459_2,func_tokens,func_pos,_macro_tmp_2459_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{")*",prev_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=prev_type;break;}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2465_0=gen->GEN_func_tokens;var _macro_tmp_2465_1=length(_macro_tmp_2465_0);var _macro_tmp_2465_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2465_0,_macro_tmp_2465_1+_macro_tmp_2465_2);array_copy(_macro_tmp_2465_0,_macro_tmp_2465_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2465_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var size_const={type->CLASS_compat_name,"_SIZE"};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(())*",size_const}));array_copy(list_src,src_off,{"(())*",size_const},0,length({"(())*",size_const}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2470_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2470_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2470_1=length(func_tokens);var _macro_tmp_2470_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2470_1+_macro_tmp_2470_2);array_copy(func_tokens,func_pos+_macro_tmp_2470_2,func_tokens,func_pos,_macro_tmp_2470_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2474_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2474_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2474_1=length(func_tokens2);var _macro_tmp_2474_2=(4)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2474_1+_macro_tmp_2474_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2474_2,func_tokens2,func_pos2,_macro_tmp_2474_1-func_pos2);;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='*';func_tokens2[func_pos2++]=src_off+4;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off+5;func_tokens2[func_pos2++]=length(size_const);func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+3;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;break;}}if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2480_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2480_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2480_0,null);if(_macro_tmp_2480_1){var found=false;for(var _macro_tmp_2480_2=0;_macro_tmp_2480_2<length(_macro_tmp_2480_1);_macro_tmp_2480_2+=OPERATOR_SIZE){if(_macro_tmp_2480_1[_macro_tmp_2480_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2480_1[_macro_tmp_2480_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2480_1[_macro_tmp_2480_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2480_1;operator_off=_macro_tmp_2480_2;break;}};if(!operator_list){var _macro_tmp_2482_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2482_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2482_0,null);if(_macro_tmp_2482_1){var found=false;for(var _macro_tmp_2482_2=0;_macro_tmp_2482_2<length(_macro_tmp_2482_1);_macro_tmp_2482_2+=OPERATOR_SIZE){if(_macro_tmp_2482_1[_macro_tmp_2482_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2482_1[_macro_tmp_2482_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2482_1[_macro_tmp_2482_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2482_1;operator_off=_macro_tmp_2482_2;break;}};if(!operator_list){var _macro_tmp_2484_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2484_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2484_0,null);if(_macro_tmp_2484_1){var found=false;for(var _macro_tmp_2484_2=0;_macro_tmp_2484_2<length(_macro_tmp_2484_1);_macro_tmp_2484_2+=OPERATOR_SIZE){if(_macro_tmp_2484_1[_macro_tmp_2484_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2484_1[_macro_tmp_2484_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2484_1[_macro_tmp_2484_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2484_1;operator_off=_macro_tmp_2484_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2488_0=gen->GEN_func_tokens;var _macro_tmp_2488_1=length(_macro_tmp_2488_0);var _macro_tmp_2488_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2488_0,_macro_tmp_2488_1+_macro_tmp_2488_2);array_copy(_macro_tmp_2488_0,_macro_tmp_2488_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2488_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);list_off-=TOK_SIZE;;type=TYPE_FLOAT;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;var adj_last_pos=hash_get(gen->GEN_func_offsets_replacements,prev_last_pos,prev_last_pos);wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,adj_last_pos);list_off-=TOK_SIZE;;}if((type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER&&type!=TYPE_FLOAT)||(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER&&prev_type!=TYPE_FLOAT)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": incompatible type for arithmetic operation"});}if(type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2502_0=gen->GEN_func_tokens;var _macro_tmp_2502_1=length(_macro_tmp_2502_0);var _macro_tmp_2502_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2502_0,_macro_tmp_2502_1+_macro_tmp_2502_2);array_copy(_macro_tmp_2502_0,_macro_tmp_2502_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2502_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}break;}case PRIO_BITWISE_AND..PRIO_BITWISE_USHR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2506_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2506_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2506_0,null);if(_macro_tmp_2506_1){var found=false;for(var _macro_tmp_2506_2=0;_macro_tmp_2506_2<length(_macro_tmp_2506_1);_macro_tmp_2506_2+=OPERATOR_SIZE){if(_macro_tmp_2506_1[_macro_tmp_2506_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2506_1[_macro_tmp_2506_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2506_1[_macro_tmp_2506_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2506_1;operator_off=_macro_tmp_2506_2;break;}};if(!operator_list){var _macro_tmp_2508_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2508_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2508_0,null);if(_macro_tmp_2508_1){var found=false;for(var _macro_tmp_2508_2=0;_macro_tmp_2508_2<length(_macro_tmp_2508_1);_macro_tmp_2508_2+=OPERATOR_SIZE){if(_macro_tmp_2508_1[_macro_tmp_2508_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2508_1[_macro_tmp_2508_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2508_1[_macro_tmp_2508_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2508_1;operator_off=_macro_tmp_2508_2;break;}};if(!operator_list){var _macro_tmp_2510_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2510_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2510_0,null);if(_macro_tmp_2510_1){var found=false;for(var _macro_tmp_2510_2=0;_macro_tmp_2510_2<length(_macro_tmp_2510_1);_macro_tmp_2510_2+=OPERATOR_SIZE){if(_macro_tmp_2510_1[_macro_tmp_2510_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2510_1[_macro_tmp_2510_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2510_1[_macro_tmp_2510_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2510_1;operator_off=_macro_tmp_2510_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2514_0=gen->GEN_func_tokens;var _macro_tmp_2514_1=length(_macro_tmp_2514_0);var _macro_tmp_2514_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2514_0,_macro_tmp_2514_1+_macro_tmp_2514_2);array_copy(_macro_tmp_2514_0,_macro_tmp_2514_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2514_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}type=TYPE_INTEGER;break;}case PRIO_LOGICAL_AND..PRIO_LOGICAL_OR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2520_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2520_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2520_0,null);if(_macro_tmp_2520_1){var found=false;for(var _macro_tmp_2520_2=0;_macro_tmp_2520_2<length(_macro_tmp_2520_1);_macro_tmp_2520_2+=OPERATOR_SIZE){if(_macro_tmp_2520_1[_macro_tmp_2520_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2520_1[_macro_tmp_2520_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2520_1[_macro_tmp_2520_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2520_1;operator_off=_macro_tmp_2520_2;break;}};if(!operator_list){var _macro_tmp_2522_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2522_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2522_0,null);if(_macro_tmp_2522_1){var found=false;for(var _macro_tmp_2522_2=0;_macro_tmp_2522_2<length(_macro_tmp_2522_1);_macro_tmp_2522_2+=OPERATOR_SIZE){if(_macro_tmp_2522_1[_macro_tmp_2522_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2522_1[_macro_tmp_2522_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2522_1[_macro_tmp_2522_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2522_1;operator_off=_macro_tmp_2522_2;break;}};if(!operator_list){var _macro_tmp_2524_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2524_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2524_0,null);if(_macro_tmp_2524_1){var found=false;for(var _macro_tmp_2524_2=0;_macro_tmp_2524_2<length(_macro_tmp_2524_1);_macro_tmp_2524_2+=OPERATOR_SIZE){if(_macro_tmp_2524_1[_macro_tmp_2524_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2524_1[_macro_tmp_2524_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2524_1[_macro_tmp_2524_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2524_1;operator_off=_macro_tmp_2524_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2528_0=gen->GEN_func_tokens;var _macro_tmp_2528_1=length(_macro_tmp_2528_0);var _macro_tmp_2528_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2528_0,_macro_tmp_2528_1+_macro_tmp_2528_2);array_copy(_macro_tmp_2528_0,_macro_tmp_2528_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2528_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}type=TYPE_BOOLEAN;break;}case PRIO_COMPARISON_LT..PRIO_COMPARISON_GE:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2534_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2534_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2534_0,null);if(_macro_tmp_2534_1){var found=false;for(var _macro_tmp_2534_2=0;_macro_tmp_2534_2<length(_macro_tmp_2534_1);_macro_tmp_2534_2+=OPERATOR_SIZE){if(_macro_tmp_2534_1[_macro_tmp_2534_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2534_1[_macro_tmp_2534_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2534_1[_macro_tmp_2534_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2534_1;operator_off=_macro_tmp_2534_2;break;}};if(!operator_list){var _macro_tmp_2536_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2536_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2536_0,null);if(_macro_tmp_2536_1){var found=false;for(var _macro_tmp_2536_2=0;_macro_tmp_2536_2<length(_macro_tmp_2536_1);_macro_tmp_2536_2+=OPERATOR_SIZE){if(_macro_tmp_2536_1[_macro_tmp_2536_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2536_1[_macro_tmp_2536_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2536_1[_macro_tmp_2536_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2536_1;operator_off=_macro_tmp_2536_2;break;}};if(!operator_list){var _macro_tmp_2538_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2538_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2538_0,null);if(_macro_tmp_2538_1){var found=false;for(var _macro_tmp_2538_2=0;_macro_tmp_2538_2<length(_macro_tmp_2538_1);_macro_tmp_2538_2+=OPERATOR_SIZE){if(_macro_tmp_2538_1[_macro_tmp_2538_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2538_1[_macro_tmp_2538_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2538_1[_macro_tmp_2538_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2538_1;operator_off=_macro_tmp_2538_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2542_0=gen->GEN_func_tokens;var _macro_tmp_2542_1=length(_macro_tmp_2542_0);var _macro_tmp_2542_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2542_0,_macro_tmp_2542_1+_macro_tmp_2542_2);array_copy(_macro_tmp_2542_0,_macro_tmp_2542_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2542_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_INTEGER&&type==TYPE_DYNAMIC){}else if(prev_type==TYPE_DYNAMIC&&type==TYPE_INTEGER){}else if(prev_type==TYPE_INTEGER&&type==TYPE_INTEGER){}else if(prev_type==TYPE_FLOAT&&type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2547_0=gen->GEN_func_tokens;var _macro_tmp_2547_1=length(_macro_tmp_2547_0);var _macro_tmp_2547_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2547_0,_macro_tmp_2547_1+_macro_tmp_2547_2);array_copy(_macro_tmp_2547_0,_macro_tmp_2547_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2547_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if((is_struct1&&is_struct2)||(is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){if(is_struct1&&is_struct2&&prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}list_off+=TOK_SIZE;;var _macro_tmp_2553_0=gen->GEN_func_tokens;var _macro_tmp_2553_1=length(_macro_tmp_2553_0);var _macro_tmp_2553_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2553_0,_macro_tmp_2553_1+_macro_tmp_2553_2);array_copy(_macro_tmp_2553_0,_macro_tmp_2553_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2553_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1&&!is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2&&!is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}else{return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible types"});}}type=TYPE_BOOLEAN;break;}case PRIO_EQUALITY_EQ_VALUE..PRIO_EQUALITY_NE_REF:{if(prio==PRIO_EQUALITY_EQ_VALUE||prio==PRIO_EQUALITY_NE_VALUE){if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2559_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2559_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2559_0,null);if(_macro_tmp_2559_1){var found=false;for(var _macro_tmp_2559_2=0;_macro_tmp_2559_2<length(_macro_tmp_2559_1);_macro_tmp_2559_2+=OPERATOR_SIZE){if(_macro_tmp_2559_1[_macro_tmp_2559_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2559_1[_macro_tmp_2559_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2559_1[_macro_tmp_2559_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2559_1;operator_off=_macro_tmp_2559_2;break;}};if(!operator_list){var _macro_tmp_2561_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2561_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2561_0,null);if(_macro_tmp_2561_1){var found=false;for(var _macro_tmp_2561_2=0;_macro_tmp_2561_2<length(_macro_tmp_2561_1);_macro_tmp_2561_2+=OPERATOR_SIZE){if(_macro_tmp_2561_1[_macro_tmp_2561_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2561_1[_macro_tmp_2561_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2561_1[_macro_tmp_2561_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2561_1;operator_off=_macro_tmp_2561_2;break;}};if(!operator_list){var _macro_tmp_2563_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2563_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2563_0,null);if(_macro_tmp_2563_1){var found=false;for(var _macro_tmp_2563_2=0;_macro_tmp_2563_2<length(_macro_tmp_2563_1);_macro_tmp_2563_2+=OPERATOR_SIZE){if(_macro_tmp_2563_1[_macro_tmp_2563_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2563_1[_macro_tmp_2563_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2563_1[_macro_tmp_2563_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2563_1;operator_off=_macro_tmp_2563_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2567_0=gen->GEN_func_tokens;var _macro_tmp_2567_1=length(_macro_tmp_2567_0);var _macro_tmp_2567_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2567_0,_macro_tmp_2567_1+_macro_tmp_2567_2);array_copy(_macro_tmp_2567_0,_macro_tmp_2567_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2567_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};}if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,prev_last_pos);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if(is_struct1&&is_struct2){if(prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}}else if((is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){list_off+=TOK_SIZE;;var _macro_tmp_2583_0=gen->GEN_func_tokens;var _macro_tmp_2583_1=length(_macro_tmp_2583_0);var _macro_tmp_2583_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2583_0,_macro_tmp_2583_1+_macro_tmp_2583_2);array_copy(_macro_tmp_2583_0,_macro_tmp_2583_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2583_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}}type=TYPE_BOOLEAN;break;}};
if(outer){
while(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('?'))){if(type==TYPE_INTEGER||type==TYPE_FLOAT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});}list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type1=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type2=gen->GEN_ret_type;if(type1==TYPE_DYNAMIC){type1=type2;}if(type2==TYPE_DYNAMIC){type2=type1;}if(!is_same_type(type1,type2)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": both values in ternary operator must have the same type"});}type=type1;}list_off-=TOK_SIZE;;;
}
prev_type=type;
break;
}

if((next_prio>>4)>(prio>>4)){
list_off=parse_expression(gen,list_tokens,list_src,list_off,type,off,next_prio);;
type=gen->GEN_ret_type;
if(prev_type!=-1){
switch(prio){case PRIO_ADDITIVE_ADD..PRIO_ADDITIVE_SUB,PRIO_MULTIPLICATIVE_MUL..PRIO_MULTIPLICATIVE_REM:{if(prio==PRIO_ADDITIVE_ADD&&(prev_type==TYPE_STRING||type==TYPE_STRING)){list_off+=TOK_SIZE;;var _macro_tmp_2606_0=gen->GEN_func_tokens;var _macro_tmp_2606_1=length(_macro_tmp_2606_0);var _macro_tmp_2606_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2606_0,_macro_tmp_2606_1+_macro_tmp_2606_2);array_copy(_macro_tmp_2606_0,_macro_tmp_2606_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2606_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(prev_type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2610_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2610_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2610_1=length(func_tokens);var _macro_tmp_2610_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2610_1+_macro_tmp_2610_2);array_copy(func_tokens,func_pos+_macro_tmp_2610_2,func_tokens,func_pos,_macro_tmp_2610_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2615_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2615_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2615_1=length(func_tokens2);var _macro_tmp_2615_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2615_1+_macro_tmp_2615_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2615_2,func_tokens2,func_pos2,_macro_tmp_2615_1-func_pos2);;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length(")"));array_copy(list_src,src_off2,")",0,length(")"));;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;}}else if(is_array(type)&&type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2620_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2620_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2620_1=length(func_tokens);var _macro_tmp_2620_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2620_1+_macro_tmp_2620_2);array_copy(func_tokens,func_pos+_macro_tmp_2620_2,func_tokens,func_pos,_macro_tmp_2620_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);}}wrap_concat_op(gen,list_tokens,list_src,list_off,start_pos,off);type=TYPE_STRING;break;}else if(prio==PRIO_ADDITIVE_ADD||prio==PRIO_ADDITIVE_SUB){if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2627_0=gen->GEN_func_tokens;var _macro_tmp_2627_1=length(_macro_tmp_2627_0);var _macro_tmp_2627_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2627_0,_macro_tmp_2627_1+_macro_tmp_2627_2);array_copy(_macro_tmp_2627_0,_macro_tmp_2627_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2627_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var src_off=length(list_src);array_set_length(list_src,src_off+length("(("));array_copy(list_src,src_off,"((",0,length("(("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2632_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2632_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2632_1=length(func_tokens);var _macro_tmp_2632_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2632_1+_macro_tmp_2632_2);array_copy(func_tokens,func_pos+_macro_tmp_2632_2,func_tokens,func_pos,_macro_tmp_2632_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{")*",prev_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=prev_type;break;}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2638_0=gen->GEN_func_tokens;var _macro_tmp_2638_1=length(_macro_tmp_2638_0);var _macro_tmp_2638_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2638_0,_macro_tmp_2638_1+_macro_tmp_2638_2);array_copy(_macro_tmp_2638_0,_macro_tmp_2638_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2638_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var size_const={type->CLASS_compat_name,"_SIZE"};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(())*",size_const}));array_copy(list_src,src_off,{"(())*",size_const},0,length({"(())*",size_const}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2643_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2643_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2643_1=length(func_tokens);var _macro_tmp_2643_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2643_1+_macro_tmp_2643_2);array_copy(func_tokens,func_pos+_macro_tmp_2643_2,func_tokens,func_pos,_macro_tmp_2643_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2647_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2647_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2647_1=length(func_tokens2);var _macro_tmp_2647_2=(4)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2647_1+_macro_tmp_2647_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2647_2,func_tokens2,func_pos2,_macro_tmp_2647_1-func_pos2);;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='*';func_tokens2[func_pos2++]=src_off+4;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off+5;func_tokens2[func_pos2++]=length(size_const);func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+3;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;break;}}if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2653_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2653_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2653_0,null);if(_macro_tmp_2653_1){var found=false;for(var _macro_tmp_2653_2=0;_macro_tmp_2653_2<length(_macro_tmp_2653_1);_macro_tmp_2653_2+=OPERATOR_SIZE){if(_macro_tmp_2653_1[_macro_tmp_2653_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2653_1[_macro_tmp_2653_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2653_1[_macro_tmp_2653_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2653_1;operator_off=_macro_tmp_2653_2;break;}};if(!operator_list){var _macro_tmp_2655_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2655_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2655_0,null);if(_macro_tmp_2655_1){var found=false;for(var _macro_tmp_2655_2=0;_macro_tmp_2655_2<length(_macro_tmp_2655_1);_macro_tmp_2655_2+=OPERATOR_SIZE){if(_macro_tmp_2655_1[_macro_tmp_2655_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2655_1[_macro_tmp_2655_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2655_1[_macro_tmp_2655_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2655_1;operator_off=_macro_tmp_2655_2;break;}};if(!operator_list){var _macro_tmp_2657_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2657_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2657_0,null);if(_macro_tmp_2657_1){var found=false;for(var _macro_tmp_2657_2=0;_macro_tmp_2657_2<length(_macro_tmp_2657_1);_macro_tmp_2657_2+=OPERATOR_SIZE){if(_macro_tmp_2657_1[_macro_tmp_2657_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2657_1[_macro_tmp_2657_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2657_1[_macro_tmp_2657_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2657_1;operator_off=_macro_tmp_2657_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2661_0=gen->GEN_func_tokens;var _macro_tmp_2661_1=length(_macro_tmp_2661_0);var _macro_tmp_2661_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2661_0,_macro_tmp_2661_1+_macro_tmp_2661_2);array_copy(_macro_tmp_2661_0,_macro_tmp_2661_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2661_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);list_off-=TOK_SIZE;;type=TYPE_FLOAT;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;var adj_last_pos=hash_get(gen->GEN_func_offsets_replacements,prev_last_pos,prev_last_pos);wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,adj_last_pos);list_off-=TOK_SIZE;;}if((type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER&&type!=TYPE_FLOAT)||(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER&&prev_type!=TYPE_FLOAT)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": incompatible type for arithmetic operation"});}if(type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2675_0=gen->GEN_func_tokens;var _macro_tmp_2675_1=length(_macro_tmp_2675_0);var _macro_tmp_2675_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2675_0,_macro_tmp_2675_1+_macro_tmp_2675_2);array_copy(_macro_tmp_2675_0,_macro_tmp_2675_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2675_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}break;}case PRIO_BITWISE_AND..PRIO_BITWISE_USHR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2679_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2679_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2679_0,null);if(_macro_tmp_2679_1){var found=false;for(var _macro_tmp_2679_2=0;_macro_tmp_2679_2<length(_macro_tmp_2679_1);_macro_tmp_2679_2+=OPERATOR_SIZE){if(_macro_tmp_2679_1[_macro_tmp_2679_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2679_1[_macro_tmp_2679_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2679_1[_macro_tmp_2679_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2679_1;operator_off=_macro_tmp_2679_2;break;}};if(!operator_list){var _macro_tmp_2681_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2681_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2681_0,null);if(_macro_tmp_2681_1){var found=false;for(var _macro_tmp_2681_2=0;_macro_tmp_2681_2<length(_macro_tmp_2681_1);_macro_tmp_2681_2+=OPERATOR_SIZE){if(_macro_tmp_2681_1[_macro_tmp_2681_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2681_1[_macro_tmp_2681_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2681_1[_macro_tmp_2681_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2681_1;operator_off=_macro_tmp_2681_2;break;}};if(!operator_list){var _macro_tmp_2683_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2683_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2683_0,null);if(_macro_tmp_2683_1){var found=false;for(var _macro_tmp_2683_2=0;_macro_tmp_2683_2<length(_macro_tmp_2683_1);_macro_tmp_2683_2+=OPERATOR_SIZE){if(_macro_tmp_2683_1[_macro_tmp_2683_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2683_1[_macro_tmp_2683_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2683_1[_macro_tmp_2683_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2683_1;operator_off=_macro_tmp_2683_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2687_0=gen->GEN_func_tokens;var _macro_tmp_2687_1=length(_macro_tmp_2687_0);var _macro_tmp_2687_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2687_0,_macro_tmp_2687_1+_macro_tmp_2687_2);array_copy(_macro_tmp_2687_0,_macro_tmp_2687_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2687_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}type=TYPE_INTEGER;break;}case PRIO_LOGICAL_AND..PRIO_LOGICAL_OR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2693_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2693_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2693_0,null);if(_macro_tmp_2693_1){var found=false;for(var _macro_tmp_2693_2=0;_macro_tmp_2693_2<length(_macro_tmp_2693_1);_macro_tmp_2693_2+=OPERATOR_SIZE){if(_macro_tmp_2693_1[_macro_tmp_2693_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2693_1[_macro_tmp_2693_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2693_1[_macro_tmp_2693_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2693_1;operator_off=_macro_tmp_2693_2;break;}};if(!operator_list){var _macro_tmp_2695_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2695_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2695_0,null);if(_macro_tmp_2695_1){var found=false;for(var _macro_tmp_2695_2=0;_macro_tmp_2695_2<length(_macro_tmp_2695_1);_macro_tmp_2695_2+=OPERATOR_SIZE){if(_macro_tmp_2695_1[_macro_tmp_2695_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2695_1[_macro_tmp_2695_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2695_1[_macro_tmp_2695_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2695_1;operator_off=_macro_tmp_2695_2;break;}};if(!operator_list){var _macro_tmp_2697_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2697_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2697_0,null);if(_macro_tmp_2697_1){var found=false;for(var _macro_tmp_2697_2=0;_macro_tmp_2697_2<length(_macro_tmp_2697_1);_macro_tmp_2697_2+=OPERATOR_SIZE){if(_macro_tmp_2697_1[_macro_tmp_2697_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2697_1[_macro_tmp_2697_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2697_1[_macro_tmp_2697_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2697_1;operator_off=_macro_tmp_2697_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2701_0=gen->GEN_func_tokens;var _macro_tmp_2701_1=length(_macro_tmp_2701_0);var _macro_tmp_2701_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2701_0,_macro_tmp_2701_1+_macro_tmp_2701_2);array_copy(_macro_tmp_2701_0,_macro_tmp_2701_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2701_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}type=TYPE_BOOLEAN;break;}case PRIO_COMPARISON_LT..PRIO_COMPARISON_GE:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2707_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2707_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2707_0,null);if(_macro_tmp_2707_1){var found=false;for(var _macro_tmp_2707_2=0;_macro_tmp_2707_2<length(_macro_tmp_2707_1);_macro_tmp_2707_2+=OPERATOR_SIZE){if(_macro_tmp_2707_1[_macro_tmp_2707_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2707_1[_macro_tmp_2707_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2707_1[_macro_tmp_2707_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2707_1;operator_off=_macro_tmp_2707_2;break;}};if(!operator_list){var _macro_tmp_2709_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2709_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2709_0,null);if(_macro_tmp_2709_1){var found=false;for(var _macro_tmp_2709_2=0;_macro_tmp_2709_2<length(_macro_tmp_2709_1);_macro_tmp_2709_2+=OPERATOR_SIZE){if(_macro_tmp_2709_1[_macro_tmp_2709_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2709_1[_macro_tmp_2709_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2709_1[_macro_tmp_2709_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2709_1;operator_off=_macro_tmp_2709_2;break;}};if(!operator_list){var _macro_tmp_2711_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2711_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2711_0,null);if(_macro_tmp_2711_1){var found=false;for(var _macro_tmp_2711_2=0;_macro_tmp_2711_2<length(_macro_tmp_2711_1);_macro_tmp_2711_2+=OPERATOR_SIZE){if(_macro_tmp_2711_1[_macro_tmp_2711_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2711_1[_macro_tmp_2711_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2711_1[_macro_tmp_2711_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2711_1;operator_off=_macro_tmp_2711_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2715_0=gen->GEN_func_tokens;var _macro_tmp_2715_1=length(_macro_tmp_2715_0);var _macro_tmp_2715_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2715_0,_macro_tmp_2715_1+_macro_tmp_2715_2);array_copy(_macro_tmp_2715_0,_macro_tmp_2715_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2715_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_INTEGER&&type==TYPE_DYNAMIC){}else if(prev_type==TYPE_DYNAMIC&&type==TYPE_INTEGER){}else if(prev_type==TYPE_INTEGER&&type==TYPE_INTEGER){}else if(prev_type==TYPE_FLOAT&&type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2720_0=gen->GEN_func_tokens;var _macro_tmp_2720_1=length(_macro_tmp_2720_0);var _macro_tmp_2720_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2720_0,_macro_tmp_2720_1+_macro_tmp_2720_2);array_copy(_macro_tmp_2720_0,_macro_tmp_2720_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2720_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if((is_struct1&&is_struct2)||(is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){if(is_struct1&&is_struct2&&prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}list_off+=TOK_SIZE;;var _macro_tmp_2726_0=gen->GEN_func_tokens;var _macro_tmp_2726_1=length(_macro_tmp_2726_0);var _macro_tmp_2726_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2726_0,_macro_tmp_2726_1+_macro_tmp_2726_2);array_copy(_macro_tmp_2726_0,_macro_tmp_2726_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2726_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1&&!is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2&&!is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}else{return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible types"});}}type=TYPE_BOOLEAN;break;}case PRIO_EQUALITY_EQ_VALUE..PRIO_EQUALITY_NE_REF:{if(prio==PRIO_EQUALITY_EQ_VALUE||prio==PRIO_EQUALITY_NE_VALUE){if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2732_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2732_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2732_0,null);if(_macro_tmp_2732_1){var found=false;for(var _macro_tmp_2732_2=0;_macro_tmp_2732_2<length(_macro_tmp_2732_1);_macro_tmp_2732_2+=OPERATOR_SIZE){if(_macro_tmp_2732_1[_macro_tmp_2732_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2732_1[_macro_tmp_2732_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2732_1[_macro_tmp_2732_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2732_1;operator_off=_macro_tmp_2732_2;break;}};if(!operator_list){var _macro_tmp_2734_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2734_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2734_0,null);if(_macro_tmp_2734_1){var found=false;for(var _macro_tmp_2734_2=0;_macro_tmp_2734_2<length(_macro_tmp_2734_1);_macro_tmp_2734_2+=OPERATOR_SIZE){if(_macro_tmp_2734_1[_macro_tmp_2734_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2734_1[_macro_tmp_2734_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2734_1[_macro_tmp_2734_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2734_1;operator_off=_macro_tmp_2734_2;break;}};if(!operator_list){var _macro_tmp_2736_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2736_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2736_0,null);if(_macro_tmp_2736_1){var found=false;for(var _macro_tmp_2736_2=0;_macro_tmp_2736_2<length(_macro_tmp_2736_1);_macro_tmp_2736_2+=OPERATOR_SIZE){if(_macro_tmp_2736_1[_macro_tmp_2736_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2736_1[_macro_tmp_2736_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2736_1[_macro_tmp_2736_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2736_1;operator_off=_macro_tmp_2736_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2740_0=gen->GEN_func_tokens;var _macro_tmp_2740_1=length(_macro_tmp_2740_0);var _macro_tmp_2740_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2740_0,_macro_tmp_2740_1+_macro_tmp_2740_2);array_copy(_macro_tmp_2740_0,_macro_tmp_2740_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2740_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};}if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,prev_last_pos);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if(is_struct1&&is_struct2){if(prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}}else if((is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){list_off+=TOK_SIZE;;var _macro_tmp_2756_0=gen->GEN_func_tokens;var _macro_tmp_2756_1=length(_macro_tmp_2756_0);var _macro_tmp_2756_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2756_0,_macro_tmp_2756_1+_macro_tmp_2756_2);array_copy(_macro_tmp_2756_0,_macro_tmp_2756_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2756_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}}type=TYPE_BOOLEAN;break;}};
while(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('?'))){if(type==TYPE_INTEGER||type==TYPE_FLOAT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});}list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type1=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type2=gen->GEN_ret_type;if(type1==TYPE_DYNAMIC){type1=type2;}if(type2==TYPE_DYNAMIC){type2=type1;}if(!is_same_type(type1,type2)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": both values in ternary operator must have the same type"});}type=type1;}list_off-=TOK_SIZE;;;
}
if(((list_off+=TOK_SIZE)<length(list_tokens))){
next_prio=-1;
switch((list_tokens[list_off])){case '*':next_prio=PRIO_MULTIPLICATIVE_MUL;break;case '/':next_prio=PRIO_MULTIPLICATIVE_DIV;break;case '%':next_prio=PRIO_MULTIPLICATIVE_REM;break;case '+':next_prio=PRIO_ADDITIVE_ADD;break;case '-':next_prio=PRIO_ADDITIVE_SUB;break;case '&':next_prio=PRIO_BITWISE_AND;break;case '|':next_prio=PRIO_BITWISE_OR;break;case '^':next_prio=PRIO_BITWISE_XOR;break;case '<':next_prio=PRIO_COMPARISON_LT;break;case '>':next_prio=PRIO_COMPARISON_GT;break;case '<<':next_prio=PRIO_BITWISE_SHL;break;case '>>':next_prio=PRIO_BITWISE_SHR;break;case '&&':next_prio=PRIO_LOGICAL_AND;break;case '||':next_prio=PRIO_LOGICAL_OR;break;case '<=':next_prio=PRIO_COMPARISON_LE;break;case '>=':next_prio=PRIO_COMPARISON_GE;break;case '==':next_prio=PRIO_EQUALITY_EQ_VALUE;break;case '!=':next_prio=PRIO_EQUALITY_NE_VALUE;break;case '===':next_prio=PRIO_EQUALITY_EQ_REF;break;case '!==':next_prio=PRIO_EQUALITY_NE_REF;break;case '>>>':next_prio=PRIO_BITWISE_USHR;break;};
list_off-=TOK_SIZE;;
if(next_prio==-1){
prev_type=type;
break;
}
}
}
else{
list_off-=TOK_SIZE;;
switch(prio){case PRIO_ADDITIVE_ADD..PRIO_ADDITIVE_SUB,PRIO_MULTIPLICATIVE_MUL..PRIO_MULTIPLICATIVE_REM:{if(prio==PRIO_ADDITIVE_ADD&&(prev_type==TYPE_STRING||type==TYPE_STRING)){list_off+=TOK_SIZE;;var _macro_tmp_2782_0=gen->GEN_func_tokens;var _macro_tmp_2782_1=length(_macro_tmp_2782_0);var _macro_tmp_2782_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2782_0,_macro_tmp_2782_1+_macro_tmp_2782_2);array_copy(_macro_tmp_2782_0,_macro_tmp_2782_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2782_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(prev_type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2786_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2786_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2786_1=length(func_tokens);var _macro_tmp_2786_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2786_1+_macro_tmp_2786_2);array_copy(func_tokens,func_pos+_macro_tmp_2786_2,func_tokens,func_pos,_macro_tmp_2786_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2791_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2791_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2791_1=length(func_tokens2);var _macro_tmp_2791_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2791_1+_macro_tmp_2791_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2791_2,func_tokens2,func_pos2,_macro_tmp_2791_1-func_pos2);;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length(")"));array_copy(list_src,src_off2,")",0,length(")"));;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;}}else if(is_array(type)&&type[0]==EXT_TYPE_CLASS){var to_string_cls=find_to_string_function(type);if(to_string_cls){var line=(list_tokens[list_off+TOK_line]);var prepend={to_string_cls->CLASS_method_prefix,"to_string("};var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2796_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2796_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2796_1=length(func_tokens);var _macro_tmp_2796_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2796_1+_macro_tmp_2796_2);array_copy(func_tokens,func_pos+_macro_tmp_2796_2,func_tokens,func_pos,_macro_tmp_2796_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length(prepend));array_copy(list_src,src_off,prepend,0,length(prepend));;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(prepend)-1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(prepend)-1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);}}wrap_concat_op(gen,list_tokens,list_src,list_off,start_pos,off);type=TYPE_STRING;break;}else if(prio==PRIO_ADDITIVE_ADD||prio==PRIO_ADDITIVE_SUB){if(is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2803_0=gen->GEN_func_tokens;var _macro_tmp_2803_1=length(_macro_tmp_2803_0);var _macro_tmp_2803_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2803_0,_macro_tmp_2803_1+_macro_tmp_2803_2);array_copy(_macro_tmp_2803_0,_macro_tmp_2803_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2803_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var src_off=length(list_src);array_set_length(list_src,src_off+length("(("));array_copy(list_src,src_off,"((",0,length("(("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2808_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2808_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2808_1=length(func_tokens);var _macro_tmp_2808_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2808_1+_macro_tmp_2808_2);array_copy(func_tokens,func_pos+_macro_tmp_2808_2,func_tokens,func_pos,_macro_tmp_2808_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{")*",prev_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=prev_type;break;}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC)){list_off+=TOK_SIZE;;var _macro_tmp_2814_0=gen->GEN_func_tokens;var _macro_tmp_2814_1=length(_macro_tmp_2814_0);var _macro_tmp_2814_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2814_0,_macro_tmp_2814_1+_macro_tmp_2814_2);array_copy(_macro_tmp_2814_0,_macro_tmp_2814_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2814_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var size_const={type->CLASS_compat_name,"_SIZE"};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(())*",size_const}));array_copy(list_src,src_off,{"(())*",size_const},0,length({"(())*",size_const}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_2819_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_2819_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_2819_1=length(func_tokens);var _macro_tmp_2819_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_2819_1+_macro_tmp_2819_2);array_copy(func_tokens,func_pos+_macro_tmp_2819_2,func_tokens,func_pos,_macro_tmp_2819_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_2823_0=off>=0?list_tokens[off+TOK_off]:func_tokens2[-off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_2823_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_2823_1=length(func_tokens2);var _macro_tmp_2823_2=(4)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_2823_1+_macro_tmp_2823_2);array_copy(func_tokens2,func_pos2+_macro_tmp_2823_2,func_tokens2,func_pos2,_macro_tmp_2823_1-func_pos2);;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='*';func_tokens2[func_pos2++]=src_off+4;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off+5;func_tokens2[func_pos2++]=length(size_const);func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+3;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;break;}}if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2829_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2829_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2829_0,null);if(_macro_tmp_2829_1){var found=false;for(var _macro_tmp_2829_2=0;_macro_tmp_2829_2<length(_macro_tmp_2829_1);_macro_tmp_2829_2+=OPERATOR_SIZE){if(_macro_tmp_2829_1[_macro_tmp_2829_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2829_1[_macro_tmp_2829_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2829_1[_macro_tmp_2829_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2829_1;operator_off=_macro_tmp_2829_2;break;}};if(!operator_list){var _macro_tmp_2831_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2831_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2831_0,null);if(_macro_tmp_2831_1){var found=false;for(var _macro_tmp_2831_2=0;_macro_tmp_2831_2<length(_macro_tmp_2831_1);_macro_tmp_2831_2+=OPERATOR_SIZE){if(_macro_tmp_2831_1[_macro_tmp_2831_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2831_1[_macro_tmp_2831_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2831_1[_macro_tmp_2831_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2831_1;operator_off=_macro_tmp_2831_2;break;}};if(!operator_list){var _macro_tmp_2833_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2833_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2833_0,null);if(_macro_tmp_2833_1){var found=false;for(var _macro_tmp_2833_2=0;_macro_tmp_2833_2<length(_macro_tmp_2833_1);_macro_tmp_2833_2+=OPERATOR_SIZE){if(_macro_tmp_2833_1[_macro_tmp_2833_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2833_1[_macro_tmp_2833_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2833_1[_macro_tmp_2833_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2833_1;operator_off=_macro_tmp_2833_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2837_0=gen->GEN_func_tokens;var _macro_tmp_2837_1=length(_macro_tmp_2837_0);var _macro_tmp_2837_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2837_0,_macro_tmp_2837_1+_macro_tmp_2837_2);array_copy(_macro_tmp_2837_0,_macro_tmp_2837_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2837_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);list_off-=TOK_SIZE;;type=TYPE_FLOAT;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;var adj_last_pos=hash_get(gen->GEN_func_offsets_replacements,prev_last_pos,prev_last_pos);wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,adj_last_pos);list_off-=TOK_SIZE;;}if((type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER&&type!=TYPE_FLOAT)||(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER&&prev_type!=TYPE_FLOAT)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": incompatible type for arithmetic operation"});}if(type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2851_0=gen->GEN_func_tokens;var _macro_tmp_2851_1=length(_macro_tmp_2851_0);var _macro_tmp_2851_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2851_0,_macro_tmp_2851_1+_macro_tmp_2851_2);array_copy(_macro_tmp_2851_0,_macro_tmp_2851_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2851_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}break;}case PRIO_BITWISE_AND..PRIO_BITWISE_USHR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2855_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2855_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2855_0,null);if(_macro_tmp_2855_1){var found=false;for(var _macro_tmp_2855_2=0;_macro_tmp_2855_2<length(_macro_tmp_2855_1);_macro_tmp_2855_2+=OPERATOR_SIZE){if(_macro_tmp_2855_1[_macro_tmp_2855_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2855_1[_macro_tmp_2855_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2855_1[_macro_tmp_2855_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2855_1;operator_off=_macro_tmp_2855_2;break;}};if(!operator_list){var _macro_tmp_2857_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2857_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2857_0,null);if(_macro_tmp_2857_1){var found=false;for(var _macro_tmp_2857_2=0;_macro_tmp_2857_2<length(_macro_tmp_2857_1);_macro_tmp_2857_2+=OPERATOR_SIZE){if(_macro_tmp_2857_1[_macro_tmp_2857_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2857_1[_macro_tmp_2857_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2857_1[_macro_tmp_2857_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2857_1;operator_off=_macro_tmp_2857_2;break;}};if(!operator_list){var _macro_tmp_2859_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2859_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2859_0,null);if(_macro_tmp_2859_1){var found=false;for(var _macro_tmp_2859_2=0;_macro_tmp_2859_2<length(_macro_tmp_2859_1);_macro_tmp_2859_2+=OPERATOR_SIZE){if(_macro_tmp_2859_1[_macro_tmp_2859_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2859_1[_macro_tmp_2859_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2859_1[_macro_tmp_2859_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2859_1;operator_off=_macro_tmp_2859_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2863_0=gen->GEN_func_tokens;var _macro_tmp_2863_1=length(_macro_tmp_2863_0);var _macro_tmp_2863_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2863_0,_macro_tmp_2863_1+_macro_tmp_2863_2);array_copy(_macro_tmp_2863_0,_macro_tmp_2863_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2863_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer"});}type=TYPE_INTEGER;break;}case PRIO_LOGICAL_AND..PRIO_LOGICAL_OR:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2869_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2869_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2869_0,null);if(_macro_tmp_2869_1){var found=false;for(var _macro_tmp_2869_2=0;_macro_tmp_2869_2<length(_macro_tmp_2869_1);_macro_tmp_2869_2+=OPERATOR_SIZE){if(_macro_tmp_2869_1[_macro_tmp_2869_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2869_1[_macro_tmp_2869_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2869_1[_macro_tmp_2869_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2869_1;operator_off=_macro_tmp_2869_2;break;}};if(!operator_list){var _macro_tmp_2871_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2871_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2871_0,null);if(_macro_tmp_2871_1){var found=false;for(var _macro_tmp_2871_2=0;_macro_tmp_2871_2<length(_macro_tmp_2871_1);_macro_tmp_2871_2+=OPERATOR_SIZE){if(_macro_tmp_2871_1[_macro_tmp_2871_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2871_1[_macro_tmp_2871_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2871_1[_macro_tmp_2871_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2871_1;operator_off=_macro_tmp_2871_2;break;}};if(!operator_list){var _macro_tmp_2873_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2873_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2873_0,null);if(_macro_tmp_2873_1){var found=false;for(var _macro_tmp_2873_2=0;_macro_tmp_2873_2<length(_macro_tmp_2873_1);_macro_tmp_2873_2+=OPERATOR_SIZE){if(_macro_tmp_2873_1[_macro_tmp_2873_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2873_1[_macro_tmp_2873_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2873_1[_macro_tmp_2873_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2873_1;operator_off=_macro_tmp_2873_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2877_0=gen->GEN_func_tokens;var _macro_tmp_2877_1=length(_macro_tmp_2877_0);var _macro_tmp_2877_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2877_0,_macro_tmp_2877_1+_macro_tmp_2877_2);array_copy(_macro_tmp_2877_0,_macro_tmp_2877_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2877_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type!=TYPE_DYNAMIC&&prev_type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}if(type!=TYPE_DYNAMIC&&type!=TYPE_BOOLEAN){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Boolean"});}type=TYPE_BOOLEAN;break;}case PRIO_COMPARISON_LT..PRIO_COMPARISON_GE:{if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2883_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2883_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2883_0,null);if(_macro_tmp_2883_1){var found=false;for(var _macro_tmp_2883_2=0;_macro_tmp_2883_2<length(_macro_tmp_2883_1);_macro_tmp_2883_2+=OPERATOR_SIZE){if(_macro_tmp_2883_1[_macro_tmp_2883_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2883_1[_macro_tmp_2883_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2883_1[_macro_tmp_2883_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2883_1;operator_off=_macro_tmp_2883_2;break;}};if(!operator_list){var _macro_tmp_2885_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2885_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2885_0,null);if(_macro_tmp_2885_1){var found=false;for(var _macro_tmp_2885_2=0;_macro_tmp_2885_2<length(_macro_tmp_2885_1);_macro_tmp_2885_2+=OPERATOR_SIZE){if(_macro_tmp_2885_1[_macro_tmp_2885_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2885_1[_macro_tmp_2885_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2885_1[_macro_tmp_2885_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2885_1;operator_off=_macro_tmp_2885_2;break;}};if(!operator_list){var _macro_tmp_2887_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2887_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2887_0,null);if(_macro_tmp_2887_1){var found=false;for(var _macro_tmp_2887_2=0;_macro_tmp_2887_2<length(_macro_tmp_2887_1);_macro_tmp_2887_2+=OPERATOR_SIZE){if(_macro_tmp_2887_1[_macro_tmp_2887_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2887_1[_macro_tmp_2887_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2887_1[_macro_tmp_2887_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2887_1;operator_off=_macro_tmp_2887_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2891_0=gen->GEN_func_tokens;var _macro_tmp_2891_1=length(_macro_tmp_2891_0);var _macro_tmp_2891_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2891_0,_macro_tmp_2891_1+_macro_tmp_2891_2);array_copy(_macro_tmp_2891_0,_macro_tmp_2891_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2891_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};if(prev_type==TYPE_INTEGER&&type==TYPE_DYNAMIC){}else if(prev_type==TYPE_DYNAMIC&&type==TYPE_INTEGER){}else if(prev_type==TYPE_INTEGER&&type==TYPE_INTEGER){}else if(prev_type==TYPE_FLOAT&&type==TYPE_FLOAT){list_off+=TOK_SIZE;;var _macro_tmp_2896_0=gen->GEN_func_tokens;var _macro_tmp_2896_1=length(_macro_tmp_2896_0);var _macro_tmp_2896_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2896_0,_macro_tmp_2896_1+_macro_tmp_2896_2);array_copy(_macro_tmp_2896_0,_macro_tmp_2896_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2896_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if((is_struct1&&is_struct2)||(is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){if(is_struct1&&is_struct2&&prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}list_off+=TOK_SIZE;;var _macro_tmp_2902_0=gen->GEN_func_tokens;var _macro_tmp_2902_1=length(_macro_tmp_2902_0);var _macro_tmp_2902_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2902_0,_macro_tmp_2902_1+_macro_tmp_2902_2);array_copy(_macro_tmp_2902_0,_macro_tmp_2902_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2902_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1&&!is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2&&!is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}else{return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible types"});}}type=TYPE_BOOLEAN;break;}case PRIO_EQUALITY_EQ_VALUE..PRIO_EQUALITY_NE_REF:{if(prio==PRIO_EQUALITY_EQ_VALUE||prio==PRIO_EQUALITY_NE_VALUE){if(is_array(prev_type)||is_array(type)){var operator_list,operator_off;var _macro_tmp_2908_0=add32(mul32(add32(mul32(prev_type,31),type),31),prio);var _macro_tmp_2908_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2908_0,null);if(_macro_tmp_2908_1){var found=false;for(var _macro_tmp_2908_2=0;_macro_tmp_2908_2<length(_macro_tmp_2908_1);_macro_tmp_2908_2+=OPERATOR_SIZE){if(_macro_tmp_2908_1[_macro_tmp_2908_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2908_1[_macro_tmp_2908_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2908_1[_macro_tmp_2908_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2908_1;operator_off=_macro_tmp_2908_2;break;}};if(!operator_list){var _macro_tmp_2910_0=add32(mul32(add32(mul32(prev_type,31),TYPE_DYNAMIC),31),prio);var _macro_tmp_2910_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2910_0,null);if(_macro_tmp_2910_1){var found=false;for(var _macro_tmp_2910_2=0;_macro_tmp_2910_2<length(_macro_tmp_2910_1);_macro_tmp_2910_2+=OPERATOR_SIZE){if(_macro_tmp_2910_1[_macro_tmp_2910_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2910_1[_macro_tmp_2910_2+OPERATOR_type1]!==prev_type)continue;if(_macro_tmp_2910_1[_macro_tmp_2910_2+OPERATOR_type2]!==TYPE_DYNAMIC)continue;operator_list=_macro_tmp_2910_1;operator_off=_macro_tmp_2910_2;break;}};if(!operator_list){var _macro_tmp_2912_0=add32(mul32(add32(mul32(TYPE_DYNAMIC,31),type),31),prio);var _macro_tmp_2912_1=hash_get(gen->GEN_imported_operators,_macro_tmp_2912_0,null);if(_macro_tmp_2912_1){var found=false;for(var _macro_tmp_2912_2=0;_macro_tmp_2912_2<length(_macro_tmp_2912_1);_macro_tmp_2912_2+=OPERATOR_SIZE){if(_macro_tmp_2912_1[_macro_tmp_2912_2+OPERATOR_prio]!==prio)continue;if(_macro_tmp_2912_1[_macro_tmp_2912_2+OPERATOR_type1]!==TYPE_DYNAMIC)continue;if(_macro_tmp_2912_1[_macro_tmp_2912_2+OPERATOR_type2]!==type)continue;operator_list=_macro_tmp_2912_1;operator_off=_macro_tmp_2912_2;break;}};}}if(operator_list){list_off+=TOK_SIZE;;var _macro_tmp_2916_0=gen->GEN_func_tokens;var _macro_tmp_2916_1=length(_macro_tmp_2916_0);var _macro_tmp_2916_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2916_0,_macro_tmp_2916_1+_macro_tmp_2916_2);array_copy(_macro_tmp_2916_0,_macro_tmp_2916_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2916_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,off,operator_list[operator_off+OPERATOR_func_name],operator_list[operator_off+OPERATOR_compare],prio);type=operator_list[operator_off+OPERATOR_ret_type];break;}};}if(prev_type==TYPE_FLOAT&&type!=TYPE_FLOAT){if(type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,off,-1);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else if(type==TYPE_FLOAT&&prev_type!=TYPE_FLOAT){if(prev_type!=TYPE_INTEGER){return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});}list_off+=TOK_SIZE;;wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,prev_last_pos);wrap_float_op(gen,list_tokens,list_src,list_off,start_pos);list_off-=TOK_SIZE;;}else{var is_struct1=is_array(prev_type)&&prev_type[0]==EXT_TYPE_STRUCT;var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;if(is_struct1&&is_struct2){if(prev_type!=type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot compare incompatible structures"});}}else if((is_struct1&&(type==TYPE_INTEGER||type==TYPE_DYNAMIC))||(is_struct2&&(prev_type==TYPE_INTEGER||prev_type==TYPE_DYNAMIC))){list_off+=TOK_SIZE;;var _macro_tmp_2932_0=gen->GEN_func_tokens;var _macro_tmp_2932_1=length(_macro_tmp_2932_0);var _macro_tmp_2932_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_2932_0,_macro_tmp_2932_1+_macro_tmp_2932_2);array_copy(_macro_tmp_2932_0,_macro_tmp_2932_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_2932_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(is_struct1){wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,off,prev_type);}if(is_struct2){wrap_struct_conv(gen,list_tokens,list_src,list_off,off,-1,type);}}}type=TYPE_BOOLEAN;break;}};
while(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('?'))){if(type==TYPE_INTEGER||type==TYPE_FLOAT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use integer or float in condition"});}list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type1=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var type2=gen->GEN_ret_type;if(type1==TYPE_DYNAMIC){type1=type2;}if(type2==TYPE_DYNAMIC){type2=type1;}if(!is_same_type(type1,type2)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": both values in ternary operator must have the same type"});}type=type1;}list_off-=TOK_SIZE;;;
list_off+=TOK_SIZE;;
}

prio=next_prio;
prev_type=type;
}

gen->GEN_ret_type=prev_type;
return(list_off);
}

function@parse_primary_expression(gen,list_tokens,list_src,list_off)
{
var type=-1;
var off=(list_off);
var unary_off=off;

if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};

switch((list_tokens[list_off])){case '(':{list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};break;}case '[':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(']'))){type=create_array_type(TYPE_DYNAMIC);break;}else{list_off-=TOK_SIZE;;}var common_type=-1;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_type==-1){common_type=gen->GEN_ret_type;}else if(common_type!=gen->GEN_ret_type){common_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};type=create_array_type(common_type);break;}case '{':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}'))){type=create_hash_type(TYPE_DYNAMIC,TYPE_DYNAMIC);break;}if((list_tokens[list_off]===('='))){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;type=gen->GEN_ret_type;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}list_off-=TOK_SIZE;;var pos=(list_off);var ext_type=-1,level=0,first=true;while(((list_off+=TOK_SIZE)<length(list_tokens))){switch((list_tokens[list_off])){case '(':case '{':case '[':level++;first=false;continue;case ')':case '}':case ']':if(--level<0)break;if(level==0&&(list_tokens[list_off])=='}'){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('='))){ext_type=ET_BLOCK;break;}else{list_off-=TOK_SIZE;;}}first=false;continue;case '+':case '-':if(first){first=false;continue;}case '*':case '/':case '<':case '>':if(level==0&&ext_type==-1){ext_type=ET_FLOAT;}first=false;continue;case '?':if(level==0&&ext_type==-1){ext_type=ET_STRING;}first=false;continue;case ':':if(level==0&&ext_type==-1){ext_type=ET_HASH;}first=false;continue;case ',':if(level==0&&(ext_type==-1||ext_type==ET_FLOAT)){ext_type=ET_STRING;}first=false;continue;case ';':if(level==0){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('='))){ext_type=ET_BLOCK;break;}else{list_off-=TOK_SIZE;;}}first=false;continue;case '<=':case '>=':case '==':case '!=':if(level==0&&ext_type==-1){ext_type=ET_FLOAT;}first=false;continue;default:first=false;continue;}break;}if(ext_type==-1){ext_type=ET_STRING;}list_off=pos;;if(ext_type==ET_BLOCK){list_off=parse_block(gen,list_tokens,list_src,list_off,BT_EXPR);;type=gen->GEN_ret_type;break;}if(ext_type==ET_FLOAT){var float_op=-1;for(;;){list_off=parse_primary_expression(gen,list_tokens,list_src,list_off);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var fop=-1;var tok_type=(list_tokens[list_off]);if(tok_type>=' '){if(tok_type=='}'&&float_op!=-1)break;switch(tok_type){case '+','-':fop=FO_ADD_SUB;break;case '*','/':fop=FO_MUL_DIV;break;}}if(fop==-1||(float_op!=-1&&fop!=float_op)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected float operator"});}float_op=fop;}type=TYPE_FLOAT;break;}if(ext_type==ET_HASH){var common_base_type=-1;var common_index_type=-1;for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}')))break;list_off-=TOK_SIZE;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_index_type==-1){common_index_type=gen->GEN_ret_type;}else if(common_index_type!=gen->GEN_ret_type){common_index_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(common_base_type==-1){common_base_type=gen->GEN_ret_type;}else if(common_base_type!=gen->GEN_ret_type){common_base_type=TYPE_DYNAMIC;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}type=create_hash_type(common_base_type,common_index_type);break;}if(ext_type==ET_STRING){for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('}')))break;list_off-=TOK_SIZE;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};break;}type=TYPE_STRING;break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": internal error: invalid extended operator"});}case '@':{if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3047_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3047_0++;continue;case ')','}',']':if(!_macro_tmp_3047_0)break;_macro_tmp_3047_0--;continue;case ',',';':if(!_macro_tmp_3047_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}var name={func_name,"#",num_params};var func=hash_get(builtin_functions,name,null);if(func){list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,(func->FUNC_flags&FUNC_FLAG_STATIC)?i:i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;}else{list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=TYPE_DYNAMIC;}break;}case '+','-':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};switch((list_tokens[list_off])){case TOK_NUMBER,TOK_HEX_NUMBER:type=TYPE_INTEGER;break;case TOK_FLOAT_NUMBER:type=TYPE_FLOAT;break;}break;case TOK_NUMBER,TOK_HEX_NUMBER,TOK_CHAR:type=TYPE_INTEGER;break;case TOK_FLOAT_NUMBER:type=TYPE_FLOAT;break;case TOK_STRING:type=TYPE_STRING;break;case TOK_FUNC_REF:type=TYPE_DYNAMIC;break;case TOK_IDENT:{var var_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(var_name=="new"){var line=(list_tokens[list_off+TOK_line]);var _macro_tmp_3080_0=gen->GEN_func_tokens;var _macro_tmp_3080_1=length(_macro_tmp_3080_0);var _macro_tmp_3080_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3080_0,_macro_tmp_3080_1+_macro_tmp_3080_2);array_copy(_macro_tmp_3080_0,_macro_tmp_3080_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3080_2);gen->GEN_last_func_pos=list_off;;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var class_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,class_name);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",class_name});}if(class->CLASS_ext_type==EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use new on structs"});}if(class!==hash_get(gen->GEN_classes,class->CLASS_name,null)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't use new on class ",class_name," from other script"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var extend=false;if((list_tokens[list_off]===(':'))){extend=true;if(!class->CLASS_parent){return 0,error({script_line((list_tokens[list_off+TOK_line])),": class ",class_name," has no parent"});}}else{list_off-=TOK_SIZE;;}list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(extend){if(class->CLASS_virtual){var name={"vfunc__",class->CLASS_method_prefix,"_object_extend"};var src_off=length(list_src);array_set_length(list_src,src_off+length(name));array_copy(list_src,src_off,name,0,length(name));;var src_off2=length(list_src);array_set_length(list_src,src_off2+length("()"));array_copy(list_src,src_off2,"()",0,length("()"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(name);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,class->CLASS_parent,gen->GEN_ret_type);list_off+=TOK_SIZE;;var _macro_tmp_3107_0=gen->GEN_func_tokens;var _macro_tmp_3107_1=length(_macro_tmp_3107_0);var _macro_tmp_3107_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3107_0,_macro_tmp_3107_1+_macro_tmp_3107_2);array_copy(_macro_tmp_3107_0,_macro_tmp_3107_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3107_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off2+1;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("object_extend(,)"));array_copy(list_src,src_off,"object_extend(,)",0,length("object_extend(,)"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=13;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off+13;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,class->CLASS_parent,gen->GEN_ret_type);list_off+=TOK_SIZE;;var _macro_tmp_3120_0=gen->GEN_func_tokens;var _macro_tmp_3120_1=length(_macro_tmp_3120_0);var _macro_tmp_3120_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3120_0,_macro_tmp_3120_1+_macro_tmp_3120_2);array_copy(_macro_tmp_3120_0,_macro_tmp_3120_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3120_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off+14;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var size_const={class->CLASS_compat_name,"_SIZE"};var src_off2=length(list_src);array_set_length(list_src,src_off2+length(size_const));array_copy(list_src,src_off2,size_const,0,length(size_const));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=length(size_const);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off+15;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}}else{if(class->CLASS_virtual){var name={"vfunc__",class->CLASS_method_prefix,"_object_create"};var src_off=length(list_src);array_set_length(list_src,src_off+length(name));array_copy(list_src,src_off,name,0,length(name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(name);gen->GEN_func_tokens[]=line;;var src_off2=length(list_src);array_set_length(list_src,src_off2+length("()"));array_copy(list_src,src_off2,"()",0,length("()"));;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off2+1;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("object_create()"));array_copy(list_src,src_off,"object_create()",0,length("object_create()"));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=13;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='(';gen->GEN_func_tokens[]=src_off+13;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;var size_const={class->CLASS_compat_name,"_SIZE"};var src_off2=length(list_src);array_set_length(list_src,src_off2+length(size_const));array_copy(list_src,src_off2,size_const,0,length(size_const));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off2;gen->GEN_func_tokens[]=length(size_const);gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=')';gen->GEN_func_tokens[]=src_off+14;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;}}type=class;break;}else if(var_name=="super"){var line=(list_tokens[list_off+TOK_line]);var class=gen->GEN_cur_class;if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be used in class"});}if(gen->GEN_cur_func->FUNC_flags&FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be used in instance method"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3148_0=gen->GEN_func_tokens;var _macro_tmp_3148_1=length(_macro_tmp_3148_0);var _macro_tmp_3148_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3148_0,_macro_tmp_3148_1+_macro_tmp_3148_2);array_copy(_macro_tmp_3148_0,_macro_tmp_3148_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3148_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3161_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3161_0++;continue;case ')','}',']':if(!_macro_tmp_3161_0)break;_macro_tmp_3161_0--;continue;case ',',';':if(!_macro_tmp_3161_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};tokens_parse(gen->GEN_func_tokens,list_src,{"this->",gen->GEN_cur_class->CLASS_compat_name,"__super__",func_name,"__",num_params+1},line);var name={func_name,"#",num_params+1};var func=null;for(;;){class=class->CLASS_parent;if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": virtual function ",func_name," not found in super classes"});}func=hash_get(class->CLASS_functions,name,null);if(func&&(func->FUNC_flags&(FUNC_FLAG_VIRTUAL|FUNC_FLAG_OVERRIDE))==FUNC_FLAG_VIRTUAL){break;}}list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var _macro_tmp_3180_0=gen->GEN_func_tokens;var _macro_tmp_3180_1=length(_macro_tmp_3180_0);var _macro_tmp_3180_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3180_0,_macro_tmp_3180_1+_macro_tmp_3180_2);array_copy(_macro_tmp_3180_0,_macro_tmp_3180_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3180_2);gen->GEN_last_func_pos=list_off;;;if(num_params>0){var src_off=length(list_src);array_set_length(list_src,src_off+length("this,"));array_copy(list_src,src_off,"this,",0,length("this,"));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3183_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens[-params_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3183_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3183_1=length(func_tokens);var _macro_tmp_3183_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3183_1+_macro_tmp_3183_2);array_copy(func_tokens,func_pos+_macro_tmp_3183_2,func_tokens,func_pos,_macro_tmp_3183_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=4;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=',';func_tokens[func_pos++]=src_off+4;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;}else{var src_off=length(list_src);array_set_length(list_src,src_off+length("this"));array_copy(list_src,src_off,"this",0,length("this"));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3188_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens[-params_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3188_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3188_1=length(func_tokens);var _macro_tmp_3188_2=(1)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3188_1+_macro_tmp_3188_2);array_copy(func_tokens,func_pos+_macro_tmp_3188_2,func_tokens,func_pos,_macro_tmp_3188_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=4;func_tokens[func_pos++]=line;;}type=func->FUNC_return_type;break;}if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===(':'))){if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===(':'))){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off])==TOK_FUNC_REF){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var cls_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,cls_name);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",cls_name});}var _macro_tmp_3203_0=gen->GEN_func_tokens;var _macro_tmp_3203_1=length(_macro_tmp_3203_0);var _macro_tmp_3203_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3203_0,_macro_tmp_3203_1+_macro_tmp_3203_2);array_copy(_macro_tmp_3203_0,_macro_tmp_3203_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3203_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var func=hash_get(class->CLASS_functions,func_name,null);if(!func||((func->FUNC_flags&FUNC_FLAG_PRIVATE)&&class!==hash_get(gen->GEN_classes,class->CLASS_name,null))){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown method ",func_name," in ",cls_name});}var func_ref={class->CLASS_method_prefix,func_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(func_ref));array_copy(list_src,src_off,func_ref,0,length(func_ref));;list_tokens[list_off+TOK_off]=src_off;list_tokens[list_off+TOK_len]=length(func_ref);type=TYPE_DYNAMIC;break;}else if((list_tokens[list_off])!=TOK_IDENT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected identifier or function reference"});}var line=(list_tokens[list_off+TOK_line]);var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var class=find_class(gen,var_name);if(!class){var kind;if(var_name=="Array"){kind="array";}else if(var_name=="String"){kind="string";}else if(var_name=="Hash"){kind="hash";}if(kind){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3220_0=gen->GEN_func_tokens;var _macro_tmp_3220_1=length(_macro_tmp_3220_0);var _macro_tmp_3220_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3220_0,_macro_tmp_3220_1+_macro_tmp_3220_2);array_copy(_macro_tmp_3220_0,_macro_tmp_3220_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3220_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3234_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3234_0++;continue;case ')','}',']':if(!_macro_tmp_3234_0)break;_macro_tmp_3234_0--;continue;case ',',';':if(!_macro_tmp_3234_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={kind,"_",func_name,"#",num_params};var func=null;if(gen->GEN_static_functions){func=hash_get(gen->GEN_static_functions,name,null);}if(!func){if(gen->GEN_imported_static_functions){func=hash_get(gen->GEN_imported_static_functions,name,null);}if(!func){func=hash_get(builtin_static_functions,name,null);}}if(!func){return 0,error({script_line(line),": static function ",name," not found for ",kind," type"});}var full_name=func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name;var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(full_name);gen->GEN_func_tokens[]=line;;var generic_types=[-1,-1];list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;obtain_generic_types(param_type,gen->GEN_ret_type,generic_types);param_type=apply_generic_types(param_type,generic_types,(list_tokens[list_off+TOK_line]));append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=apply_generic_types(func->FUNC_return_type,generic_types,line);break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown class ",var_name});}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3259_0=gen->GEN_func_tokens;var _macro_tmp_3259_1=length(_macro_tmp_3259_0);var _macro_tmp_3259_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3259_0,_macro_tmp_3259_1+_macro_tmp_3259_2);array_copy(_macro_tmp_3259_0,_macro_tmp_3259_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3259_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===('('))){gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(func_name=="SIZE"){tokens_parse(gen->GEN_func_tokens,list_src,{class->CLASS_compat_name,"_SIZE"},line);type=TYPE_INTEGER;}else{var cls=class;var found=false;while(cls){var field=hash_get(cls->CLASS_fields,func_name,null);if(field&&(!field->FIELD_private||cls===hash_get(gen->GEN_classes,cls->CLASS_name,null))){tokens_parse(gen->GEN_func_tokens,list_src,{cls->CLASS_compat_name,"_",func_name},line);type=TYPE_INTEGER;found=true;break;}cls=cls->CLASS_parent;}if(!found){return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown field ",func_name," in ",get_class_name_with_kind(class)});}}break;}gen->GEN_last_func_pos=list_off;;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3278_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3278_0++;continue;case ')','}',']':if(!_macro_tmp_3278_0)break;_macro_tmp_3278_0--;continue;case ',',';':if(!_macro_tmp_3278_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={func_name,"#",num_params};var func=hash_get(class->CLASS_functions,name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_STATIC)||((func->FUNC_flags&FUNC_FLAG_PRIVATE)&&class!==hash_get(gen->GEN_classes,class->CLASS_name,null)))){func=null;}if(!func){return 0,error({script_line(line),": static function ",name," not found in ",get_class_name_with_kind(class)});}var full_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=length(full_name);gen->GEN_func_tokens[]=line;;list_off=params_off;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;break;}else if((list_tokens[list_off])==TOK_IDENT||(list_tokens[list_off])==TOK_FUNC_REF){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var alias=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var ia=gen->GEN_import_aliases?hash_get(gen->GEN_import_aliases,alias,null):null;if(ia){var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var const_type=hash_get(ia->IMPORT_ALIAS_consts,name,-1);if(const_type!=-1){type=const_type;break;}if(hash_contains(ia->IMPORT_ALIAS_locals,name)){type=TYPE_DYNAMIC;break;}if(hash_contains(ia->IMPORT_ALIAS_funcs,name)){if((list_tokens[list_off])==TOK_FUNC_REF){type=TYPE_DYNAMIC;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='('){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('('),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}type=TYPE_DYNAMIC;break;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": constant, local variable or function not found in script with import alias '",alias,"'"});}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}type=hash_get(gen->GEN_consts,var_name,-1);if(type==-1){switch(length(var_name)){case 4:if(var_name=="null"){type=TYPE_DYNAMIC;break;}if(var_name=="true"){type=TYPE_BOOLEAN;break;}break;case 5:if(var_name=="false"){type=TYPE_BOOLEAN;break;}break;}}if(type==-1){type=hash_get(gen->GEN_vars,var_name,-1);}if(type==-1){var class=gen->GEN_cur_class;while(class){var field=hash_get(class->CLASS_fields,var_name,null);if(field&&(!field->FIELD_private||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){if((gen->GEN_cur_func->FUNC_flags&(FUNC_FLAG_STATIC|FUNC_FLAG_CONSTRUCTOR))==FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't reference instance fields"});}var _macro_tmp_3332_0=gen->GEN_func_tokens;var _macro_tmp_3332_1=length(_macro_tmp_3332_0);var _macro_tmp_3332_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3332_0,_macro_tmp_3332_1+_macro_tmp_3332_2);array_copy(_macro_tmp_3332_0,_macro_tmp_3332_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3332_2);gen->GEN_last_func_pos=list_off;;;var line=(list_tokens[list_off+TOK_line]);var src_off=length(list_src);array_set_length(list_src,src_off+length({"this->",field->FIELD_compat_name}));array_copy(list_src,src_off,{"this->",field->FIELD_compat_name},0,length({"this->",field->FIELD_compat_name}));;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=4;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]='->';gen->GEN_func_tokens[]=src_off+4;gen->GEN_func_tokens[]=2;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off+6;gen->GEN_func_tokens[]=length(field->FIELD_compat_name);gen->GEN_func_tokens[]=line;;gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);((list_off+=TOK_SIZE)<length(list_tokens));gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field->FIELD_type;break;}class=class->CLASS_parent;}}if(type==-1&&gen->GEN_locals){var local=hash_get(gen->GEN_locals,var_name,null);if(local){type=local->LOCAL_type;}}if(type==-1&&gen->GEN_imported_locals){var local=hash_get(gen->GEN_imported_locals,var_name,null);if(local){type=local->LOCAL_type;}}if(type==-1){if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off]===('('))){list_off-=TOK_SIZE;;var line=(list_tokens[list_off+TOK_line]);var func_name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3355_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3355_0++;continue;case ')','}',']':if(!_macro_tmp_3355_0)break;_macro_tmp_3355_0--;continue;case ',',';':if(!_macro_tmp_3355_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};var name={func_name,"#",num_params};if(gen->GEN_cur_class){var class=gen->GEN_cur_class;var func,orig_class=class,struct_type;var instance_name={func_name,"#",num_params+1};while(class){func=hash_get(class->CLASS_functions,instance_name,null);if(func){if(!(func->FUNC_flags&FUNC_FLAG_STATIC)&&!(func->FUNC_flags&FUNC_FLAG_OVERRIDE)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){if((gen->GEN_cur_func->FUNC_flags&(FUNC_FLAG_STATIC|FUNC_FLAG_CONSTRUCTOR))==FUNC_FLAG_STATIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't reference instance methods"});}break;}func=null;}class=class->CLASS_parent;}if(!func){class=orig_class;while(class){func=hash_get(class->CLASS_functions,name,null);if(func){if((func->FUNC_flags&FUNC_FLAG_STATIC)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){break;}func=null;}class=class->CLASS_parent;}if(!func){func=find_function(gen,name);if(!func&&num_params==1){struct_type=find_class(gen,func_name);if(!struct_type||struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){struct_type=null;}}}}list_off=params_off;;if(func){for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,(func->FUNC_flags&FUNC_FLAG_STATIC)?i:i+1);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}}else if(struct_type){list_off-=TOK_SIZE;;var _macro_tmp_3373_0=gen->GEN_func_tokens;var _macro_tmp_3373_1=length(_macro_tmp_3373_0);var _macro_tmp_3373_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3373_0,_macro_tmp_3373_1+_macro_tmp_3373_2);array_copy(_macro_tmp_3373_0,_macro_tmp_3373_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3373_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,params_off,TYPE_INTEGER,gen->GEN_ret_type);}else{var ctx=gen->GEN_custom_ctx;var func_call_list=null,func_call_idx,func_types=null,call_start_pos;if(ctx){var func_list=hash_get(ctx->CTX_function_calls,func_name,ctx->CTX_function_calls_any);if(func_list){for(var i=0;i<length(func_list);i+=FUNC_CALL_SIZE){func_types=func_list[i+FUNC_CALL_get_types_func](func_list[i+FUNC_CALL_data],func_name,num_params,(list_tokens[list_off+TOK_line]));if(func_types){if(length(func_types)!=num_params+1){return 0,error({"improper number of function types returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}list_off+=TOK_SIZE;;var _macro_tmp_3385_0=gen->GEN_func_tokens;var _macro_tmp_3385_1=length(_macro_tmp_3385_0);var _macro_tmp_3385_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3385_0,_macro_tmp_3385_1+_macro_tmp_3385_2);array_copy(_macro_tmp_3385_0,_macro_tmp_3385_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3385_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;call_start_pos=length(gen->GEN_func_tokens);func_call_list=func_list;func_call_idx=i;break;}}}}for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(func_types){if(func_types[i+1]==TYPE_DYNAMIC){func_types[i+1]=gen->GEN_ret_type;}else{append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,func_types[i+1],gen->GEN_ret_type);}}}if(func_types){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3398_0=gen->GEN_func_tokens;var _macro_tmp_3398_1=length(_macro_tmp_3398_0);var _macro_tmp_3398_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3398_0,_macro_tmp_3398_1+_macro_tmp_3398_2);array_copy(_macro_tmp_3398_0,_macro_tmp_3398_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3398_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var end_pos=func_call_list[func_call_idx+FUNC_CALL_adjust_call_func](func_call_list[func_call_idx+FUNC_CALL_data],func_name,func_types,gen->GEN_func_tokens,list_src,call_start_pos-TOK_SIZE*2,length(gen->GEN_func_tokens));if(end_pos!=length(gen->GEN_func_tokens)){return 0,error({"invalid end position returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}type=func_types[0];}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3406_0=gen->GEN_func_tokens;var _macro_tmp_3406_1=length(_macro_tmp_3406_0);var _macro_tmp_3406_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3406_0,_macro_tmp_3406_1+_macro_tmp_3406_2);array_copy(_macro_tmp_3406_0,_macro_tmp_3406_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3406_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;if(func){if(class){var full_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length(full_name));array_copy(list_src,src_off,full_name,0,length(full_name));;var search_off=list_tokens[params_off-TOK_SIZE+TOK_off];var func_tokens=gen->GEN_func_tokens;for(var idx=length(func_tokens)-TOK_SIZE;;idx-=TOK_SIZE){if(func_tokens[idx+TOK_off]==search_off){func_tokens[idx+TOK_type]=TOK_IDENT;func_tokens[idx+TOK_off]=src_off;func_tokens[idx+TOK_len]=length(full_name);break;}}}if(!(func->FUNC_flags&FUNC_FLAG_STATIC)){if(num_params>0){var src2_off=length(list_src);array_set_length(list_src,src2_off+length("this,"));array_copy(list_src,src2_off,"this,",0,length("this,"));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3411_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens2[-params_off+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_3411_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3411_1=length(func_tokens2);var _macro_tmp_3411_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3411_1+_macro_tmp_3411_2);array_copy(func_tokens2,func_pos+_macro_tmp_3411_2,func_tokens2,func_pos,_macro_tmp_3411_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src2_off;func_tokens2[func_pos++]=4;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]=',';func_tokens2[func_pos++]=src2_off+4;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;}else{var src2_off=length(list_src);array_set_length(list_src,src2_off+length("this"));array_copy(list_src,src2_off,"this",0,length("this"));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3416_0=params_off>=0?list_tokens[params_off+TOK_off]:func_tokens2[-params_off+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_3416_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3416_1=length(func_tokens2);var _macro_tmp_3416_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3416_1+_macro_tmp_3416_2);array_copy(func_tokens2,func_pos+_macro_tmp_3416_2,func_tokens2,func_pos,_macro_tmp_3416_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src2_off;func_tokens2[func_pos++]=4;func_tokens2[func_pos++]=line;;}}type=func->FUNC_return_type;}else if(struct_type){var src_off=length(list_src);array_set_length(list_src,src_off+length("add32("));array_copy(list_src,src_off,"add32(",0,length("add32("));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3420_0=params_off-2*TOK_SIZE>=0?list_tokens[params_off-2*TOK_SIZE+TOK_off]:func_tokens2[-params_off-2*TOK_SIZE+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_3420_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3420_1=length(func_tokens2);var _macro_tmp_3420_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3420_1+_macro_tmp_3420_2);array_copy(func_tokens2,func_pos+_macro_tmp_3420_2,func_tokens2,func_pos,_macro_tmp_3420_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src_off;func_tokens2[func_pos++]=5;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]='(';func_tokens2[func_pos++]=src_off+5;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{"*",struct_type->CLASS_compat_name,"_SIZE, ",struct_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=struct_type;}}else{var func=find_function(gen,name),struct_type;if(!func&&num_params==1){struct_type=find_class(gen,func_name);if(!struct_type||struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){struct_type=null;}}list_off=params_off;;if(func){for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};type=func->FUNC_return_type;}else if(struct_type){list_off-=TOK_SIZE;;var _macro_tmp_3436_0=gen->GEN_func_tokens;var _macro_tmp_3436_1=length(_macro_tmp_3436_0);var _macro_tmp_3436_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3436_0,_macro_tmp_3436_1+_macro_tmp_3436_2);array_copy(_macro_tmp_3436_0,_macro_tmp_3436_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3436_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,params_off,TYPE_INTEGER,gen->GEN_ret_type);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3448_0=gen->GEN_func_tokens;var _macro_tmp_3448_1=length(_macro_tmp_3448_0);var _macro_tmp_3448_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3448_0,_macro_tmp_3448_1+_macro_tmp_3448_2);array_copy(_macro_tmp_3448_0,_macro_tmp_3448_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3448_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length("add32("));array_copy(list_src,src_off,"add32(",0,length("add32("));;var func_tokens2=gen->GEN_func_tokens;var func_pos=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3452_0=params_off-2*TOK_SIZE>=0?list_tokens[params_off-2*TOK_SIZE+TOK_off]:func_tokens2[-params_off-2*TOK_SIZE+TOK_off];while(func_tokens2[func_pos+TOK_off]!==_macro_tmp_3452_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3452_1=length(func_tokens2);var _macro_tmp_3452_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3452_1+_macro_tmp_3452_2);array_copy(func_tokens2,func_pos+_macro_tmp_3452_2,func_tokens2,func_pos,_macro_tmp_3452_1-func_pos);;;func_tokens2[func_pos++]=TOK_IDENT;func_tokens2[func_pos++]=src_off;func_tokens2[func_pos++]=5;func_tokens2[func_pos++]=line;;func_tokens2[func_pos++]='(';func_tokens2[func_pos++]=src_off+5;func_tokens2[func_pos++]=1;func_tokens2[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{"*",struct_type->CLASS_compat_name,"_SIZE, ",struct_type->CLASS_compat_name,"_SIZE)"},(list_tokens[list_off+TOK_line]));type=struct_type;}else{var ctx=gen->GEN_custom_ctx;var func_call_list=null,func_call_idx,func_types=null,call_start_pos;if(ctx){var func_list=hash_get(ctx->CTX_function_calls,func_name,ctx->CTX_function_calls_any);if(func_list){for(var i=0;i<length(func_list);i+=FUNC_CALL_SIZE){func_types=func_list[i+FUNC_CALL_get_types_func](func_list[i+FUNC_CALL_data],func_name,num_params,(list_tokens[list_off+TOK_line]));if(func_types){if(length(func_types)!=num_params+1){return 0,error({"improper number of function types returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}list_off+=TOK_SIZE;;var _macro_tmp_3460_0=gen->GEN_func_tokens;var _macro_tmp_3460_1=length(_macro_tmp_3460_0);var _macro_tmp_3460_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3460_0,_macro_tmp_3460_1+_macro_tmp_3460_2);array_copy(_macro_tmp_3460_0,_macro_tmp_3460_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3460_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;call_start_pos=length(gen->GEN_func_tokens);func_call_list=func_list;func_call_idx=i;break;}}}}for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(func_types){if(func_types[i+1]==TYPE_DYNAMIC){func_types[i+1]=gen->GEN_ret_type;}else{append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,func_types[i+1],gen->GEN_ret_type);}}}if(func_types){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3473_0=gen->GEN_func_tokens;var _macro_tmp_3473_1=length(_macro_tmp_3473_0);var _macro_tmp_3473_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3473_0,_macro_tmp_3473_1+_macro_tmp_3473_2);array_copy(_macro_tmp_3473_0,_macro_tmp_3473_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3473_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var end_pos=func_call_list[func_call_idx+FUNC_CALL_adjust_call_func](func_call_list[func_call_idx+FUNC_CALL_data],func_name,func_types,gen->GEN_func_tokens,list_src,call_start_pos-TOK_SIZE*2,length(gen->GEN_func_tokens));if(end_pos!=length(gen->GEN_func_tokens)){return 0,error({"invalid end position returned by other token processor at ",script_line((list_tokens[list_off+TOK_line]))});}type=func_types[0];}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}}}else{list_off-=TOK_SIZE;;}}}if(type==-1){type=TYPE_DYNAMIC;}break;}};

if(type==-1){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": expected value"});
}

while(((list_off+=TOK_SIZE)<length(list_tokens))){
switch((list_tokens[list_off])){case '.':{if(fixide&&gen->GEN_fixide_cursor>=0){var ident_prefix=null;if(((list_off+=TOK_SIZE)<length(list_tokens))){if((list_tokens[list_off])==TOK_IDENT){var token_off=(list_tokens[list_off+TOK_off]);var token_len=(list_tokens[list_off+TOK_len]);if(gen->GEN_fixide_cursor>=token_off&&gen->GEN_fixide_cursor<=token_off+token_len){ident_prefix=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);array_set_length(ident_prefix,gen->GEN_fixide_cursor-token_off);export_type(gen,type,ident_prefix);}}list_off-=TOK_SIZE;;}if(!ident_prefix){if((list_tokens[list_off+TOK_off])+1==gen->GEN_fixide_cursor){export_type(gen,type,null);}}};if(type==TYPE_STRING||(is_array(type)&&(type[0]==EXT_TYPE_ARRAY||type[0]==EXT_TYPE_HASH))){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){var kind,generic_types;if(is_array(type)&&type[0]==EXT_TYPE_ARRAY){kind="array";generic_types=[-1,type->ARRAY_base_type];}else if(type==TYPE_STRING){kind="string";generic_types=[-1,-1];}else if(is_array(type)&&type[0]==EXT_TYPE_HASH){kind="hash";generic_types=[type->HASH_index_type,type->HASH_base_type];}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3502_0=gen->GEN_func_tokens;var _macro_tmp_3502_1=length(_macro_tmp_3502_0);var _macro_tmp_3502_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3502_0,_macro_tmp_3502_1+_macro_tmp_3502_2);array_copy(_macro_tmp_3502_0,_macro_tmp_3502_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3502_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};gen->GEN_last_func_pos=list_off;;;var num_params=1;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length(","));array_copy(list_src,src_off,",",0,length(","));;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;for(;;){num_params++;var _macro_tmp_3515_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3515_0++;continue;case ')','}',']':if(!_macro_tmp_3515_0)break;_macro_tmp_3515_0--;continue;case ',',';':if(!_macro_tmp_3515_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};name={kind,"_",name,"#",num_params};var func=null;if(gen->GEN_instance_functions){func=hash_get(gen->GEN_instance_functions,name,null);}if(!func){if(gen->GEN_imported_instance_functions){func=hash_get(gen->GEN_imported_instance_functions,name,null);}if(!func){func=hash_get(builtin_instance_functions,name,null);}}if(!func){return 0,error({script_line(line),": function ",name," not found for ",kind," type"});}var full_name=func->FUNC_alt_name?func->FUNC_alt_name:func->FUNC_name;var src_off=length(list_src);array_set_length(list_src,src_off+length({full_name,"("}));array_copy(list_src,src_off,{full_name,"("},0,length({full_name,"("}));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3524_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3524_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3524_1=length(func_tokens);var _macro_tmp_3524_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3524_1+_macro_tmp_3524_2);array_copy(func_tokens,func_pos+_macro_tmp_3524_2,func_tokens,func_pos,_macro_tmp_3524_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(full_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(full_name);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var save_off=length(gen->GEN_func_tokens)-TOK_SIZE;var save_val=gen->GEN_func_tokens[save_off+TOK_off];gen->GEN_func_tokens[save_off+TOK_off]=list_tokens[params_off+TOK_off];list_off=params_off;;for(var i=1;i<num_params;i++){if(i>1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;param_type=apply_generic_types(param_type,generic_types,(list_tokens[list_off+TOK_line]));append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};gen->GEN_func_tokens[save_off+TOK_off]=save_val;type=apply_generic_types(func->FUNC_return_type,generic_types,line);if(name=="hash_entry#2"){if(gen->GEN_hash_entry_value_type!=-1){return 0,error({script_line(line),": both return values must be obtained for entry function"});}gen->GEN_hash_entry_value_type=apply_generic_types(TYPE_VALUE,generic_types,line);}continue;}else{list_off-=TOK_SIZE;;}if(name=="length"){list_off-=TOK_SIZE;;var _macro_tmp_3541_0=gen->GEN_func_tokens;var _macro_tmp_3541_1=length(_macro_tmp_3541_0);var _macro_tmp_3541_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3541_0,_macro_tmp_3541_1+_macro_tmp_3541_2);array_copy(_macro_tmp_3541_0,_macro_tmp_3541_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3541_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("length("));array_copy(list_src,src_off,"length(",0,length("length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3549_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3549_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3549_1=length(func_tokens);var _macro_tmp_3549_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3549_1+_macro_tmp_3549_2);array_copy(func_tokens,func_pos+_macro_tmp_3549_2,func_tokens,func_pos,_macro_tmp_3549_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=TYPE_INTEGER;continue;}}if(is_array(type)){if(type[0]==EXT_TYPE_STRUCT_ARRAY){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(name=="first"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_3560_0=gen->GEN_func_tokens;var _macro_tmp_3560_1=length(_macro_tmp_3560_0);var _macro_tmp_3560_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3560_0,_macro_tmp_3560_1+_macro_tmp_3560_2);array_copy(_macro_tmp_3560_0,_macro_tmp_3560_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3560_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3567_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3567_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3567_1=length(func_tokens);var _macro_tmp_3567_2=(0)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3567_1+_macro_tmp_3567_2);array_copy(func_tokens,func_pos+_macro_tmp_3567_2,func_tokens,func_pos,_macro_tmp_3567_1-func_pos);;;array_set_length(func_tokens,func_pos);tokens_parse(gen->GEN_func_tokens,list_src,{base_type->CLASS_compat_name,"_SIZE"},line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=base_type;continue;}if(name=="last"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_3572_0=gen->GEN_func_tokens;var _macro_tmp_3572_1=length(_macro_tmp_3572_0);var _macro_tmp_3572_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3572_0,_macro_tmp_3572_1+_macro_tmp_3572_2);array_copy(_macro_tmp_3572_0,_macro_tmp_3572_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3572_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("length("));array_copy(list_src,src_off,"length(",0,length("length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3580_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3580_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3580_1=length(func_tokens);var _macro_tmp_3580_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3580_1+_macro_tmp_3580_2);array_copy(func_tokens,func_pos+_macro_tmp_3580_2,func_tokens,func_pos,_macro_tmp_3580_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")",line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=base_type;continue;}if(name=="length"){var base_type=type->ARRAY_base_type;if(!is_array(base_type)||base_type[0]!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be concrete struct array"});}list_off-=TOK_SIZE;;var _macro_tmp_3587_0=gen->GEN_func_tokens;var _macro_tmp_3587_1=length(_macro_tmp_3587_0);var _macro_tmp_3587_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3587_0,_macro_tmp_3587_1+_macro_tmp_3587_2);array_copy(_macro_tmp_3587_0,_macro_tmp_3587_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3587_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("(length("));array_copy(list_src,src_off,"(length(",0,length("(length("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3595_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3595_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3595_1=length(func_tokens);var _macro_tmp_3595_2=(3)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3595_1+_macro_tmp_3595_2);array_copy(func_tokens,func_pos+_macro_tmp_3595_2,func_tokens,func_pos,_macro_tmp_3595_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=6;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+7;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{")/",base_type->CLASS_compat_name,"_SIZE",")"},line);gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);type=TYPE_INTEGER;continue;}}}var class=get_type_class_or_struct(type);if(!class){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be class or struct type"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var line=(list_tokens[list_off+TOK_line]);var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(class->CLASS_ext_type==EXT_TYPE_STRUCT&&name=="index"){list_off-=TOK_SIZE;;var _macro_tmp_3607_0=gen->GEN_func_tokens;var _macro_tmp_3607_1=length(_macro_tmp_3607_0);var _macro_tmp_3607_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3607_0,_macro_tmp_3607_1+_macro_tmp_3607_2);array_copy(_macro_tmp_3607_0,_macro_tmp_3607_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3607_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var src_off=length(list_src);array_set_length(list_src,src_off+length("(sub32("));array_copy(list_src,src_off,"(sub32(",0,length("(sub32("));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3615_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3615_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3615_1=length(func_tokens);var _macro_tmp_3615_2=(3)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3615_1+_macro_tmp_3615_2);array_copy(func_tokens,func_pos+_macro_tmp_3615_2,func_tokens,func_pos,_macro_tmp_3615_1-func_pos);;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=5;func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+6;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,{", ",class->CLASS_compat_name,"_SIZE)/",class->CLASS_compat_name,"_SIZE)"},line);type=TYPE_INTEGER;continue;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3625_0=gen->GEN_func_tokens;var _macro_tmp_3625_1=length(_macro_tmp_3625_0);var _macro_tmp_3625_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3625_0,_macro_tmp_3625_1+_macro_tmp_3625_2);array_copy(_macro_tmp_3625_0,_macro_tmp_3625_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3625_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};gen->GEN_last_func_pos=list_off;;;var num_params=1;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length(","));array_copy(list_src,src_off,",",0,length(","));;gen->GEN_func_tokens[]=',';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=1;gen->GEN_func_tokens[]=line;;for(;;){num_params++;var _macro_tmp_3638_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3638_0++;continue;case ')','}',']':if(!_macro_tmp_3638_0)break;_macro_tmp_3638_0--;continue;case ',',';':if(!_macro_tmp_3638_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};name={name,"#",num_params};var func,orig_class=class;while(class){func=hash_get(class->CLASS_functions,name,null);if(func){if(!(func->FUNC_flags&FUNC_FLAG_STATIC)&&!(func->FUNC_flags&FUNC_FLAG_OVERRIDE)&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||class===hash_get(gen->GEN_classes,class->CLASS_name,null))){break;}func=null;}class=class->CLASS_parent;}if(!func){return 0,error({script_line(line),": function ",name," not found in ",get_class_name_with_kind(orig_class)});}var real_name={class->CLASS_method_prefix,func->FUNC_name};var src_off=length(list_src);array_set_length(list_src,src_off+length({real_name,"("}));array_copy(list_src,src_off,{real_name,"("},0,length({real_name,"("}));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3647_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens[-adj_off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3647_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3647_1=length(func_tokens);var _macro_tmp_3647_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3647_1+_macro_tmp_3647_2);array_copy(func_tokens,func_pos+_macro_tmp_3647_2,func_tokens,func_pos,_macro_tmp_3647_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=length(real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+length(real_name);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var save_off=length(gen->GEN_func_tokens)-TOK_SIZE;var save_val=gen->GEN_func_tokens[save_off+TOK_off];gen->GEN_func_tokens[save_off+TOK_off]=list_tokens[params_off+TOK_off];list_off=params_off;;for(var i=1;i<num_params;i++){if(i>1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};gen->GEN_func_tokens[save_off+TOK_off]=save_val;type=func->FUNC_return_type;}else{if(class->CLASS_ext_type!=EXT_TYPE_CLASS){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be class type"});}var field,orig_class=class;while(class){field=hash_get(class->CLASS_fields,name,null);if(field){if(!field->FIELD_private||class===hash_get(gen->GEN_classes,class->CLASS_name,null)){break;}field=null;}class=class->CLASS_parent;}if(!field){list_off-=TOK_SIZE;;return 0,error({script_line(line),": can't find field '",name,"' in class ",orig_class->CLASS_name});}list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3665_0=gen->GEN_func_tokens;var _macro_tmp_3665_1=length(_macro_tmp_3665_0);var _macro_tmp_3665_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3665_0,_macro_tmp_3665_1+_macro_tmp_3665_2);array_copy(_macro_tmp_3665_0,_macro_tmp_3665_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3665_2);gen->GEN_last_func_pos=list_off;;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"->",field->FIELD_compat_name}));array_copy(list_src,src_off,{"->",field->FIELD_compat_name},0,length({"->",field->FIELD_compat_name}));;gen->GEN_func_tokens[]='->';gen->GEN_func_tokens[]=src_off;gen->GEN_func_tokens[]=2;gen->GEN_func_tokens[]=line;;gen->GEN_func_tokens[]=TOK_IDENT;gen->GEN_func_tokens[]=src_off+2;gen->GEN_func_tokens[]=length(field->FIELD_compat_name);gen->GEN_func_tokens[]=line;;list_off+=TOK_SIZE;;gen->GEN_func_offsets_replacements{(list_off)}=-(length(gen->GEN_func_tokens)+TOK_SIZE);list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field->FIELD_type;}continue;}case '[':{((list_off+=TOK_SIZE)<length(list_tokens));if((list_tokens[list_off]===(']'))){list_off-=TOK_SIZE;;break;}list_off-=TOK_SIZE;;var base_type=TYPE_DYNAMIC;var index_type=TYPE_INTEGER;var array=get_type_array_or_hash(type);var is_hash=false;var unsupported=false;if(array){if(array[0]==EXT_TYPE_HASH){base_type=array->HASH_base_type;index_type=array->HASH_index_type;is_hash=true;}else{base_type=array->ARRAY_base_type;}}else if(type==TYPE_STRING){base_type=TYPE_INTEGER;}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){base_type=TYPE_DYNAMIC;}else if(type!=TYPE_DYNAMIC){unsupported=true;}var off1=(list_tokens[list_off+TOK_off]);var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;var struct_type=-1;if(is_array(gen->GEN_ret_type)&&gen->GEN_ret_type[0]==EXT_TYPE_STRUCT){struct_type=gen->GEN_ret_type;if(type!=TYPE_DYNAMIC){if(is_array(type)&&type[0]==EXT_TYPE_ARRAY){if(type->ARRAY_base_type!=TYPE_DYNAMIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in type ",get_type_name(type)});}}else if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){if(type->ARRAY_base_type!=TYPE_DYNAMIC&&type->ARRAY_base_type!==struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in an incompatible struct array"});}}else{if(unsupported){var orig_pos=(list_off);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===(']'))){if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('.'))){var dot_pos=(list_off);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off])==TOK_IDENT){var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(((list_off+=TOK_SIZE)<length(list_tokens))&&(list_tokens[list_off]===('('))){var line=(list_tokens[list_off+TOK_line]);var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3704_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3704_0++;continue;case ')','}',']':if(!_macro_tmp_3704_0)break;_macro_tmp_3704_0--;continue;case ',',';':if(!_macro_tmp_3704_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off=params_off;;var func_name={name,"#",num_params+2};var func=null;var struct=struct_type;for(;;){func=hash_get(struct->CLASS_functions,func_name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||struct===hash_get(gen->GEN_classes,struct->CLASS_name,null))){var(param_name,param_type)=hash_entry(func->FUNC_params,1);if(param_type!==type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," in struct ",get_type_name(struct_type)," has incompatible first parameter"});}break;}struct=struct->CLASS_parent;if(!struct){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," not found in struct ",get_type_name(struct_type)});}}list_off=dot_pos;;list_off+=TOK_SIZE;;var _macro_tmp_3717_0=gen->GEN_func_tokens;var _macro_tmp_3717_1=length(_macro_tmp_3717_0);var _macro_tmp_3717_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3717_0,_macro_tmp_3717_1+_macro_tmp_3717_2);array_copy(_macro_tmp_3717_0,_macro_tmp_3717_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3717_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var func_real_name={struct->CLASS_method_prefix,name};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(",func_real_name}));array_copy(list_src,src_off,{"(",func_real_name},0,length({"(",func_real_name}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3721_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3721_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3721_1=length(func_tokens);var _macro_tmp_3721_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3721_1+_macro_tmp_3721_2);array_copy(func_tokens,func_pos+_macro_tmp_3721_2,func_tokens,func_pos,_macro_tmp_3721_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=length(func_real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens=gen->GEN_func_tokens;var search_off1=list_tokens[expr_start_pos+TOK_off];var search_off2=list_tokens[dot_pos+TOK_off];var expr_pos1=-1;var expr_pos2=-1;for(var i=length(func_tokens)-TOK_SIZE;i>=0;i-=TOK_SIZE){if(func_tokens[i+TOK_off]==search_off1){expr_pos1=i;break;}if(func_tokens[i+TOK_off]==search_off2){expr_pos2=i;}}var expr_tokens=array_extract(func_tokens,expr_pos1+TOK_SIZE,expr_pos2-expr_pos1-2*TOK_SIZE);array_remove(func_tokens,expr_pos1,expr_pos2-expr_pos1);tokens_parse(expr_tokens,list_src,",",line);array_insert_array(func_tokens,func_pos,expr_tokens);var dot_off=length(func_tokens)-TOK_SIZE;if(num_params>0){var src_off2=length(list_src);array_set_length(list_src,src_off2+length(","));array_copy(list_src,src_off2,",",0,length(","));;func_tokens[dot_off++]=',';func_tokens[dot_off++]=src_off2;func_tokens[dot_off++]=1;func_tokens[dot_off++]=line;;}else{array_set_length(func_tokens,length(func_tokens)-TOK_SIZE);}list_off=params_off;;gen->GEN_last_func_pos=list_off;;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+2);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3740_0=gen->GEN_func_tokens;var _macro_tmp_3740_1=length(_macro_tmp_3740_0);var _macro_tmp_3740_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3740_0,_macro_tmp_3740_1+_macro_tmp_3740_2);array_copy(_macro_tmp_3740_0,_macro_tmp_3740_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3740_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;array_remove(func_tokens,dot_off,TOK_SIZE);type=func->FUNC_return_type;continue;}}}}list_off=orig_pos;;}return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct field in type ",get_type_name(type)});}}}else{if(is_array(type)&&type[0]==EXT_TYPE_STRUCT_ARRAY){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't access struct array directly"});}append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,index_type,gen->GEN_ret_type);}if(unsupported){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be array or hash table"});}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==']'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(']'),"'"});};if(struct_type!=-1){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('='))){var explicit_struct_name=false;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off])==TOK_IDENT){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('{'))){explicit_struct_name=true;list_off-=TOK_SIZE;;var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);var explicit_struct_type=find_class(gen,name);if(!explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't find struct ",name});}if(explicit_struct_type->CLASS_ext_type!=EXT_TYPE_STRUCT){return 0,error({script_line((list_tokens[list_off+TOK_line])),": must be struct"});}if(struct_type!=TYPE_DYNAMIC&&struct_type!==explicit_struct_type){return 0,error({script_line((list_tokens[list_off+TOK_line])),": explicit ",get_class_name_with_kind(explicit_struct_type)," is different from ",get_class_name_with_kind(struct_type)});}struct_type=explicit_struct_type;}else{list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;}}else{list_off-=TOK_SIZE;;}if(struct_type==TYPE_DYNAMIC){return 0,error({script_line((list_tokens[list_off+TOK_line])),": struct type must be specified"});}var array_var={"__classes_tmp_",tmp_cnt++};var index_var={"__classes_tmp_",tmp_cnt++};var line=(list_tokens[list_off+TOK_line]);if(explicit_struct_name)list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;var _macro_tmp_3771_0=gen->GEN_func_tokens;var _macro_tmp_3771_1=length(_macro_tmp_3771_0);var _macro_tmp_3771_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3771_0,_macro_tmp_3771_1+_macro_tmp_3771_2);array_copy(_macro_tmp_3771_0,_macro_tmp_3771_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3771_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;if(explicit_struct_name)list_off+=TOK_SIZE;;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3775_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3775_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3775_1=length(func_tokens);var _macro_tmp_3775_2=(4)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3775_1+_macro_tmp_3775_2);array_copy(func_tokens,func_pos+_macro_tmp_3775_2,func_tokens,func_pos,_macro_tmp_3775_1-func_pos);;;var src_off=length(list_src);array_set_length(list_src,src_off+length({"{var",array_var,"="}));array_copy(list_src,src_off,{"{var",array_var,"="},0,length({"{var",array_var,"="}));;func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off+0;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=KW_VAR;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=3;func_tokens[func_pos++]=line;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+4;func_tokens[func_pos++]=length(array_var);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='=';func_tokens[func_pos++]=src_off+4+length(array_var);func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3782_0=expr_start_pos>=0?list_tokens[expr_start_pos+TOK_off]:func_tokens2[-expr_start_pos+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_3782_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_3782_1=length(func_tokens2);var _macro_tmp_3782_2=(5)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3782_1+_macro_tmp_3782_2);array_copy(func_tokens2,func_pos2+_macro_tmp_3782_2,func_tokens2,func_pos2,_macro_tmp_3782_1-func_pos2);;;func_pos2-=TOK_SIZE;array_remove(func_tokens2,func_pos2,TOK_SIZE);var src_off2=length(list_src);array_set_length(list_src,src_off2+length({",",index_var,"=sub32("}));array_copy(list_src,src_off2,{",",index_var,"=sub32("},0,length({",",index_var,"=sub32("}));;func_tokens2[func_pos2++]=',';func_tokens2[func_pos2++]=src_off2+0;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off2+1;func_tokens2[func_pos2++]=length(index_var);func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='=';func_tokens2[func_pos2++]=src_off2+1+length(index_var);func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off2+1+length(index_var)+1;func_tokens2[func_pos2++]=5;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='(';func_tokens2[func_pos2++]=src_off2+1+length(index_var)+6;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='{'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('{'),"'"});};list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;tokens_parse(gen->GEN_func_tokens,list_src,{",",struct_type->CLASS_compat_name,"_SIZE);"},(list_tokens[list_off+TOK_line]));var fields={};var value_pos=length(gen->GEN_func_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('.'))){list_off-=TOK_SIZE;;for(;;){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(hash_contains(fields,name)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": duplicate field"});}var(field_type,offset)=get_struct_field(gen,struct_type,name);if(!is_int(offset)){return 0,offset;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==':'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(':'),"'"});};gen->GEN_last_func_pos=list_off;;;var field_value_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,field_value_pos,field_type,gen->GEN_ret_type);line=(list_tokens[list_off+TOK_line]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var _macro_tmp_3819_0=gen->GEN_func_tokens;var _macro_tmp_3819_1=length(_macro_tmp_3819_0);var _macro_tmp_3819_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3819_0,_macro_tmp_3819_1+_macro_tmp_3819_2);array_copy(_macro_tmp_3819_0,_macro_tmp_3819_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3819_2);gen->GEN_last_func_pos=list_off;;;fields{name}=array_extract(gen->GEN_func_tokens,value_pos+TOK_SIZE,length(gen->GEN_func_tokens)-value_pos-TOK_SIZE);array_set_length(gen->GEN_func_tokens,value_pos);if((list_tokens[list_off])==',')continue;list_off-=TOK_SIZE;;break;}}else{list_off-=TOK_SIZE;;}var cls=struct_type;var new_tokens=[],all_tokens=[];while(cls){var cls_fields=cls->CLASS_fields;for(var i=0;i<length(cls_fields);i++){var(k,v)=hash_entry(cls_fields,i);tokens_parse(new_tokens,list_src,{array_var,"[",index_var,"++]="},(list_tokens[list_off+TOK_line]));var tokens=hash_get(fields,k,null);if(tokens){hash_remove(fields,k);array_append(new_tokens,tokens);}else{tokens_parse(new_tokens,list_src,"0",line);}tokens_parse(new_tokens,list_src,";",line);}array_insert_array(all_tokens,0,new_tokens);array_clear(new_tokens);cls=cls->CLASS_parent;}if(length(fields)!=0){var(k,v)=hash_entry(fields,0);return 0,error({script_line((list_tokens[list_off+TOK_line])),": unknown field ",k," in ",get_class_name_with_kind(struct_type)});}array_append(gen->GEN_func_tokens,all_tokens);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};continue;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='.'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('.'),"'"});};var dot_pos=(list_off);list_off-=TOK_SIZE;;var _macro_tmp_3833_0=gen->GEN_func_tokens;var _macro_tmp_3833_1=length(_macro_tmp_3833_0);var _macro_tmp_3833_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3833_0,_macro_tmp_3833_1+_macro_tmp_3833_2);array_copy(_macro_tmp_3833_0,_macro_tmp_3833_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3833_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};var name=array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len]);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===('('))){var line=(list_tokens[list_off+TOK_line]);var params_off=(list_off);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var num_params=0;if((list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;}else{list_off-=TOK_SIZE;;for(;;){num_params++;var _macro_tmp_3848_0=0;list_off+=TOK_SIZE;for(;list_off<length(list_tokens);list_off+=TOK_SIZE){switch(list_tokens[list_off]){case '(','{','[':_macro_tmp_3848_0++;continue;case ')','}',']':if(!_macro_tmp_3848_0)break;_macro_tmp_3848_0--;continue;case ',',';':if(!_macro_tmp_3848_0)break;continue;default:continue;}break;}list_off-=TOK_SIZE;;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off=params_off;;var func_name={name,"#",num_params+2};var func=null;var struct=struct_type;for(;;){func=hash_get(struct->CLASS_functions,func_name,null);if(func&&(!(func->FUNC_flags&FUNC_FLAG_PRIVATE)||struct===hash_get(gen->GEN_classes,struct->CLASS_name,null))){var(param_name,param_type)=hash_entry(func->FUNC_params,1);if(!is_array(param_type)||param_type[0]!=EXT_TYPE_STRUCT_ARRAY||(param_type->ARRAY_base_type!=TYPE_DYNAMIC&&param_type->ARRAY_base_type!==struct_type)){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," in struct ",get_type_name(struct_type)," has incompatible first parameter"});}break;}struct=struct->CLASS_parent;if(!struct){return 0,error({script_line((list_tokens[list_off+TOK_line])),": function ",func_name," not found in struct ",get_type_name(struct_type)});}}list_off=dot_pos;;list_off+=TOK_SIZE;;var _macro_tmp_3861_0=gen->GEN_func_tokens;var _macro_tmp_3861_1=length(_macro_tmp_3861_0);var _macro_tmp_3861_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3861_0,_macro_tmp_3861_1+_macro_tmp_3861_2);array_copy(_macro_tmp_3861_0,_macro_tmp_3861_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3861_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var func_real_name={struct->CLASS_method_prefix,name};var src_off=length(list_src);array_set_length(list_src,src_off+length({"(",func_real_name}));array_copy(list_src,src_off,{"(",func_real_name},0,length({"(",func_real_name}));;var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3865_0=off>=0?list_tokens[off+TOK_off]:func_tokens[-off+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3865_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3865_1=length(func_tokens);var _macro_tmp_3865_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3865_1+_macro_tmp_3865_2);array_copy(func_tokens,func_pos+_macro_tmp_3865_2,func_tokens,func_pos,_macro_tmp_3865_1-func_pos);;;func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=length(func_real_name);func_tokens[func_pos++]=line;;func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;func_tokens=gen->GEN_func_tokens;var search_off1=list_tokens[expr_start_pos+TOK_off];var search_off2=list_tokens[dot_pos+TOK_off];var expr_pos1=-1;var expr_pos2=-1;for(var i=length(func_tokens)-TOK_SIZE;i>=0;i-=TOK_SIZE){if(func_tokens[i+TOK_off]==search_off1){expr_pos1=i;break;}if(func_tokens[i+TOK_off]==search_off2){expr_pos2=i;}}var expr_tokens=array_extract(func_tokens,expr_pos1+TOK_SIZE,expr_pos2-expr_pos1-2*TOK_SIZE);array_remove(func_tokens,expr_pos1,expr_pos2-expr_pos1);tokens_parse(expr_tokens,list_src,",",line);array_insert_array(func_tokens,func_pos,expr_tokens);var dot_off=length(func_tokens)-TOK_SIZE;if(num_params>0){var src_off2=length(list_src);array_set_length(list_src,src_off2+length(","));array_copy(list_src,src_off2,",",0,length(","));;func_tokens[dot_off++]=',';func_tokens[dot_off++]=src_off2;func_tokens[dot_off++]=1;func_tokens[dot_off++]=line;;}else{array_set_length(func_tokens,length(func_tokens)-TOK_SIZE);}list_off=params_off;;gen->GEN_last_func_pos=list_off;;;for(var i=0;i<num_params;i++){if(i>0){if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==','){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(','),"'"});};}var(param_name,param_type)=hash_entry(func->FUNC_params,i+2);var param_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,param_start_pos,param_type,gen->GEN_ret_type);}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};list_off+=TOK_SIZE;;var _macro_tmp_3884_0=gen->GEN_func_tokens;var _macro_tmp_3884_1=length(_macro_tmp_3884_0);var _macro_tmp_3884_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3884_0,_macro_tmp_3884_1+_macro_tmp_3884_2);array_copy(_macro_tmp_3884_0,_macro_tmp_3884_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3884_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;array_remove(func_tokens,dot_off,TOK_SIZE);type=func->FUNC_return_type;}else{list_off-=TOK_SIZE;;var(field_type,offset)=get_struct_field(gen,struct_type,name);if(!is_int(offset)){return 0,offset;}if(offset<0){return 0,error({script_line((list_tokens[list_off+TOK_line])),": can't find field ",name," in struct ",struct_type->CLASS_name});}var line=(list_tokens[list_off+TOK_line]);var prepend=tokens_parse([],list_src,"sub32(",line);var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3890_0=expr_start_pos>=0?list_tokens[expr_start_pos+TOK_off]:func_tokens[-expr_start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3890_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3890_1=length(func_tokens);var _macro_tmp_3890_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3890_1+_macro_tmp_3890_2);array_copy(func_tokens,func_pos+_macro_tmp_3890_2,func_tokens,func_pos,_macro_tmp_3890_1-func_pos);;;array_copy(func_tokens,func_pos,prepend,0,length(prepend));tokens_parse(gen->GEN_func_tokens,list_src,{", ",offset,")"},line);list_off-=TOK_SIZE;;list_off-=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;var _macro_tmp_3897_0=gen->GEN_func_tokens;var _macro_tmp_3897_1=length(_macro_tmp_3897_0);var _macro_tmp_3897_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3897_0,_macro_tmp_3897_1+_macro_tmp_3897_2);array_copy(_macro_tmp_3897_0,_macro_tmp_3897_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3897_2);gen->GEN_last_func_pos=list_off;;;list_off+=TOK_SIZE;;list_off+=TOK_SIZE;;gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;type=field_type;if(type==TYPE_FLOAT){var is_assign=false;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};switch((list_tokens[list_off])){case '=','+=','-=','*=','/=':is_assign=true;break;}list_off-=TOK_SIZE;;if(!is_assign){var src_off=length(list_src);array_set_length(list_src,src_off+length("{("));array_copy(list_src,src_off,"{(",0,length("{("));;var adj_off=max(off,unary_off);adj_off=hash_get(gen->GEN_func_offsets_replacements,adj_off,adj_off);var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3909_0=adj_off>=0?list_tokens[adj_off+TOK_off]:func_tokens2[-adj_off+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_3909_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_3909_1=length(func_tokens2);var _macro_tmp_3909_2=(2)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3909_1+_macro_tmp_3909_2);array_copy(func_tokens2,func_pos2+_macro_tmp_3909_2,func_tokens2,func_pos2,_macro_tmp_3909_1-func_pos2);;;func_tokens2[func_pos2++]='{';func_tokens2[func_pos2++]=src_off;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;func_tokens2[func_pos2++]='(';func_tokens2[func_pos2++]=src_off+1;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;tokens_parse(gen->GEN_func_tokens,list_src,")*1.0}",line);}}}continue;}var off2=(list_tokens[list_off+TOK_off]);if(is_hash){list_off+=TOK_SIZE;;var _macro_tmp_3915_0=gen->GEN_func_tokens;var _macro_tmp_3915_1=length(_macro_tmp_3915_0);var _macro_tmp_3915_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3915_0,_macro_tmp_3915_1+_macro_tmp_3915_2);array_copy(_macro_tmp_3915_0,_macro_tmp_3915_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3915_2);gen->GEN_last_func_pos=list_off;;;list_off-=TOK_SIZE;;var src_off=length(list_src);array_set_length(list_src,src_off+length("{}"));array_copy(list_src,src_off,"{}",0,length("{}"));;var func_tokens=gen->GEN_func_tokens;for(var i=length(func_tokens)-TOK_SIZE;;i-=TOK_SIZE){var foff=func_tokens[i+TOK_off];if(foff==off2){func_tokens[i+TOK_type]='}';func_tokens[i+TOK_off]=src_off+1;continue;}if(foff==off1){func_tokens[i+TOK_type]='{';func_tokens[i+TOK_off]=src_off;break;}}}type=base_type;continue;}case '{':{var expr_start_pos=(list_off);list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;append_type_conv(gen,list_tokens,list_src,list_off,expr_start_pos,TYPE_DYNAMIC,gen->GEN_ret_type);if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!=='}'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char('}'),"'"});};type=TYPE_DYNAMIC;continue;}case '(':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if(!(list_tokens[list_off]===(')'))){list_off-=TOK_SIZE;;for(;;){list_off=parse_expression(gen,list_tokens,list_src,list_off,-1,(list_off),PRIO_PRIMARY);;if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};if((list_tokens[list_off]===(',')))continue;list_off-=TOK_SIZE;;break;}if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==')'){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected symbol '",_tokens_char(')'),"'"});};}type=TYPE_DYNAMIC;continue;case '->':if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");}if(list_tokens[list_off]!==TOK_IDENT){return 0,error({script_line(list_tokens[list_off+TOK_line]),": expected ",_tokens_get_desc(TOK_IDENT)});};type=TYPE_DYNAMIC;continue;};
list_off-=TOK_SIZE;;
break;
}

if(((list_off+=TOK_SIZE)<length(list_tokens))){
if((list_tokens[list_off]===TOK_IDENT&&(list_tokens[list_off+TOK_len]===length("as")&&array_extract(list_src,list_tokens[list_off+TOK_off],list_tokens[list_off+TOK_len])==("as")))){
var is_struct1=is_array(type)&&type[0]==EXT_TYPE_STRUCT;
var _macro_tmp_3946_0=gen->GEN_func_tokens;var _macro_tmp_3946_1=length(_macro_tmp_3946_0);var _macro_tmp_3946_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3946_0,_macro_tmp_3946_1+_macro_tmp_3946_2);array_copy(_macro_tmp_3946_0,_macro_tmp_3946_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3946_2);gen->GEN_last_func_pos=list_off;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};var(_macro_tmp_3948_0,_macro_tmp_3948_1)=parse_type_inner(gen,list_tokens,list_src,list_off,false,false);if(!is_int(_macro_tmp_3948_1))return 0,_macro_tmp_3948_1;list_off=_macro_tmp_3948_1;;type=_macro_tmp_3948_0;;;
if(!((list_off+=TOK_SIZE)<length(list_tokens))){return 0,error("unexpected end of file");};
gen->GEN_last_func_pos=list_off;;;
list_off-=TOK_SIZE;;
var is_struct2=is_array(type)&&type[0]==EXT_TYPE_STRUCT;
if(is_struct1||is_struct2){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": struct casting not applicable in this context"});
}
}
else{
list_off-=TOK_SIZE;;
}
}

gen->GEN_ret_type=type;
return(list_off);
}

function@wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,end_pos)
{
var line=(list_tokens[list_off+TOK_line]);
var _macro_tmp_3964_0=gen->GEN_func_tokens;var _macro_tmp_3964_1=length(_macro_tmp_3964_0);var _macro_tmp_3964_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_3964_0,_macro_tmp_3964_1+_macro_tmp_3964_2);array_copy(_macro_tmp_3964_0,_macro_tmp_3964_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_3964_2);gen->GEN_last_func_pos=list_off;;;
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3966_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3966_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3966_1=length(func_tokens);var _macro_tmp_3966_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3966_1+_macro_tmp_3966_2);array_copy(func_tokens,func_pos+_macro_tmp_3966_2,func_tokens,func_pos,_macro_tmp_3966_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("float()"));array_copy(list_src,src_off,"float()",0,length("float()"));;
func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=5;func_tokens[func_pos++]=line;;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+5;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
if(end_pos!=-1){
var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_3971_0=end_pos>=0?list_tokens[end_pos+TOK_off]:func_tokens2[-end_pos+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_3971_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(0);var _macro_tmp_3971_1=length(func_tokens2);var _macro_tmp_3971_2=(1)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_3971_1+_macro_tmp_3971_2);array_copy(func_tokens2,func_pos2+_macro_tmp_3971_2,func_tokens2,func_pos2,_macro_tmp_3971_1-func_pos2);;;
func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+6;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;
}
else{
func_tokens[]=')';func_tokens[]=src_off+6;func_tokens[]=1;func_tokens[]=line;;
}
}

function@wrap_float_op(gen,list_tokens,list_src,list_off,start_pos)
{
var line=(list_tokens[list_off+TOK_line]);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3977_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3977_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3977_1=length(func_tokens);var _macro_tmp_3977_2=(1)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3977_1+_macro_tmp_3977_2);array_copy(func_tokens,func_pos+_macro_tmp_3977_2,func_tokens,func_pos,_macro_tmp_3977_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("{}"));array_copy(list_src,src_off,"{}",0,length("{}"));;
func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[]='}';func_tokens[]=src_off+1;func_tokens[]=1;func_tokens[]=line;;
}

function@wrap_float_unary_op(gen,list_tokens,list_src,list_off,start_pos)
{
var line=(list_tokens[list_off+TOK_line]);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3984_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3984_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3984_1=length(func_tokens);var _macro_tmp_3984_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3984_1+_macro_tmp_3984_2);array_copy(func_tokens,func_pos+_macro_tmp_3984_2,func_tokens,func_pos,_macro_tmp_3984_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("{0.0}"));array_copy(list_src,src_off,"{0.0}",0,length("{0.0}"));;
func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[func_pos++]=TOK_FLOAT_NUMBER;func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=3;func_tokens[func_pos++]=line;;
func_tokens[]='}';func_tokens[]=src_off+4;func_tokens[]=1;func_tokens[]=line;;
}

function@wrap_concat_op(gen,list_tokens,list_src,list_off,start_pos,operator_pos)
{
var line=(list_tokens[list_off+TOK_line]);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3992_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3992_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3992_1=length(func_tokens);var _macro_tmp_3992_2=(1)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3992_1+_macro_tmp_3992_2);array_copy(func_tokens,func_pos+_macro_tmp_3992_2,func_tokens,func_pos,_macro_tmp_3992_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("{},"));array_copy(list_src,src_off,"{},",0,length("{},"));;
func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[]='}';func_tokens[]=src_off+1;func_tokens[]=1;func_tokens[]=line;;

var off=list_tokens[operator_pos+TOK_off];
for(var i=length(func_tokens)-TOK_SIZE;;i-=TOK_SIZE){
if(func_tokens[i+TOK_off]==off){
func_tokens[i+TOK_type]=',';
func_tokens[i+TOK_off]=src_off+2;
func_tokens[i+TOK_len]=1;
break;
}
}
}

function@wrap_string_conv(gen,list_tokens,list_src,list_off,start_pos)
{
var line=(list_tokens[list_off+TOK_line]);
var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_3999_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_3999_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_3999_1=length(func_tokens);var _macro_tmp_3999_2=(2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_3999_1+_macro_tmp_3999_2);array_copy(func_tokens,func_pos+_macro_tmp_3999_2,func_tokens,func_pos,_macro_tmp_3999_1-func_pos);;;
var src_off=length(list_src);array_set_length(list_src,src_off+length("{()}"));array_copy(list_src,src_off,"{()}",0,length("{()}"));;
func_tokens[func_pos++]='{';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[]=')';func_tokens[]=src_off+2;func_tokens[]=1;func_tokens[]=line;;
func_tokens[]='}';func_tokens[]=src_off+3;func_tokens[]=1;func_tokens[]=line;;
}

function@wrap_operator_op(gen,list_tokens,list_src,list_off,start_pos,operator_pos,func_name,compare,prio)
{
var line=(list_tokens[list_off+TOK_line]);
var comma_off;

var func_tokens=gen->GEN_func_tokens;var func_pos=length(func_tokens)-TOK_SIZE;var _macro_tmp_4008_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens[-start_pos+TOK_off];while(func_tokens[func_pos+TOK_off]!==_macro_tmp_4008_0){func_pos-=TOK_SIZE;}func_pos+=TOK_SIZE+(0);var _macro_tmp_4008_1=length(func_tokens);var _macro_tmp_4008_2=(compare?3:2)*TOK_SIZE;array_set_length(func_tokens,_macro_tmp_4008_1+_macro_tmp_4008_2);array_copy(func_tokens,func_pos+_macro_tmp_4008_2,func_tokens,func_pos,_macro_tmp_4008_1-func_pos);;;
if(compare){
var expr;
switch(prio){
case PRIO_COMPARISON_LT:expr="<0";break;
case PRIO_COMPARISON_GT:expr=">0";break;
case PRIO_COMPARISON_LE:expr="<=0";break;
case PRIO_COMPARISON_GE:expr=">=0";break;
case PRIO_EQUALITY_EQ_VALUE:expr="==0";break;
case PRIO_EQUALITY_NE_VALUE:expr="!=0";break;
}
var src_off=length(list_src);array_set_length(list_src,src_off+length({"((,",func_name}));array_copy(list_src,src_off,{"((,",func_name},0,length({"((,",func_name}));;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+3;func_tokens[func_pos++]=length(func_name);func_tokens[func_pos++]=line;;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off+1;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
tokens_parse(func_tokens,list_src,{")",expr,")"},line);
comma_off=src_off+2;
}
else{
var src_off=length(list_src);array_set_length(list_src,src_off+length({"(),",func_name}));array_copy(list_src,src_off,{"(),",func_name},0,length({"(),",func_name}));;
func_tokens[func_pos++]=TOK_IDENT;func_tokens[func_pos++]=src_off+3;func_tokens[func_pos++]=length(func_name);func_tokens[func_pos++]=line;;
func_tokens[func_pos++]='(';func_tokens[func_pos++]=src_off;func_tokens[func_pos++]=1;func_tokens[func_pos++]=line;;
func_tokens[]=')';func_tokens[]=src_off+1;func_tokens[]=1;func_tokens[]=line;;
comma_off=src_off+2;
}

var off=list_tokens[operator_pos+TOK_off];
for(var i=length(func_tokens)-TOK_SIZE;;i-=TOK_SIZE){
if(func_tokens[i+TOK_off]==off){
func_tokens[i+TOK_type]=',';
func_tokens[i+TOK_off]=comma_off;
func_tokens[i+TOK_len]=1;
break;
}
}
}

function@wrap_struct_conv(gen,list_tokens,list_src,list_off,start_pos,operator_pos,type)
{
var line=(list_tokens[list_off+TOK_line]);
var size_name={type->CLASS_compat_name,"_SIZE"};

var src_off=length(list_src);array_set_length(list_src,src_off+length({"(),sub32",size_name}));array_copy(list_src,src_off,{"(),sub32",size_name},0,length({"(),sub32",size_name}));;
var func_tokens1=gen->GEN_func_tokens;var func_pos1=length(func_tokens1)-TOK_SIZE;var _macro_tmp_4021_0=start_pos>=0?list_tokens[start_pos+TOK_off]:func_tokens1[-start_pos+TOK_off];while(func_tokens1[func_pos1+TOK_off]!==_macro_tmp_4021_0){func_pos1-=TOK_SIZE;}func_pos1+=TOK_SIZE+(0);var _macro_tmp_4021_1=length(func_tokens1);var _macro_tmp_4021_2=(2)*TOK_SIZE;array_set_length(func_tokens1,_macro_tmp_4021_1+_macro_tmp_4021_2);array_copy(func_tokens1,func_pos1+_macro_tmp_4021_2,func_tokens1,func_pos1,_macro_tmp_4021_1-func_pos1);;;
func_tokens1[func_pos1++]=TOK_IDENT;func_tokens1[func_pos1++]=src_off+3;func_tokens1[func_pos1++]=5;func_tokens1[func_pos1++]=line;;
func_tokens1[func_pos1++]='(';func_tokens1[func_pos1++]=src_off+0;func_tokens1[func_pos1++]=1;func_tokens1[func_pos1++]=line;;
if(operator_pos==-1){
var func_tokens2=gen->GEN_func_tokens;
func_tokens2[]=',';func_tokens2[]=src_off+2;func_tokens2[]=1;func_tokens2[]=line;;
func_tokens2[]=TOK_IDENT;func_tokens2[]=src_off+8;func_tokens2[]=length(size_name);func_tokens2[]=line;;
func_tokens2[]=')';func_tokens2[]=src_off+1;func_tokens2[]=1;func_tokens2[]=line;;
}
else{
var func_tokens2=gen->GEN_func_tokens;var func_pos2=length(func_tokens2)-TOK_SIZE;var _macro_tmp_4028_0=operator_pos>=0?list_tokens[operator_pos+TOK_off]:func_tokens2[-operator_pos+TOK_off];while(func_tokens2[func_pos2+TOK_off]!==_macro_tmp_4028_0){func_pos2-=TOK_SIZE;}func_pos2+=TOK_SIZE+(-TOK_SIZE);var _macro_tmp_4028_1=length(func_tokens2);var _macro_tmp_4028_2=(3)*TOK_SIZE;array_set_length(func_tokens2,_macro_tmp_4028_1+_macro_tmp_4028_2);array_copy(func_tokens2,func_pos2+_macro_tmp_4028_2,func_tokens2,func_pos2,_macro_tmp_4028_1-func_pos2);;;
func_tokens2[func_pos2++]=',';func_tokens2[func_pos2++]=src_off+2;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;
func_tokens2[func_pos2++]=TOK_IDENT;func_tokens2[func_pos2++]=src_off+8;func_tokens2[func_pos2++]=length(size_name);func_tokens2[func_pos2++]=line;;
func_tokens2[func_pos2++]=')';func_tokens2[func_pos2++]=src_off+1;func_tokens2[func_pos2++]=1;func_tokens2[func_pos2++]=line;;
}
}

function@append_type_conv(gen,list_tokens,list_src,list_off,start_pos,dest_type,src_type)
{
if(dest_type==-1){
dest_type=TYPE_DYNAMIC;
}
if(dest_type==src_type){
return;
}


if(dest_type==TYPE_FLOAT){
if(src_type==TYPE_FLOAT)return;
if(src_type!=TYPE_INTEGER){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": not an Integer or Float"});
}

list_off+=TOK_SIZE;;
var _macro_tmp_4036_0=gen->GEN_func_tokens;var _macro_tmp_4036_1=length(_macro_tmp_4036_0);var _macro_tmp_4036_2=list_off-gen->GEN_last_func_pos;array_set_length(_macro_tmp_4036_0,_macro_tmp_4036_1+_macro_tmp_4036_2);array_copy(_macro_tmp_4036_0,_macro_tmp_4036_1,list_tokens,gen->GEN_last_func_pos,_macro_tmp_4036_2);gen->GEN_last_func_pos=list_off;;;
wrap_with_float_conv(gen,list_tokens,list_src,list_off,start_pos,-1);
list_off-=TOK_SIZE;;
return;
}

if(!check_implicit_conv(dest_type,src_type)){
return 0,error({script_line((list_tokens[list_off+TOK_line])),": cannot implicitly convert from ",get_type_name(src_type)," to ",get_type_name(dest_type)});
}
}

function@check_implicit_conv(dest_type,src_type)
{
if(dest_type==src_type){
return true;
}

if(dest_type==TYPE_FLOAT){
if(src_type==TYPE_FLOAT)return true;
if(src_type!=TYPE_INTEGER){
return false;
}
return true;
}

if(src_type==TYPE_STRING&&is_integer_or_dynamic_array(dest_type)){
return true;
}

if(is_array(src_type)&&src_type[0]==EXT_TYPE_ARRAY&&src_type->ARRAY_base_type==TYPE_DYNAMIC){
if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_STRUCT_ARRAY){
return true;
}
}
if(is_array(src_type)&&src_type[0]==EXT_TYPE_STRUCT_ARRAY){
if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_ARRAY&&dest_type->ARRAY_base_type==TYPE_DYNAMIC){
return true;
}
}

if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_ARRAY&&is_array(src_type)&&src_type[0]==EXT_TYPE_ARRAY){
var dest=dest_type->ARRAY_base_type;
var src=src_type->ARRAY_base_type;
if((dest==TYPE_DYNAMIC&&src==TYPE_FLOAT)||(dest==TYPE_FLOAT&&src==TYPE_DYNAMIC)){
return true;
}
return check_implicit_conv(dest,src);
}

if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_HASH&&is_array(src_type)&&src_type[0]==EXT_TYPE_HASH){
var dest1=dest_type->HASH_base_type;
var dest2=dest_type->HASH_index_type;
var src1=src_type->HASH_base_type;
var src2=src_type->HASH_index_type;
if((dest1==TYPE_DYNAMIC&&src1==TYPE_FLOAT)||(dest1==TYPE_FLOAT&&src1==TYPE_DYNAMIC)){
return true;
}
if((dest2==TYPE_DYNAMIC&&src2==TYPE_FLOAT)||(dest2==TYPE_FLOAT&&src2==TYPE_DYNAMIC)){
return true;
}
if(!check_implicit_conv(dest1,src1))return false;
if(!check_implicit_conv(dest2,src2))return false;
return true;
}

var dest_class=get_type_class(dest_type);
var src_class=get_type_class(src_type);
if(dest_class&&src_class){
while(src_class){
if(src_class===dest_class){
return true;
}
src_class=src_class->CLASS_parent;
}
}

if(dest_type!=TYPE_DYNAMIC&&src_type!=TYPE_DYNAMIC){
if(is_array(dest_type)&&dest_type[0]==EXT_TYPE_MULTIPLE){
for(var i=1;i<length(dest_type);i++){
if(check_implicit_conv(dest_type[i],src_type)){
return true;
}
}
}
return false;
}
return true;
}

function@check_implicit_conv_with_error(dest_type,src_type,line)
{
if(!check_implicit_conv(dest_type,src_type)){
return 0,error({script_line(line),": cannot implicitly convert from ",get_type_name(src_type)," to ",get_type_name(dest_type)});
}
}

function@is_same_type(type1,type2)
{
if(type1==type2)return true;
return false;
}

function@is_compatible_type(dest_type,src_type)
{
return check_implicit_conv(dest_type,src_type);
}

function@get_type_name(type)
{
if(is_array(type)){
switch(type[0]){
case EXT_TYPE_CLASS:
case EXT_TYPE_STRUCT:
return type->CLASS_name;

case EXT_TYPE_ARRAY:
return{get_type_name(type->ARRAY_base_type),"[]"};

case EXT_TYPE_HASH:
return{get_type_name(type->HASH_base_type),"[",get_type_name(type->HASH_index_type),"]"};

case EXT_TYPE_STRUCT_ARRAY:
return{"[",get_type_name(type->ARRAY_base_type),"]"};

case EXT_TYPE_MULTIPLE:{
var s={get_type_name(type[1])};
for(var i=2;i<length(type);i++){
array_append(s," or ");
array_append(s,get_type_name(type[i]));
}
return s;
}
}
return "???";
}
switch(type){
case TYPE_DYNAMIC:return "Dynamic";
case TYPE_VOID:return "Void";
case TYPE_INTEGER:return "Integer";
case TYPE_FLOAT:return "Float";
case TYPE_BOOLEAN:return "Boolean";
case TYPE_STRING:return "String";
case TYPE_KEY:return "<Key>";
case TYPE_VALUE:return "<Value>";
}
return "???";
}

function@get_type_class(type)
{
if(is_array(type)&&type[0]==EXT_TYPE_CLASS){
return type;
}
return null;
}

function@get_type_class_or_struct(type)
{
if(is_array(type)){
switch(type[0]){
case EXT_TYPE_CLASS:
case EXT_TYPE_STRUCT:
return type;
}
}
return null;
}

function@get_type_array_or_hash(type)
{
if(is_array(type)){
switch(type[0]){
case EXT_TYPE_ARRAY:
case EXT_TYPE_HASH:
return type;
}
}
return null;
}

function@get_class_name_with_kind(class)
{
return{class->CLASS_ext_type==EXT_TYPE_STRUCT?"struct ":"class ",class->CLASS_name};
}

function@is_integer_or_dynamic_array(type)
{
return(is_array(type)&&type[0]==EXT_TYPE_ARRAY&&(type->ARRAY_base_type==TYPE_INTEGER||type->ARRAY_base_type==TYPE_DYNAMIC));
}

function@get_struct_size(type)
{
var size=0;
while(type){
size+=length(type->CLASS_fields);
type=type->CLASS_parent;
}
return size;
}

function@get_struct_field(gen,type,name)
{
var size=0;
while(type){
var fields=type->CLASS_fields;
for(var i=0;i<length(fields);i++){
var(field_name,field)=hash_entry(fields,i);
if(field_name==name&&(!field->FIELD_private||type===hash_get(gen->GEN_classes,type->CLASS_name,null))){
return field->FIELD_type,size+(length(fields)-i);
}
}
size+=length(fields);
type=type->CLASS_parent;
}
return-1,-1;
}

function@find_to_string_function(cls)
{
while(cls){
var func=hash_get(cls->CLASS_functions,"to_string#1",null);
if(func&&(func->FUNC_flags&(FUNC_FLAG_STATIC|FUNC_FLAG_PRIVATE|FUNC_FLAG_OVERRIDE))==0){
return cls;
}
cls=cls->CLASS_parent;
}
return null;
}

function@init_builtin_functions()
{
builtin_functions={};

var I=TYPE_INTEGER;
var F=TYPE_FLOAT;
var D=TYPE_DYNAMIC;
var B=TYPE_BOOLEAN;
var S=TYPE_STRING;
var V=TYPE_VOID;
var A=create_array_type(TYPE_DYNAMIC);
var H=create_hash_type(TYPE_DYNAMIC,TYPE_DYNAMIC);
var aI=create_array_type(TYPE_INTEGER);
var aS=create_array_type(TYPE_STRING);
var aKey=create_array_type(TYPE_KEY);
var aValue=create_array_type(TYPE_VALUE);
var hDS=create_hash_type(TYPE_DYNAMIC,TYPE_STRING);
var Key=TYPE_KEY;
var Value=TYPE_VALUE;
var param_names=[];
var _=create_params(param_names,[]);
var _I=create_params(param_names,[I]);
var _F=create_params(param_names,[F]);
var _FF=create_params(param_names,[F,F]);
var _FFF=create_params(param_names,[F,F,F]);
var _D=create_params(param_names,[D]);
var _A=create_params(param_names,[A]);
var _H=create_params(param_names,[H]);
var _aI=create_params(param_names,[aI]);
var _II=create_params(param_names,[I,I]);
var _III=create_params(param_names,[I,I,I]);
var _IIII=create_params(param_names,[I,I,I,I]);
var _IIIIII=create_params(param_names,[I,I,I,I,I,I]);
var _IIF=create_params(param_names,[I,I,F]);
var _IIFF=create_params(param_names,[I,I,F,F]);
var _DI=create_params(param_names,[D,I]);
var _DS=create_params(param_names,[D,S]);
var _DD=create_params(param_names,[D,D]);
var _AD=create_params(param_names,[A,D]);
var _AI=create_params(param_names,[A,I]);
var _AA=create_params(param_names,[A,A]);
var _HI=create_params(param_names,[H,I]);
var _HD=create_params(param_names,[H,D]);
var _SaI=create_params(param_names,[S,aI]);
var _aIS=create_params(param_names,[aI,S]);
var _aID=create_params(param_names,[aI,D]);
var _aIaI=create_params(param_names,[aI,aI]);
var _AAII=create_params(param_names,[A,A,I,I]);
var _AID=create_params(param_names,[A,I,D]);
var _AIA=create_params(param_names,[A,I,A]);
var _DDD=create_params(param_names,[D,D,D]);
var _AII=create_params(param_names,[A,I,I]);
var _HDD=create_params(param_names,[H,D,D]);
var _aIII=create_params(param_names,[aI,I,I]);
var _AIAII=create_params(param_names,[A,I,A,I,I]);
var _AIID=create_params(param_names,[A,I,I,D]);
var _AIIA=create_params(param_names,[A,I,I,A]);
var _SaIII=create_params(param_names,[S,aI,I,I]);
var _aISII=create_params(param_names,[aI,S,I,I]);
var _AIIAII=create_params(param_names,[A,I,I,A,I,I]);
var _SDSI=create_params(param_names,[S,D,S,I]);
var _DSSI=create_params(param_names,[D,S,S,I]);
var _DSSIII=create_params(param_names,[D,S,S,I,I,I]);
var _DB=create_params(param_names,[D,B]);
var _S=create_params(param_names,[S]);
var _SI=create_params(param_names,[S,I]);
var _SII=create_params(param_names,[S,I,I]);
var _SIII=create_params(param_names,[S,I,I,I]);
var _SIIII=create_params(param_names,[S,I,I,I,I]);
var _SF=create_params(param_names,[S,F]);
var _SIIF=create_params(param_names,[S,I,I,F]);
var _SShDSaSaS=create_params(param_names,[S,S,hDS,aS,aS]);
var _aValueIaValueII=create_params(param_names,[aValue,I,aValue,I,I]);
var _AValue=create_params(param_names,[A,Value]);
var _AIIValue=create_params(param_names,[A,I,I,Value]);
var _AIValue=create_params(param_names,[A,I,Value]);
var _AIaValue=create_params(param_names,[A,I,aValue]);
var _AIaValueII=create_params(param_names,[A,I,aValue,I,I]);
var _AaValue=create_params(param_names,[A,aValue]);
var _AaValueII=create_params(param_names,[A,aValue,I,I]);
var _AIIaValue=create_params(param_names,[A,I,I,aValue]);
var _AIIaValueII=create_params(param_names,[A,I,I,aValue,I,I]);
var _HKeyValue=create_params(param_names,[H,Key,Value]);
var _HKey=create_params(param_names,[H,Key]);
var _SIS=create_params(param_names,[S,I,S]);
var _SISII=create_params(param_names,[S,I,S,I,I]);
var _SS=create_params(param_names,[S,S]);
var _SSII=create_params(param_names,[S,S,I,I]);
var _SIIS=create_params(param_names,[S,I,I,S]);
var _SIISII=create_params(param_names,[S,I,I,S,I,I]);
var _ArrayOrHash=create_params(param_names,[[EXT_TYPE_MULTIPLE,A,H]]);

add_builtin_function("length",I,_ArrayOrHash);
add_builtin_function("min",I,_II);
add_builtin_function("max",I,_II);
add_builtin_function("clamp",I,_III);
add_builtin_function("abs",I,_I);
add_builtin_function("add32",I,_II);
add_builtin_function("add32",I,I,_II);
add_builtin_function("add32",I,_III);
add_builtin_function("add32",I,I,_III);
add_builtin_function("sub32",I,_II);
add_builtin_function("sub32",I,I,_II);
add_builtin_function("sub32",I,_III);
add_builtin_function("sub32",I,I,_III);
add_builtin_function("mul32",I,_II);
add_builtin_function("add64",I,I,_IIII);
add_builtin_function("sub64",I,I,_IIII);
add_builtin_function("mul64",I,I,_II);
add_builtin_function("umul64",I,I,_II);
add_builtin_function("mul64",I,I,_IIII);
add_builtin_function("div64",I,I,_IIII);
add_builtin_function("udiv64",I,I,_IIII);
add_builtin_function("rem64",I,I,_IIII);
add_builtin_function("urem64",I,I,_IIII);
add_builtin_function("float",F,_I);
add_builtin_function("float",I,I,_II);
add_builtin_function("int",I,_F);
add_builtin_function("int",I,I,_II);
add_builtin_function("fconv",I,I,_F);
add_builtin_function("fconv",F,_II);
add_builtin_function("fadd",I,I,_IIF);
add_builtin_function("fadd",I,I,_IIII);
add_builtin_function("fsub",I,I,_IIF);
add_builtin_function("fsub",I,I,_IIII);
add_builtin_function("fmul",I,I,_IIF);
add_builtin_function("fmul",I,I,_IIII);
add_builtin_function("fdiv",I,I,_IIF);
add_builtin_function("fdiv",I,I,_IIII);
add_builtin_function("fcmp_lt",B,_IIF);
add_builtin_function("fcmp_lt",B,_IIII);
add_builtin_function("fcmp_le",B,_IIF);
add_builtin_function("fcmp_le",B,_IIII);
add_builtin_function("fcmp_gt",B,_IIF);
add_builtin_function("fcmp_gt",B,_IIII);
add_builtin_function("fcmp_ge",B,_IIF);
add_builtin_function("fcmp_ge",B,_IIII);
add_builtin_function("fcmp_eq",B,_IIF);
add_builtin_function("fcmp_eq",B,_IIII);
add_builtin_function("fcmp_ne",B,_IIF);
add_builtin_function("fcmp_ne",B,_IIII);
add_builtin_function("fabs",F,_F);
add_builtin_function("fabs",I,I,_II);
add_builtin_function("fmin",F,_FF);
add_builtin_function("fmin",I,I,_IIF);
add_builtin_function("fmin",I,I,_IIII);
add_builtin_function("fmax",F,_FF);
add_builtin_function("fmax",I,I,_IIF);
add_builtin_function("fmax",I,I,_IIII);
add_builtin_function("fclamp",F,_FFF);
add_builtin_function("fclamp",I,I,_IIFF);
add_builtin_function("fclamp",I,I,_IIIIII);
add_builtin_function("floor",F,_F);
add_builtin_function("floor",I,I,_II);
add_builtin_function("ifloor",I,_F);
add_builtin_function("ifloor",I,I,_II);
add_builtin_function("ceil",F,_F);
add_builtin_function("ceil",I,I,_II);
add_builtin_function("iceil",I,_F);
add_builtin_function("iceil",I,I,_II);
add_builtin_function("round",F,_F);
add_builtin_function("round",I,I,_II);
add_builtin_function("iround",I,_F);
add_builtin_function("iround",I,I,_II);
add_builtin_function("pow",F,_FF);
add_builtin_function("pow",I,I,_IIF);
add_builtin_function("pow",I,I,_IIII);
add_builtin_function("sqrt",F,_F);
add_builtin_function("sqrt",I,I,_II);
add_builtin_function("cbrt",F,_F);
add_builtin_function("cbrt",I,I,_II);
add_builtin_function("exp",F,_F);
add_builtin_function("exp",I,I,_II);
add_builtin_function("ln",F,_F);
add_builtin_function("ln",I,I,_II);
add_builtin_function("log2",F,_F);
add_builtin_function("log2",I,I,_II);
add_builtin_function("log10",F,_F);
add_builtin_function("log10",I,I,_II);
add_builtin_function("sin",F,_F);
add_builtin_function("sin",I,I,_II);
add_builtin_function("cos",F,_F);
add_builtin_function("cos",I,I,_II);
add_builtin_function("asin",F,_F);
add_builtin_function("asin",I,I,_II);
add_builtin_function("acos",F,_F);
add_builtin_function("acos",I,I,_II);
add_builtin_function("tan",F,_F);
add_builtin_function("tan",I,I,_II);
add_builtin_function("atan",F,_F);
add_builtin_function("atan",I,I,_II);
add_builtin_function("atan2",F,_FF);
add_builtin_function("atan2",I,I,_IIII);
add_builtin_function("is_int",B,_D);
add_builtin_function("is_float",B,_D);
add_builtin_function("is_array",B,_D);
add_builtin_function("is_string",B,_D);
add_builtin_function("is_hash",B,_D);
add_builtin_function("is_shared",B,_D);
add_builtin_function("is_const",B,_D);
add_builtin_function("is_funcref",B,_D);
add_builtin_function("is_weakref",B,_D);
add_builtin_function("is_handle",B,_D);

add_builtin_function("clone",D,_D);
add_builtin_function("clone_deep",D,_D);
add_builtin_function("array_create",A,_I);
add_builtin_function("array_create",A,_II);
add_builtin_function("array_create_shared",A,_II);
add_builtin_function("array_get_shared_count",I,_A);
add_builtin_function("array_get_element_size",I,_A);
add_builtin_function("array_set_length",V,_AI);
add_builtin_function("array_copy",V,_AIAII);
add_builtin_function("array_fill",V,_AD);
add_builtin_function("array_fill",V,_AIID);
add_builtin_function("array_extract",D,_AII);
add_builtin_function("array_insert",V,_AID);
add_builtin_function("array_insert_array",V,_AIA);
add_builtin_function("array_insert_array",V,_AIAII);
add_builtin_function("array_append",V,_AA);
add_builtin_function("array_append",V,_AAII);
add_builtin_function("array_replace_range",V,_AIIA);
add_builtin_function("array_replace_range",V,_AIIAII);
add_builtin_function("array_remove",V,_AI);
add_builtin_function("array_remove",V,_AII);
add_builtin_function("array_clear",V,_A);
add_builtin_function("string_const",S,_S);
add_builtin_function("string_const",S,_SII);
add_builtin_function("string_parse_int",I,_S);
add_builtin_function("string_parse_int",I,_SI);
add_builtin_function("string_parse_int",I,_SII);
add_builtin_function("string_parse_int",I,_SIII);
add_builtin_function("string_parse_float",F,_S);
add_builtin_function("string_parse_float",F,_SF);
add_builtin_function("string_parse_float",F,_SII);
add_builtin_function("string_parse_float",F,_SIIF);
add_builtin_function("string_parse_long",I,I,_S);
add_builtin_function("string_parse_long",I,I,_SII);
add_builtin_function("string_parse_long",I,I,_SIIII);
add_builtin_function("string_parse_double",I,I,_S);
add_builtin_function("string_parse_double",I,I,_SII);
add_builtin_function("string_parse_double",I,I,_SIIII);
add_builtin_function("string_from_long",S,_II);
add_builtin_function("string_from_long",S,_SII);
add_builtin_function("string_from_double",S,_II);
add_builtin_function("string_from_double",S,_SII);
add_builtin_function("string_from_utf8",S,_aI);
add_builtin_function("string_from_utf8",S,_SaI);
add_builtin_function("string_from_utf8",S,_aIII);
add_builtin_function("string_from_utf8",S,_SaIII);
add_builtin_function("string_to_utf8",aI,_S);
add_builtin_function("string_to_utf8",aI,_aIS);
add_builtin_function("string_to_utf8",aI,_SII);
add_builtin_function("string_to_utf8",aI,_aISII);
add_builtin_function("object_create",D,_I);
add_builtin_function("object_extend",D,_DI);
add_builtin_function("weakref_create",D,_D);
add_builtin_function("weakref_create",D,_DD);
add_builtin_function("weakref_create",D,_DDD);
add_builtin_function("weakref_get",D,_D);
add_builtin_function("hash_get",D,_HDD);
add_builtin_function("hash_entry",D,D,_HI);
add_builtin_function("hash_contains",B,_HD);
add_builtin_function("hash_remove",D,_HD);
add_builtin_function("hash_keys",A,_H);
add_builtin_function("hash_values",A,_H);
add_builtin_function("hash_pairs",A,_H);
add_builtin_function("hash_clear",V,_H);
add_builtin_function("error",D,_D);
add_builtin_function("log",V,_D);
add_builtin_function("dump",V,_D);
add_builtin_function("to_string",S,_D);
add_builtin_function("to_string",S,_DB);
add_builtin_function("heap_collect",V,_);
add_builtin_function("heap_size",I,_);
add_builtin_function("perf_reset",V,_);
add_builtin_function("perf_log",V,_D);
add_builtin_function("serialize",aI,_D);
add_builtin_function("serialize",aI,_aID);
add_builtin_function("unserialize",D,_aI);
add_builtin_function("unserialize",D,_aIII);
add_builtin_function("unserialize",D,_aIaI);
add_builtin_function("script_query",V,_SShDSaSaS);
add_builtin_function("script_line",S,_I);
add_builtin_function("script_line",S,_SDSI);
add_builtin_function("script_postprocess",V,_DD);
add_builtin_function("script_compile",D,_S);
add_builtin_function("script_compile",D,_DS);
add_builtin_function("tokens_parse",D,_DSSI);
add_builtin_function("tokens_parse",D,_DSSIII);
add_builtin_function("token_parse_string",S,_S);
add_builtin_function("token_parse_string",S,_SII);
add_builtin_function("token_escape_string",S,_S);

builtin_static_functions={};
builtin_instance_functions={};

add_builtin_static_function("array_create",A,_I);
add_builtin_static_function("array_create",A,_II);
add_builtin_static_function("array_create_shared",A,_II);
add_builtin_static_function("array_copy",V,_aValueIaValueII);

add_builtin_instance_function("array_get_shared_count",I,_A);
add_builtin_instance_function("array_get_element_size",I,_A);
add_builtin_instance_function("array_set_length",V,_AI);
add_builtin_instance_function("array_fill",V,_AValue);
add_builtin_instance_function("array_fill",V,_AIIValue);
add_builtin_instance_function("array_extract",aValue,_AII);
add_builtin_instance_function("array_insert",V,_AIValue);
add_builtin_instance_function("array_insert_array",V,_AIaValue);
add_builtin_instance_function("array_insert_array",V,_AIaValueII);
add_builtin_instance_function("array_append",V,_AaValue);
add_builtin_instance_function("array_append",V,_AaValueII);
add_builtin_instance_function("array_replace_range",V,_AIIaValue);
add_builtin_instance_function("array_replace_range",V,_AIIaValueII);
add_builtin_instance_function("array_remove",V,_AI);
add_builtin_instance_function("array_remove",V,_AII);
add_builtin_instance_function("array_clear",V,_A);

add_builtin_static_function("string_parse_int",I,_S);
add_builtin_static_function("string_parse_int",I,_SI);
add_builtin_static_function("string_parse_int",I,_SII);
add_builtin_static_function("string_parse_int",I,_SIII);
add_builtin_static_function("string_parse_float",F,_S);
add_builtin_static_function("string_parse_float",F,_SF);
add_builtin_static_function("string_parse_float",F,_SII);
add_builtin_static_function("string_parse_float",F,_SIIF);













add_builtin_static_function("string_from_utf8",S,_aI);
add_builtin_static_function("string_from_utf8",S,_SaI);
add_builtin_static_function("string_from_utf8",S,_aIII);
add_builtin_static_function("string_from_utf8",S,_SaIII);
add_builtin_static_function("string_to_utf8",aI,_aIS);
add_builtin_static_function("string_to_utf8",aI,_aISII);

add_builtin_instance_function_str("string_get_element_size",I,_S);
add_builtin_instance_function_str("string_set_length",V,_SI);
add_builtin_instance_function_str("string_fill",V,_SI);
add_builtin_instance_function_str("string_fill",V,_SIII);
add_builtin_instance_function_str("string_extract",S,_SII);
add_builtin_instance_function_str("string_insert",V,_SIS)->FUNC_alt_name="array_insert_array";
add_builtin_instance_function_str("string_insert",V,_SISII)->FUNC_alt_name="array_insert_array";
add_builtin_instance_function_str("string_insert_char",V,_SII)->FUNC_alt_name="array_insert";
add_builtin_instance_function_str("string_append",V,_SS);
add_builtin_instance_function_str("string_append",V,_SSII);
add_builtin_instance_function_str("string_replace_range",V,_SIIS);
add_builtin_instance_function_str("string_replace_range",V,_SIISII);
add_builtin_instance_function_str("string_remove",V,_SI);
add_builtin_instance_function_str("string_remove",V,_SII);
add_builtin_instance_function_str("string_clear",V,_S);

add_builtin_instance_function("string_as_const",S,_S)->FUNC_alt_name="string_const";
add_builtin_instance_function("string_as_const",S,_SII)->FUNC_alt_name="string_const";
add_builtin_instance_function("string_to_utf8",aI,_S);
add_builtin_instance_function("string_to_utf8",aI,_SII);

add_builtin_instance_function("hash_get",Value,_HKeyValue);
add_builtin_instance_function("hash_entry",Key,_HI);
add_builtin_instance_function("hash_contains",B,_HKey);
add_builtin_instance_function("hash_remove",D,_HKey);
add_builtin_instance_function("hash_get_keys",aKey,_H)->FUNC_alt_name="hash_keys";
add_builtin_instance_function("hash_get_values",aValue,_H)->FUNC_alt_name="hash_values";
add_builtin_instance_function("hash_get_pairs",A,_H)->FUNC_alt_name="hash_pairs";
add_builtin_instance_function("hash_clear",V,_H);
}

function@create_params(param_names,param_types)
{
var params={};
for(var i=0;i<length(param_types);i++){
if(i==length(param_names)){
param_names[]=string_const({"p",i});
}
params{param_names[i]}=param_types[i];
}
return params;
}

function@add_builtin_function(name,ret_type,params)
{
var func=object_create(FUNC_SIZE);
func->FUNC_name=name;
func->FUNC_return_type=ret_type;
func->FUNC_flags=FUNC_FLAG_STATIC;
func->FUNC_params=params;
builtin_functions{string_const({name,"#",length(params)})}=func;
}

function@add_builtin_function(name,ret_type1,ret_type2,param_types)
{

}

function@add_builtin_static_function(name,ret_type,params)
{
var func=object_create(FUNC_SIZE);
func->FUNC_name=name;
func->FUNC_return_type=ret_type;
func->FUNC_flags=FUNC_FLAG_STATIC|FUNC_FLAG_EXTENSION;
func->FUNC_params=params;
builtin_static_functions{string_const({name,"#",length(params)})}=func;
return func;
}

function@add_builtin_instance_function(name,ret_type,params)
{
var func=object_create(FUNC_SIZE);
func->FUNC_name=name;
func->FUNC_return_type=ret_type;
func->FUNC_flags=FUNC_FLAG_EXTENSION;
func->FUNC_params=params;
builtin_instance_functions{string_const({name,"#",length(params)})}=func;
return func;
}

function@add_builtin_instance_function_str(name,ret_type,params)
{
var func=add_builtin_instance_function(name,ret_type,params);
func->FUNC_alt_name=string_const({"array_",array_extract(name,7,length(name)-7)});
return func;
}
